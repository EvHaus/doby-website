// doby-grid.js 0.0.2
// (c) 2014 Evgueni Naverniouk, Globex Designs, Inc.
// Doby may be freely distributed under the MIT license.
// For all details and documentation:
// https://github.com/globexdesigns/doby-grid
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],function(c,d,Backbone){return b(a,c,d,Backbone)}):a.DobyGrid=b(a,a.jQuery||a.$,a._,a.Backbone)}(this,function(a,b,c,Backbone){"use strict";var d=function(a){if(a=a||{},this.NAME="doby-grid",this.VERSION="0.0.2","object"!=typeof a||c.isArray(a))throw new TypeError('The "options" param must be an object.');"object"!=typeof window.console&&(window.console={});var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd=this,id={activeColumns:[],aggregatorsByColumnId:{},columnPosLeft:[],columnPosRight:[],columnsById:{},indexById:{},nodes:{},postprocess:{},rowPositions:{},rows:[]},jd=0,kd=0,ld=this.NAME+"-alert",md=this.NAME+"-cell",nd=this.NAME+"-clipboard",od="collapsed",pd=this.NAME+"-column-name",qd=this.NAME+"-contextmenu",rd=this.NAME+"-dropdown",sd=rd+"-menu",td=rd+"-item",ud=rd+"-divider",vd=rd+"-arrow",wd=rd+"-icon",xd=rd+"-left",yd=rd+"-title",zd=this.NAME+"-editor",Ad="expanded",Bd=this.NAME+"-group",Cd=this.NAME+"-group-title",Dd=this.NAME+"-group-toggle",Ed=this.NAME+"-resizable-handle",Fd=this.NAME+"-header",Gd=this.NAME+"-header-columns",Hd=this.NAME+"-header-column",Id=this.NAME+"-header-column-active",Jd=this.NAME+"-header-column-dragging",Kd=this.NAME+"-header-column-sorted",Ld=this.NAME+"-header-filter",Md=Ld+"-cell",Nd=Ld+"-disabled",Od="sortable",Pd="invalid",Qd=this.NAME+"-no-right",Rd=this.NAME+"-sortable-placeholder",Sd=this.NAME+"-range-decorator",Td=Sd+"-stats",Ud=this.NAME+"-row",Vd=this.NAME+"-row-drag-container",Wd=this.NAME+"-row-handle",Xd=this.NAME+"-row-total",Yd=this.NAME+"-sort-indicator",Zd=Yd+"-asc",$d=Yd+"-desc",_d=this.NAME+"-tooltip",ae=this.NAME+"-tooltip-arrow",be=this.NAME+"-viewport",ce=this.NAME+"-canvas",de=0,ee=null,fe=!1,ge=null,he=null,ie=null,je=0,ke=0,le="id",me="function"==typeof window.Blob,ne=!1,oe=0,pe=0,qe=function(a){this.__nonDataRow=!0,a&&b.extend(this,a)},re=0,se=0,te=null,ue=null,ve=0,we=0,xe=!1,ye=null,ze=null,Ae=0,Be=0,Ce=!1,De=1,Ee=this.NAME+"-"+Math.round(1e6*Math.random()),Fe=1;qe.prototype.toString=function(){return"NonDataItem"},a.locale=a.locale||{},a.locale=b.extend(!0,{column:{add_group:'Add Grouping By "{{name}}"',add_sort_asc:'Add Sort By "{{name}}" (Ascending)',add_sort_desc:'Add Sort By "{{name}}" (Descending)',add_quick_filter:"Add Quick Filter...",aggregators:"Aggregators",filter:'Quick Filter by "{{name}}"',filtering:"Filtering",group:'Group By "{{name}}"',grouping:"Grouping",groups_clear:"Clear All Grouping",groups_collapse:"Collapse All Groups",groups_expand:"Expand All Groups",options:"Column Options",remove:'Remove "{{name}}" Column',remove_group:'Remove Grouping By "{{name}}"',remove_sort:'Remove Sort By "{{name}}"',sorting:"Sorting",sort_asc:'Sort By "{{name}}" (Ascending)',sort_desc:'Sort By "{{name}}" (Descending)'},empty:{"default":"No data available",remote:"No results found",filter:"No items matching that filter"},global:{auto_width:"Automatically Resize Columns",columns:"Columns","export":"Export",export_csv:"Export Table to CSV",export_html:"Export Table to HTML",extensions:"Extensions",grid_options:"Grid Options",hide_filter:"Hide Quick Filter"},selection:{deselect_all:"Deselect All",deselect_cell:"Deselect This Cell",deselect_column:'Deselect "{{name}}" Column',selection:"Selection",select_all:"Select All",select_cell:"Select This Cell",select_column:'Select "{{name}}" Column'}},a.locale),this.options=b.extend({activeFollowsPage:!1,activateSelection:!0,addRow:!1,asyncEditorLoadDelay:100,asyncEditorLoading:!1,asyncPostRenderDelay:25,autoColumnWidth:!1,autoDestroy:!0,autoEdit:!0,"class":null,clipboard:"csv",columns:[],columnSpacing:1,columnWidth:80,contextMenu:"all",ctrlSelect:!0,data:[],dataExtractor:null,deactivateOnRightClick:!1,editable:!1,editor:null,editorType:"selection",emptyNotice:!0,exportFileName:"doby-grid-export",formatter:null,fullWidthRows:!0,groupable:!0,keyboardNavigation:!0,lineHeightOffset:-1,nestedAggregators:!0,menuExtensions:null,multiColumnSort:!0,quickFilter:!1,remoteScrollTime:200,resizableColumns:!0,resizableRows:!1,resizeCells:!1,reorderable:!0,rowHeight:28,selectable:!0,selectedClass:"selected",shiftSelect:!0,tooltipType:"popup",virtualScroll:!0},a);var Ge={cache:!1,"class":null,comparator:null,editable:null,filterable:!0,focusable:!0,groupable:!0,headerClass:null,id:null,maxWidth:null,minWidth:42,name:"",postprocess:null,removable:!1,rerenderOnResize:!1,resizable:!0,selectable:!0,sortable:!0,sortAsc:!0,tooltip:null,visible:!0,width:null};return b.extend(this,Backbone.Events),this._event=null,this.active=null,this.destroyed=!1,this.selection=null,this.sorting=[],Tb=function(){return bd(),Y(),Zc(),hd.collection=new E(hd),hd.options.addRow&&Ub(),K(),hd.options.selectable&&q(),hd},this.activate=function(a,b){if(ne){if(void 0===a||void 0===b)return Ec(),void 0;if(!(a>lb()||0>a||b>=id.activeColumns.length||0>b)&&u(a,b))return Gc(a,b,!1),Lc(cb(a,b),!1),this}},this.add=function(a,b){return this.collection.add(a,b),this},this.addColumn=function(a,c){if(!a||"object"!=typeof a||b.isArray(a)||a instanceof HTMLElement)throw new Error("Unable to addColumn() because the given 'data' param is invalid.");c=c||{};var d=id.columnsById[a.id];if(void 0!==d){if(c.merge!==!0){var e=["Unable to addColumn() because a column with id '"+a.id];throw e.push("' already exists. Did you want to {merge: true} maybe?"),new Error(e.join(""))}for(var f=0,g=this.options.columns.length;g>f;f++)this.options.columns[f].id==a.id&&b.extend(this.options.columns[f],a);return this}var h=this.options.columns;return null===c.at||void 0===c.at?h.push(a):h.splice(h,c.at,a),hd.setColumns(h),this},this.addGrouping=function(a,b){if(!hd.options.groupable)throw new Error('Cannot execute "addGrouping" because "options.groupable" is disabled.');if(b=b||{},null===a||void 0===a)throw new Error("Unable to add grouping to grid because the 'column_id' value is missing.");return Rb(a)||(b.column_id=a,this.collection.groups.push(b),this.setGrouping(this.collection.groups)),this},l=function(a){this.aggregators=a,this.class=Xd,this.columns={},this.editable=!1,this.focusable=!0,this.selectable=!1},l.prototype=new qe,l.prototype.toString=function(){return"Aggregate"},l.prototype.exporter=function(a){if(this.aggregators[a.id]){var b;for(var c in this.aggregators[a.id])if(b=this.aggregators[a.id][c],b.active&&b.exporter)return b.exporter()}return""},l.prototype.formatter=function(a,b,c,d){if(this.aggregators[d.id]){var e;for(var f in this.aggregators[d.id])if(e=this.aggregators[d.id][f],e.active&&e.formatter)return e.formatter()}return""},this.appendTo=function(a){if(!a||!a.length)throw new Error('Doby Grid requires a valid container. "'+b(a).selector+'" does not exist in the DOM.');this.$el.appendTo(a);try{ne=!0,gd=parseFloat(b.css(this.$el[0],"width",!0)),dc(),P(e),Ac(),Pc(),J(),s(),Fc(),xe&&(oc(function(){0===i[0].scrollTop&&pc()}),this.on("viewportchanged",function(){pc()})),this.$el.on("resize."+this.NAME,Fc),this.options.autoDestroy&&this.$el.one("remove",function(){this.destroy()}.bind(this)),i.on("scroll",Pb),g.on("contextmenu",Mb).on("click",Nb),"title"!=hd.options.tooltipType&&g.on("mouseover",function(a){Rc(a)}),d.on("keydown",Ob).on("click",Jb).on("dblclick",Lb).on("contextmenu",Kb);for(var c=["mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup"],f=function(a){var c=_(a),d=c&&void 0!==c.row&&null!==c.row?jb(c.row):null;if(hd.trigger(a.type,a,{row:c?c.row:null,cell:c?c.cell:null,item:d}),"mouseenter"==a.type){var e=document.activeElement;e==this||b(this).has(b(e)).length||(!hd.options.quickFilter||b(e).closest("."+Md).length)&&hd.options.quickFilter||b(this).focus()}},h=0,j=c.length;j>h;h++)d.on(c[h],f);this.options.resizableRows&&r()}catch(k){console.error&&console.error(k)}return"header"==this.options.contextMenu?this.on("headercontextmenu",Wc):"all"==this.options.contextMenu&&(this.on("headercontextmenu",Wc),this.on("contextmenu",Wc)),b(window).on("resize",Qb),this},m=function(a){if(ne){a||(a=e.children());var c=null;void 0!==f&&(c=f.children());var d,g,h,i;for(d=0,g=a.length;g>d;d++)h=id.activeColumns[d].width-je,i=["width:",h,"px"].join(""),b(a[d]).attr("style",i),c&&c[d]&&b(c[d]).attr("style",i);Zc(!1)}},n=function(){var a,b,c,d,e,f,g=-1;for(d=0,e=id.activeColumns.length;e>d;d++)a=id.activeColumns[d],b=a.width,c=fb(d),c.left.style.left=g+"px",f=w-g-b-2,d+1===e&&0>f&&!fd&&(f=0),c.right.style.right=f+"px",g+=a.width+1},o=function(){for(var a=lb(),c=function(){if(this.col.cache&&id&&id.rows[this.row]){var a=id.rows[this.row].id;id.postprocess[a]||(id.postprocess[a]={}),id.postprocess[a][this.col.id]=b(this.node).html()}};ue>=te;){var d,e=Fe>=0?te++:ue--,f=id.nodes[e],g=id.rows[e];if(f&&!(e>=a)){id.postprocess[g.id]||(id.postprocess[g.id]={}),R(e);for(d in f.cellNodesByColumnIdx)if(f.cellNodesByColumnIdx.hasOwnProperty(d)){d=d||0;var h=id.activeColumns[d],i=h.postprocess,j=g.columns;if(j&&j[d]&&j[d].postprocess&&(i=j[d].postprocess),i&&!id.postprocess[g.id][h.id]){var k=f.cellNodesByColumnIdx[d];k&&i({$cell:b(k),column:h,data:jb(e),grid:hd,rowIndex:e},c.bind({node:k,col:h,row:e}))}}return clearTimeout(ie),ie=setTimeout(o,hd.options.asyncPostRenderDelay),void 0}}},p=function(){var a,b,c,d,e,f,g=[],h=0,i=0,k=fd?gd-window.scrollbarDimensions.width:gd;for(k-=id.activeColumns.length,a=0;a<id.activeColumns.length;a++)b=id.activeColumns[a],b.visible!==!1&&(g.push(b.width),i+=b.width,b.resizable&&(h+=b.width-Math.max(b.minWidth||0,j)));for(c=i;i>k&&h;){var l=(i-k)/h;for(a=0;a<id.activeColumns.length&&i>k;a++){b=id.activeColumns[a];var n=g[a];if(!(b.visible===!1||!b.resizable||n<=(b.minWidth||0)||j>=n)){var o=Math.max(b.minWidth,j),p=Math.floor(l*(n-o))||1;p=Math.min(p,n-o),i-=p,h-=p,g[a]-=p}}if(i>=c)break;c=i}for(c=i;k>i;){for(d=k/i,a=0;a<id.activeColumns.length&&k>i;a++)b=id.activeColumns[a],b.visible===!1||!b.resizable||b.maxWidth&&b.maxWidth<=b.width||(e=1e6,b.maxWidth&&b.maxWidth-b.width&&(e=b.maxWidth-b.width),f=Math.min(Math.floor(d*b.width)-b.width,e)||1,i+=f,g[a]+=f);if(c>=i)break;c=i}var q,r=!1;for(a=0;a<id.activeColumns.length;a++)q=id.activeColumns[a],q.visible!==!1&&(!r&&q.rerenderOnResize&&q.width!=g[a]&&(r=!0),id.activeColumns[a].width=g[a]);m(),Xc(!0),r&&(Wb(),yc())},q=function(){var a=new y,c=null;d.on("draginit",function(a){a.stopImmediatePropagation(),D()}).on("dragstart",function(d,e){var f=_(d);if(f&&(v(f.row,f.cell)&&(c=!0,d.stopImmediatePropagation()),c)){var g=bb(e.startX-b(this).offset().left,e.startY-b(this).offset().top);return e._range={end:g,start:g},a.show(new lc(g.row,g.cell))}}).on("drag",function(d,e){if(c){d.stopImmediatePropagation();var f=bb(d.pageX-b(this).offset().left,d.pageY-b(this).offset().top);v(f.row,f.cell)&&(e._range.end=f,a.show(new lc(e._range.start.row,e._range.start.cell,f.row,f.cell)),hd.options.activateSelection&&u(f.row,f.cell)&&Lc(cb(f.row,f.cell),!1))}}).on("dragend",function(b,d){c&&(c=!1,b.stopImmediatePropagation(),a.hide(),hd._event=b,b.shiftKey||O(),hd.selectCells(d._range.start.row,d._range.start.cell,d._range.end.row,d._range.end.cell,b.shiftKey),hd._event=null,hd.options.activateSelection&&bc())})},r=function(){d.on("dragstart",function(a,c){b(a.target).hasClass(Wd)&&(a.stopImmediatePropagation(),c._row=tb(b(a.target).parent()[0]),c._rowNode=id.nodes[c._row].rowNode,c._rowsBelow=[],b(c._rowNode).siblings().each(function(){var a=tb(this);a>c._row&&c._rowsBelow.push(this)}),b(c._rowsBelow).wrapAll('<div class="'+Vd+'"></div>'),c._container=b(c._rowsBelow).parent())}).on("drag",function(a,c){if(void 0!==c._row){var d=c._rowNode,e=id.rowPositions[c._row],f=e.height||hd.options.rowHeight;c._height=f+c.deltaY,c._height<5&&(c._height=5),b(d).height(c._height),b(d).css("line-height",c._height+hd.options.lineHeightOffset+"px"),c._container.css({marginTop:c._height-f+"px"})}}).on("dragend",function(a,c){void 0!==c._row&&(b(c._rowsBelow).unwrap(),Mc(c._row,c._height))})},s=function(a,b){a=a||0,0===a&&(id.indexById={},!b&&cd&&(id.rowPositions={0:{top:0,height:hd.options.rowHeight,bottom:hd.options.rowHeight}}));for(var c,d,e=a,f=id.rows.length;f>e;e++)c=id.rows[e],id.indexById[c[le]]=e,!b&&cd&&(d={top:id.rowPositions[e-1]?id.rowPositions[e-1].bottom-re:0},d.top+=0===e?0:1,c.height&&c.height!=hd.options.rowHeight&&(d.height=c.height),d.bottom=d.top+(d.height||hd.options.rowHeight),id.rowPositions[e]=d)},t=function(){if(cd){var a=i[0].scrollTop,b=ub(dd+a);ic=b-ub(a)}else ic=Math.floor(dd/(hd.options.rowHeight+1))},u=function(a,b){if(!hd.options.keyboardNavigation||a>=lb()||0>a||b>=id.activeColumns.length||0>b)return!1;var c=hd.collection.getItem(a);if("boolean"==typeof c.focusable)return c.focusable;var d=c.columns;return d&&d[id.activeColumns[b].id]&&"boolean"==typeof d[id.activeColumns[b].id].focusable?d[id.activeColumns[b].id].focusable:d&&d[b]&&"boolean"==typeof d[b].focusable?d[b].focusable:id.activeColumns[b].focusable},v=function(a,b){if(a>=lb()||0>a||b>=id.activeColumns.length||0>b)return!1;var c=hd.collection.getItem(a);if("boolean"==typeof c.selectable)return c.selectable;var d=c.columns&&(c.columns[id.activeColumns[b].id]||c.columns[b]);return d&&"boolean"==typeof d.selectable?d.selectable:id.activeColumns[b].selectable},x=function(a,b){return!(0>a||a>=lb()||0>b||b>=id.activeColumns.length)},y=function(){this.$el=null,this.show=function(a){this.$el||(this.$el=b('<div class="'+Sd+'"></div>').appendTo(d),this.$stats=b('<span class="'+Td+'"></span>').appendTo(this.$el));var c=db(a.fromRow,a.fromCell),e=db(a.toRow,a.toCell),f=parseInt(this.$el.css("borderBottomWidth"),10),g=parseInt(this.$el.css("borderLeftWidth"),10),h=parseInt(this.$el.css("borderRightWidth"),10),i=parseInt(this.$el.css("borderTopWidth"),10);if(c&&e){var j=e.right-c.left-g-h;this.$el.css({top:c.top,left:c.left,height:e.bottom-c.top-f-i,width:j}),j>200?this.$stats.show().html(["<strong>Selection:</strong> ",a.getCellCount()," cells"," <strong>From:</strong> ",a.fromRow+1,":",a.fromCell+1," <strong>To:</strong> ",a.toRow+1,":",a.toCell+1].join("")):this.$stats.hide()}return this.$el},this.hide=function(){this.$el&&this.$el.length&&vc(this.$el[0]),this.$el=null}},A=function(a){for(var b,c,d,e=[],f=[],g=0,h=a.top,i=a.bottom;i>=h;h++)if(b=id.nodes[h]){R(h),B(a,h),c=0;for(var j=hd.collection.getItem(h),k=j.columns,l=jb(h),m=0,n=id.activeColumns.length;n>m&&!(id.columnPosLeft[m]>a.rightPx);m++)if(d=b.cellColSpans[m],null===d||void 0===d){if(d=1,k){var o=k[id.activeColumns[m].id]||k[m];d=o&&o.colspan||1,"*"===d&&(d=n-m)}id.columnPosRight[Math.min(n-1,m+d-1)]>a.leftPx&&(zc(e,h,m,d,l),c++),m+=d>1?d-1:0}else m+=d>1?d-1:0;c&&(g+=c,f.push(h))}if(e.length){var p=document.createElement("div");p.innerHTML=e.join("");for(var q,r,s;null!==(q=f.pop())&&void 0!==q;)for(b=id.nodes[q];null!==(s=b.cellRenderQueue.pop())&&void 0!==s;)r=p.lastChild,b.rowNode.appendChild(r),b.cellNodesByColumnIdx[s]=r}},B=function(a,b){var c=0,d=id.nodes[b],e=[];for(var f in d.cellNodesByColumnIdx)if(d.cellNodesByColumnIdx.hasOwnProperty(f)){f=0|f;var g=d.cellColSpans[f];(id.columnPosLeft[f]>a.rightPx||id.columnPosRight[Math.min(id.activeColumns.length-1,f+g-1)]<a.leftPx)&&(!hd.active||b==hd.active.row&&f==hd.active.cell||e.push(f))}for(var h;null!==(h=e.pop())&&void 0!==h&&h;)d.rowNode.removeChild(d.cellNodesByColumnIdx[h]),delete d.cellColSpans[h],delete d.cellNodesByColumnIdx[h],id.postprocess[id.rows[b].id]&&delete id.postprocess[id.rows[b].i][id.activeColumns[h].id],c++},C=function(a){var b=hd.active&&"row"in hd.active?hd.active.row:null;for(var c in id.nodes)(c=parseInt(c,10))!==b&&(c<a.top||c>a.bottom)&&xc(c)},D=function(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(a){}else if(window.getSelection){var b=window.getSelection();b&&b.removeAllRanges&&b.removeAllRanges()}},H=function(){if(!hd.active||!ee)return!0;var a=jb(hd.active.row),c=id.activeColumns[hd.active.cell],d=function(){b(hd.active.node).removeClass(Pd).width(),b(hd.active.node).addClass(Pd),hd.trigger("validationerror",hd._event,{editor:ee,cellNode:hd.active.node,validationResults:f,row:hd.active.row,cell:hd.active.cell,column:c}),ee.focus()},e=function(a,b,c){var d=id.activeColumns[c];Zb(b,c)&&(ee.applyValue(a,d,ee.serializeValue()),$c(b),hd.trigger("change",hd._event,{row:b,cell:c,item:a}))};if(ee.isValueChanged()){var f=ee.validate();if(f.valid){if(a.__addRow){var g={data:{}};if(ee.applyValue(g,c,ee.serializeValue()),!g.data.id&&!g.id||g.id in id.indexById||g.data.id in id.indexById)return f={valid:!1,msg:"Unable to create a new item without a unique 'id' value."},d(),void 0;hd.add(g),hd.trigger("newrow",hd._event,{item:g,column:c})}else if("selection"==hd.options.editorType&&hd.selection)for(var h=0,i=hd.selection.length;i>h;h++)for(var j=hd.selection[h].fromRow,k=hd.selection[h].toRow;k>=j;j++)for(var l=hd.selection[h].fromCell,m=hd.selection[h].toCell;m>=l;l++)e(id.rows[j],j,l);else e(a,hd.active.row,hd.active.cell);return!0}return d(),!1}return cc(),!0},I=function(){var a;if(hd.selection&&("csv"==hd.options.clipboard?a=hd.selection[0].toCSV():"json"==hd.options.clipboard&&(a=JSON.stringify(hd.selection[0].toJSON()))),!a&&hd.active&&hd.active.node){var c=tb(hd.active.node.parentNode),d=ab(hd.active.node),e=id.rows[c],f=id.activeColumns[d];a=wb(e,f)}a&&b('<textarea class="'+nd+'"></textarea>').val(a).appendTo(hd.$el).focus().select().on("keyup",function(){vc(this)})},J=function(){h=b('<style type="text/css" rel="stylesheet"></style>').appendTo(b("head"));for(var a=hd.options.rowHeight-jd,c=["#"+Ee+" ."+Ud+"{height:"+a+"px;line-height:"+(a+hd.options.lineHeightOffset)+"px}"],d=0,e=id.activeColumns.length;e>d;d++)c.push("#"+Ee+" .l"+d+"{}"),c.push("#"+Ee+" .r"+d+"{}");h[0].appendChild(document.createTextNode(c.join("\n")))},K=function(){var a=[hd.NAME];hd.options.class&&a.push(hd.options.class),hd.$el=b('<div class="'+a.join(" ")+'" id="'+Ee+'"></div>'),g=b('<div class="'+Fd+'"></div>').appendTo(hd.$el),e=b('<div class="'+Gd+'"></div>').appendTo(g).width(ob()),i=b('<div class="'+be+'"></div>').appendTo(hd.$el),d=b('<div class="'+ce+'" tabindex="0"></div>').appendTo(i)},L=function(a){if(!a)throw new Error("Unable to create group because grouping object is missing.");if(void 0===a.column_id)throw new Error("Unable to create grouping object because 'column_id' is missing.");var c=eb(a.column_id),d=b.extend({collapsed:!0,column_id:c.id,comparer:function(a,b){for(var c=!0,d=0,e=hd.sorting.length;e>d;d++)if(hd.sorting[d].columnId==a.predef.column_id){c=hd.sorting[d].sortAsc;break}var f=gc(a.value,b.value);return c?f:-f},formatter:function(a){var b=["<strong>"+c.name+":</strong> ",null===a.value?"-empty-":a.value,' <span class="count">(<strong>'+a.count+"</strong> item"];return 1!==a.count&&b.push("s"),b.push(")</span>"),b.join("")},getter:function(a){return kb(a,c)},rows:[]},a);return d},E=function(a){var d,e,f,g,h,i,j,k,m,n,o,p,q,r,t,u=this,v=[],w=[],x=":|:",y=0,z=0,A={},B={},C=null,D=!0,E=[],F=0,G=null;return b.extend(this,Backbone.Events),this.items=[],this.filter=null,this.groups=[],this.length=0,this.initialize=function(){return!xe&&a.options.data&&this.reset(a.options.data),this},this.add=function(b,d){c.isArray(b)||(b=b?[b]:[]),d=d||{};var e,f,g=d.at,h=[];m(b),Ce=!0;for(var i=0,j=b.length;j>i;i++)if(e=b[i],f=this.get(e),f&&(f=f[1]),xe&&void 0!==g&&this.items[g+i].__placeholder&&(f=this.items[g+i]),f){if(!d.merge)throw["You are not allowed to add() items without a unique 'id' value. ","A row with id '"+f[le]+"' already exists."].join("");this.setItem(f[le],e)}else h.push(e);if(Ce=!1,h.length)if(a.options.emptyNotice&&this.items.length&&this.items[0].__alert&&this.remove(this.items[0][le]),!a.options.addRow||!(g&&g>this.items.length||null===g||void 0===g)||"__addRow"in h[0]||(g=this.items.length-1),null!==g&&void 0!==g)Array.prototype.splice.apply(this.items,[g,0].concat(h)),s(g>0?g-1:0);else{var k=this.items.length;Array.prototype.push.apply(this.items,h),s(k>0?k-1:0)}return d.silent||(d.forced?this.refresh():this.refreshDebounced()),this},this.collapseAllGroups=function(a){d(a,!0)},this.collapseGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(x)?f(b.split(x).length-1,b,!0):f(a.length-1,a.join(x),!0)},this.expandAllGroups=function(a){d(a,!1)},d=function(a,b){if(null===a||void 0===a)for(var c=0,d=u.groups.length;d>c;c++)E[c]={},u.groups[c].collapsed=b;else E[a]={},u.groups[a].collapsed=b;u.refresh(),xe&&!b&&pc()},f=function(a,b,c){E[a][b]=u.groups[a].collapsed^c,u.refresh(),xe&&!c&&pc()},this.expandGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(x)?f(b.split(x).length-1,b,!1):f(a.length-1,a.join(x),!1)},R=function(a){var c=id.nodes[a];if(c&&c.cellRenderQueue.length)for(var d=b(c.rowNode).children("."+md).last()[0];c.cellRenderQueue.length;){var e=c.cellRenderQueue.pop();c.cellNodesByColumnIdx[e]=d,d=d.previousSibling}},g=function(a,b,c){var d,e,f,h,i,j,k,m,n,o=[],p={},q=b?b.level+1:0,r=u.groups[q];r.rows=[];var s=function(s){var t=function(a){var c=new Hb,d=a?a.value:e;return c.collapsed=r.collapsed,a&&(c.count=a.count),c.value=d,c.level=q,c.predef=r,c.id="__group"+(b?b.id+x:"")+d,u.groups[q].rows.push(c),c};if(s)for(var v,w=0,y=s[q].groups.length;y>w;w++)v=s[q].groups[w],b&&v.parent!=b.value||(d=t(v),o.push(d),p[d.value]=d);for(i=0,j=a.length;j>i;i++)if(f=a[i],f instanceof l&&"__gridAggregate"==f.id)k=f;else if(f.__addRow)m=f;else if(f.__alert)n=f;else{if(f.__placeholder){for(var z=0,A=o.length;A>z;z++)if(o[z].count>o[z].grouprows.length){e=o[z].value;break}}else e="function"==typeof r.getter?r.getter(f):f[r.getter];d=p[e],d||(d=t(),o.push(d),p[e]=d),d.grouprows.push(f),xe||d.count++}if(q<u.groups.length-1){var B=function(a){d.groups=a};for(i=0,j=o.length;j>i;i++)h=o[i],d=h,h instanceof l||g(h.grouprows,h,B)}s||o.sort(u.groups[q].comparer),n&&o.push(n),m&&o.push(m),k&&o.push(k),c(o)};xe?sc(function(a){s(a)}):s()},h=function(b,d){d=d||0;for(var e,f=u.groups[d],g=E[d],i=b.length,j=function(a){return a instanceof l};i--;)e=b[i],e.collapsed=f.collapsed^g[e.id],e.title=f.formatter?f.formatter(e):e.value,e.groups&&(h(e.groups,d+1),e.grouprows=a.options.nestedAggregators?c.filter(e.grouprows,j):[])},i=function(b,c){c=c||0;for(var d,e,f=[],g=0,h=0,j=b.length;j>h;h++)if(e=b[h],f[g++]=e,!e.collapsed){if(d=e.groups?i(e.groups,c+1):e.grouprows,!d)continue;for(var k=0,m=d.length;m>k;k++)f[g++]=d[k];a.options.nestedAggregators&&e.groups&&1===e.grouprows.length&&e.grouprows[0]instanceof l&&(f[g++]=e.grouprows[0])}return f},j=function(a){if(u.filter&&!xe){var b=q,c=r;B.isFilterNarrowing?w=b(w):B.isFilterExpanding?w=c(a,v):B.isFilterUnchanged||(w=b(a))}else w=z?a:a.concat();t(w);var d;return z?(w.length<y*z&&(y=Math.floor(w.length/z)),d=w.slice(z*y,z*y+z)):d=w,{totalRows:w.length,rows:d}},this.getItem=function(a){return id.rows[a]},this.get=function(a){if(null===a)return void 0;var b=a;if("object"==typeof a&&(b=a[le]||a.data&&a.data[le],null===b||void 0===b))return null;var d=function(a){for(var e,f=0,g=a.length;g>f;f++){if(a[f].id==b)return[f,a[f]];if(a[f].rows&&(e=d(c.values(a[f].rows))))return e}return null}.bind(this);return d(this.items)},k=function(a,b){var c,d,e,f=[],g=0,h=b.length;B&&B.ignoreDiffsBefore&&(g=Math.max(0,Math.min(b.length,B.ignoreDiffsBefore))),B&&B.ignoreDiffsAfter&&(h=Math.min(b.length,Math.max(0,B.ignoreDiffsAfter)));for(var i=g,j=a.length;h>i;i++)i>=j?f[f.length]=i:(c=b[i],d=a[i],e=c&&c.__nonDataRow||d&&d.__nonDataRow,c&&d&&(c instanceof Hb&&!(d instanceof Hb)||!(c instanceof Hb)&&d instanceof Hb||u.groups.length&&e&&c&&c instanceof Hb&&c[le]!=d[le]||c&&c instanceof Hb&&c.collapsed!=d.collapsed||c&&c instanceof Hb&&c.count!=d.count||e&&(c instanceof l||d instanceof l)||c&&c[le]!=d[le]||G&&G[c[le]])&&(f[f.length]=i));return f},this.insertEmptyAlert=function(a){var c=new qe({__alert:!0,id:"-empty-alert-message-"}),d={selectable:!1,focusable:!1,"class":ld,columns:{0:{colspan:"*",formatter:function(){return pb("empty.default")},editor:null}}};if(a instanceof Backbone.Collection){var e=new a.model(c);b.extend(e,d),a.add(e)}else b.extend(c,d),a.push(c)},m=function(b){var c,d,e,f;for(c=0,d=b.length;d>c;c++){if(f=b[c],void 0===f[le]||null===f[le])throw"Each data item must have a unique 'id' key. The following item is missing an 'id': "+JSON.stringify(f);if(f.rows)for(var g in f.rows){if(e=f.rows[g],!cd&&e.height&&e.height!=a.options.rowHeight){cd=!0;break}if(e.columns&&!fe)for(var h in e.columns){if(fe)break;e.columns[h].postprocess&&(fe=!0)}}if(!cd&&f.height&&f.height!==a.options.rowHeight&&(cd=!0),f.columns&&!fe)for(var i in f.columns){if(fe)break;f.columns[i].postprocess&&(fe=!0)}}return b},n=function(){var a,b,c,d,e,f,g,h=w;for(b=0,c=h.length;c>b;b++)if(a=h[b],!(a instanceof qe))for(f in id.aggregatorsByColumnId){d=null;for(g in id.aggregatorsByColumnId[f])id.aggregatorsByColumnId[f][g].active&&(null===d?d=id.aggregatorsByColumnId[f][g]:id.aggregatorsByColumnId[f][g].active=!1);if(e=Object.keys(id.aggregatorsByColumnId[f]),null===d&&e.length&&(d=id.aggregatorsByColumnId[f][e[0]],d.active=!0),null!==d&&!d._processed){if("function"!=typeof d.process)throw new Error('The column aggregator for "'+f+"\" is missing a valid 'process' function.");d.process(a)}}for(f in id.aggregatorsByColumnId)for(g in id.aggregatorsByColumnId[f])id.aggregatorsByColumnId[f].active&&(id.aggregatorsByColumnId[f]._processed=!0);var i=new l(id.aggregatorsByColumnId);i.id="__gridAggregate",h.push(i)},o=function(a){var b,c,d,e,f,g,h,i,j;for(b=0,c=a.length;c>b;b++)if(d=a[b],d instanceof Hb){d.aggregators={};for(g in id.aggregatorsByColumnId){f=eb(g),d.aggregators[g]={};for(j in id.aggregatorsByColumnId[g])d.aggregators[g][j]=new f.aggregators[j].fn(f),"function"==typeof d.aggregators[g][j].reset&&d.aggregators[g][j].reset(),id.aggregatorsByColumnId[g][j].active&&(d.aggregators[g][j].active=!0)}for(h=0,i=a[b].grouprows.length;i>h;h++)if(e=a[b].grouprows[h],!(e instanceof qe))for(g in d.aggregators)for(j in d.aggregators[g])d.aggregators[g][j].process(e);var k=new l(d.aggregators);k.id="__gridAggregate-group-"+d.id,d.grouprows.push(k),d.groups&&d.groups.length&&o(d.groups)}},p=function(a,b){C=null,(B.isFilterNarrowing!=A.isFilterNarrowing||B.isFilterExpanding!=A.isFilterExpanding)&&(v=[]);var c=j(a);F=c.totalRows;var d=c.rows;Object.keys(id.aggregatorsByColumnId).length&&n();var e=function(a,b){if(a.rows)for(var c in a.rows)a.rows[c].collapsed||(a.rows[c].parent=a,b.push(a.rows[c]),e(a.rows[c],b))},f=function(){for(var a=[],c=0,f=d.length;f>c;c++)a.push(d[c]),e(d[c],a);var g=k(id.rows,a);id.rows=a,g.length&&s(0),b(g)},l=[];u.groups.length&&u.items.length&&!(u.items instanceof Backbone.Collection?u.items.first().get("__alert"):u.items[0].__alert)?g(d,null,function(a){l=a,l.length&&(Object.keys(id.aggregatorsByColumnId).length&&o(l),h(l),d=i(l)),f()}):f()},this.refresh=function(){if(!Ce&&!a.destroyed){var b,c=id.rows.length,d=function(){G=null,A=B,B={},this.length=id.rows.length,c!=id.rows.length&&_c(),b.length>0&&(Yb(b),yc())}.bind(this);p(this.items,function(a){b=a,z&&y*z>F?(y=Math.max(0,Math.ceil(F/z)-1),p(this.items,function(a){b=a,d()})):d()}.bind(this))}},this.refreshDebounced=c.debounce(this.refresh,10),this.remove=function(a){if(void 0===a||null===a)throw new Error("Unable to delete collection item. Invalid 'id' supplied.");var b=id.indexById[a];if(null===b||void 0===b)throw new Error(["Unable to remove row '",a,"' because no such row could be found in the grid."].join(""));this.items instanceof Backbone.Collection?this.items.remove(a):this.items.splice(this.get(a)[0],1),delete id.indexById[a],delete id.rowPositions[b],s(b),this.refresh()},this.reset=function(a,b){a||(a=[]),Ce=!0,b&&(id.rows=[]),id.postprocess={},a instanceof Backbone.Collection&&(a=a.models.concat()),m(a),this.items=w=t(a),b&&s(),Ce=!1,this.refresh()},this.setGrouping=function(c){if(!a.options.groupable)throw new Error('Cannot execute "setGrouping" because "options.groupable" is disabled.');if(c=c||[],!b.isArray(c))throw new Error("Unable to set grouping because given options are not an array. Given: "+JSON.stringify(c));c.length||(E=[]),id.remoteGroups&&(id.remoteGroups=null);var d,e,f,g=[];for(d=0,e=c.length;e>d;d++){if(f=eb(c[d].column_id),void 0===f)throw new Error('Cannot add grouping for column "'+c[d].column_id+'" because no such column could be found.');if(f.groupable===!1)throw new Error('Cannot add grouping for column "'+f.id+'" because "options.groupable" is disabled for that column.');E[d]||(E[d]={}),g.push(L(c[d]))}this.groups=g,a.sorting=ec(a.sorting),xe&&(this.length=this.remote_length,W()),this.refresh(),cd&&Fc(),xe&&0===g.length&&pc()},this.setItem=function(b,d){var e=id.indexById[b],f=this.get(b);if(void 0===e&&null===f)throw new Error("Unable to update item (id: "+b+"). Invalid or non-matching id");if(a.options.data instanceof Backbone.Collection){if(!(d instanceof Backbone.Model))throw new Error("Sorry, Backbone.Collection data sets must be given a valid Backbone.Model in the setItem() method.");if(d.id!==b&&!id.rows[e].__placeholder)throw new Error("Sorry, but Backbone does not support changing a model's id value, and as a result, this is not supported in Doby Grid either.")}if(id.postprocess[b]&&(delete id.postprocess[b],f[1].rows))for(var g in f[1].rows)id.postprocess[f[1].rows[g].id]&&delete id.postprocess[f[1].rows[g].id];id.rows[e]=d,b!==d.id&&delete id.indexById[b],id.indexById[d.id]=e,(void 0===d.id||null===d.id)&&(d.id=b),m([d]),this.items[f[0]]=d,d.rows&&Yb(c.range(e,id.rows.length)),G||(G={}),G[b]=!0,b!==d.id&&(G[d.id]=!0),this.refreshDebounced()},this.sort=function(a,b){D=b,e=a,b===!1&&this.items.reverse(),this.items.sort(a),b===!1&&this.items.reverse(),s(null,!0),this.refresh()},q=function(a){for(var b=[],c=0,d=0,e=a.length;e>d;d++)(a[d].__nonDataRow||u.filter(a[d]))&&(b[c++]=a[d]);return b},r=function(a,b){for(var c,d=[],e=0,f=0,g=a.length;g>f;f++)c=a[f],b[f]?d[e++]=c:(a[f].__nonDataRow||u.filter(c))&&(d[e++]=c,b[f]=!0);return d},t=function(b){return a.options.emptyNotice&&!b.length&&u.insertEmptyAlert(b),b},this.initialize()},M=function(a){return this.initialize=function(){this.loadValue(a.item);var c=this.currentValue;(null===c||void 0===c)&&(c=""),this.$input=b('<input type="text" class="'+zd+'" value="'+c+'"/>').appendTo(a.cell).on("keydown",function(a){if([9,13,33,34,35,36].indexOf(a.which)>=0)return a.preventDefault(),void 0;if(27!=a.which){var c=$(this);(null===c&&38!=a.which&&40!=a.which||c>0&&37===a.which||c<b(this).val().length&&39===a.which)&&a.stopImmediatePropagation()}})},this.applyValue=function(a,b,c){"id"in a||"id"!=b.field||(a.id=c),a instanceof Backbone.Model?a.set(b.field,c):a.data[b.field]=c},this.cancel=function(){},this.destroy=function(){this.$input.remove()},this.focus=function(){this.$input.focus().select()},this.getValue=function(){return this.$input.val()},this.isValueChanged=function(){return!(""===this.$input.val()&&null===this.currentValue)&&this.$input.val()!=this.currentValue},this.loadValue=function(b){if(!b||!b.data)return null;var c=b instanceof Backbone.Model?b.get(a.column.field):b.data[a.column.field];return this.currentValue=c||"",this.currentValue},this.serializeValue=function(){return this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.validate=function(){var b=this.getValue();if(a.column.validator){var c=a.column.validator(b);if(!c.valid)return c}return{valid:!0,msg:null}},this.initialize()},N=function(a,b,c){return void 0===c||null===c?"":(c+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},O=function(a,b){if(hd.selection){for(var c=void 0!==a&&null!==a&&void 0!==b&&null!==b,d=0,e=hd.selection.length;e>d;d++)c?hd.selection[d].contains(a,b)&&hd.selection[d].deselect(a,b):hd.selection[d].deselect();
if(c||(hd.selection=null),hd.selection){var f=[];for(d=0,e=hd.selection.length;e>d;d++)hd.selection[d].fullyExcluded()||f.push(hd.selection[d]);hd.selection=0===f.length?null:f}}},this.destroy=function(){if(this.destroyed)return console.warn("Doby Grid instance has already been destroyed. You do not need to manually call destroy()."),void 0;this.destroyed=!0,this.stopListening(),this.options.reorderable&&e.filter(":ui-sortable").sortable("destroy"),this.$el&&this.$el.length&&(this.$el.off(),this.$el.remove(),vc(this.$el[0])),this.$el=null,uc(),e&&e.length&&(e.off(),vc(e[0])),e=null,b(window).off("resize",Qb);for(var a=[ie,he,ze],c=0,d=a.length;d>c;c++)a[c]&&(clearTimeout(a[c]),a[c]=null);for(var f in id.nodes)vc(id.nodes[f].rowNode);this.collection.items=null,this.options.data=null,id=null,b(V).remove(),V=null},P=function(a){a&&a.jquery&&a.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})},Q=function(a,c){return this.open=!1,this.initialize=function(){this.$parent=c.parent||b(a.currentTarget),this.$el=c.menu,this.id=[Ee,rd,c.id].join("_");var d=null;this.$parent.data(rd)?(d=this.$parent.data(rd).filter(function(a){return a.id==this.id}.bind(this)),d&&(d=d[0])):this.$parent.data(rd,[]),d&&d.open?d.hide():(this.$el.attr("id",this.id),this.$el.addClass(["off",rd].join(" ")),this.show());var e;e=function(c){c.target!=a.target&&(this.hide(),b(document).off("click",e),b(document).off("context",e))}.bind(this),b(document).on("click",e),b(document).on("contextmenu",e);var f;return f=function(a){27==a.keyCode&&(this.hide(),b(document).off("keydown",f))}.bind(this),b(document).one("keydown",f),this},this.position=function(){var c=a.clientY,d=a.clientX,e=this.$el.outerWidth(),f=this.$el.outerHeight(),g=d+e,h=c+f,i=b(document.body),j=i.width(),k=i.height();g>j&&(d-=e),g+e>j&&this.$el.addClass(xd),h>k&&(c-=f),this.$el.css({left:Math.max(d,0),top:Math.max(c,0)});var l,m,n,o,p,q;this.$el.children("."+sd+":first").find("."+sd).each(function(){l=b(this).position(),m=b(this).offset(),n=b(this).outerHeight(),o=b(this).outerWidth(),q=b(this).parent().outerWidth(),p=m.left+q-Math.min(l.left,0)+o>j?"drop-left":"drop-right",b(this).addClass(p),"drop-left"==p&&b(this).css("left",-o+"px"),b(this).addClass(m.top-Math.min(l.top,0)+n>k?"drop-up":"drop-down")})},this.initialize()},Q.prototype.show=function(){if(!this.open){this.$el.appendTo(document.body),this.position();var a=this.$parent.data(rd);a.push(this),this.$parent.data(rd,a),setTimeout(function(){this.$el.removeClass("off")}.bind(this),150),this.open=!0}},Q.prototype.hide=function(){if(this.open&&this.$parent&&this.$parent.data(rd)){var a=this.$parent.data(rd).filter(function(a){return a!=this}.bind(this));this.$parent.data(rd,a),this.$el.addClass("off"),setTimeout(function(){vc(this.$el[0])}.bind(this),150),this.open=!1}},S=function(a){var b=a.sortCols;return xe&&!mc()?(hd.collection.length=hd.collection.remote_length,W(),hd.collection.refresh(),hd.collection.groups.length?tc():pc(),void 0):(hd.collection.sort(function(a,c){var d,e,f,g,h,i,j=0;if(a instanceof l)return 1;if(c instanceof l)return-1;for(var k=0,m=b.length;m>k;k++)if(d=b[k].sortCol,e=d.field,f=b[k].sortAsc?1:-1,g=kb(a,d),h=kb(c,d),"function"==typeof d.comparator){if(i=d.comparator(g,h)*f,0!==i)return i}else{if(null===g&&null===h)continue;if(null===g)return 1;if(null===h)return-1;if(i=gc(g,h)*f,0!==i)return i}return j}),void 0)},this.export=function(a,b){var c=["csv","html"];if(c.indexOf(a)<0)throw new Error('Sorry, "'+a+'" is not a supported format for export.');b=b||function(){};var d=function(){var c,d,e,f,g,h,i=[];"html"===a&&i.push("<table><thead><tr>");var j=[];for(c=0,d=id.activeColumns.length;d>c;c++)h=id.activeColumns[c].name||"","csv"===a?(h=h.replace(/\"/g,'"'),j.push(['"',h,'"'].join(""))):"html"===a&&(j.push("<th>"),j.push(h),j.push("</th>"));for("csv"===a?i.push(j.join(",")):"html"===a&&(i.push(j.join("")),i.push("</tr></thead><tbody>")),c=0,d=this.collection.items.length;d>c;c++)if(!(this.collection.items[c]instanceof qe)){for(e=[],"html"===a&&e.push("<tr>"),f=0,g=id.activeColumns.length;g>f;f++)h=wb(this.collection.items[c],id.activeColumns[f]),"csv"===a?(h=null!==h&&void 0!==h?h.toString().replace(/\"/g,'"'):"",e.push(['"',h,'"'].join(""))):"html"===a&&(e.push("<td>"),e.push(h),e.push("</td>"));"csv"===a?i.push(e.join(",")):"html"===a&&(e.push("</tr>"),i.push(e.join("")))}"html"===a&&i.push("</tbody></table>"),"csv"===a?i=i.join("\n"):"html"===a&&(i=i.join("")),b(i)}.bind(this),e=xe&&!mc()?confirm("Are you sure you want to export all data? This will require a full data fetch on the server."):!0;return e&&(xe?qc(function(){d()}):d()),this},this.filter=function(a){if(b.isArray(a)&&(this.collection.filterset=a),"function"==typeof a||xe)this.collection.filter=a;else{if(!b.isArray(a))throw new Error("Cannot apply filter to grid because given filter must be an array or a function, but given "+typeof a+".");this.collection.filter=function(b){for(var c,d,e,f,g=!0,h=0,i=a.length;i>h;h++){if(c=a[h],3!==c.length)throw new Error("Cannot apply filter because the give filter set contains an invalid filter item: "+JSON.stringify(c)+".");if(d=eb(c[0]),!d)throw new Error('Unable to filter by "'+c[0]+'" because no such columns exists in the grid.');switch(e=kb(b,d),c[1]){case"=":g=e==c[2];break;case"!=":g=e!==c[2];break;case">":f=null===e?void 0:e,g=f>c[2];break;case"<":f=null===e?void 0:e,g=f<c[2];break;case">=":f=null===e?void 0:e,g=f>=c[2];break;case"<=":f=null===e?void 0:e,g=f<=c[2];break;case"~":f=null===e?"":e,g=-1!==f.toString().search(c[2].toString());break;case"!~":f=null===e?"":e,g=-1===f.toString().search(c[2].toString());break;case"~*":f=null===e?"":e,g=-1!==f.toString().toLowerCase().search(c[2].toString().toLowerCase());break;case"!~*":f=null===e?"":e,g=-1===f.toString().toLowerCase().search(c[2].toString().toLowerCase());break;default:throw new Error('Unable to filter by "'+c[0]+'" because "'+c[1]+'" is not a valid operator.')}if(!g)break}return g}}if(xe)oc(function(){hd.collection.groups&&hd.collection.groups.length?tc():pc()});else{for(var c in id.aggregatorsByColumnId)for(var d in id.aggregatorsByColumnId[c])id.aggregatorsByColumnId[c][d]._processed=!1,"function"==typeof id.aggregatorsByColumnId[c][d].reset&&id.aggregatorsByColumnId[c][d].reset();this.collection.refresh()}return this},T=function(a){for(var b=0;b<id.activeColumns.length;){if(u(a,b))return b;b+=ib(a,b)}return null},U=function(a){for(var b=0,c=null;b<id.activeColumns.length;)u(a,b)&&(c=b),b+=ib(a,b);return c},W=function(){hd.collection.items=[],hd.options.data instanceof Backbone.Collection&&hd.options.data.reset(null,{silent:!0});var a,b,c,d;for(c=0,d=hd.collection.length;d>c;c++)a="placeholder-"+c,b=new kc,b.id=a,hd.collection.items.push(b);if(hd.collection.groups.length)for(c=0,d=hd.collection.groups.length;d>c;c++)for(var e=0,f=hd.collection.groups[c].rows.length;f>e;e++)hd.collection.groups[c].rows[e].grouprows=[]},this.get=function(a){var b=this.collection.get(a);return b&&(b=b[1]),b},X=function(){return hd.active&&hd.active.node?{row:hd.active.row,cell:hd.active.cell}:null},Y=function(){window.maxSupportedCssHeight=window.maxSupportedCssHeight||qb(),window.scrollbarDimensions=window.scrollbarDimensions||vb()},Z=function(){var a,b,c=gd-(fd?window.scrollbarDimensions.width:0),d=0;for(a=0,b=id.activeColumns.length;b>a;a++)d+=id.activeColumns[a].width-hd.options.columnSpacing+(hd.options.fullWidthRows?2:0);return hd.options.fullWidthRows?Math.max(d,c):d+2*b},$=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else{if(a.selectionStart!==a.selectionEnd)return null;(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart)}return b},ab=function(a){var b=/l\d+/.exec(a.className);if(!b)throw"getCellFromNode: cannot get cell - "+a.className;return parseInt(b[0].substr(1,b[0].length-1),10)},bb=function(a,b){for(var c=ub(b),d=0,e=0,f=0,g=id.activeColumns.length;g>f&&a>e;f++)e+=id.activeColumns[f].width,d++;return 0>d&&(d=0),{cell:d-1,row:c}},cb=function(a,b){if(id.nodes[a]){R(a);var c=b;if(!id.nodes[a].cellColSpans[b])for(var d=0,e=b;e>=d;d++)id.nodes[a].cellColSpans[d]&&id.nodes[a].cellColSpans[d]>1&&(c-=id.nodes[a].cellColSpans[d]-1);return c=0>c?0:c,id.nodes[a].cellNodesByColumnIdx[c]}return null},db=function(a,b){if(!x(a,b))return null;var c,d;if(cd){var e=id.rowPositions[a];c=e.top-1,d=c+(e.height||hd.options.rowHeight)+2}else c=hd.options.rowHeight*a-re+a-1,d=c+hd.options.rowHeight+2;for(var f=-1,g=0;b>g;g++)f+=id.activeColumns[g].width+1;var h=f+id.activeColumns[b].width+2;return{bottom:d,left:f,right:h,top:c}},_=function(a){var c=b(a.target).closest("."+md,d);if(!c.length)return null;var e=tb(c[0].parentNode),f=ab(c[0]);return null===e||null===f?null:{row:e,cell:f}},ib=function(a,b){var c=hd.collection.getItem(a);if(!c.columns)return 1;var d=c.columns[id.activeColumns[b].id]||c.columns[b],e=d&&d.colspan;return e="*"===e?id.activeColumns.length-b:e||1},eb=function(a){return c.findWhere(hd.options.columns,{id:a})},fb=function(a){if(!Tc){var b,c,d=document.styleSheets;for(b=0,c=d.length;c>b;b++)if((d[b].ownerNode||d[b].owningElement)==h[0]){Tc=d[b];break}if(!Tc)throw new Error("Cannot find stylesheet.");F=[],G=[];var e,f,g=Tc.cssRules||Tc.rules;for(b=0;b<g.length;b++){var i=g[b].selectorText;e=new RegExp(/\.l\d+/).exec(i),e?(f=parseInt(e[0].substr(2,e[0].length-2),10),F[f]=g[b]):(e=new RegExp(/\.r\d+/).exec(i),e&&(f=parseInt(e[0].substr(2,e[0].length-2),10),G[f]=g[b]))}}return{left:F[a],right:G[a]}},gb=function(a){var c=e.children(),d=b(c[a]),f=d.width(),g=parseInt(d.css("paddingLeft"),10)+parseInt(d.css("paddingRight"),10),h=[],i=d.children("."+pd+":first");i.css("overflow","visible"),d.width("auto");var j=d.width()+g+1;i.css("overflow",""),d.width(f),h.push(j);var k,l="r"+a;for(var m in id.nodes)if(!(id.rows[m].columns&&id.rows[m].columns[a]&&id.rows[m].columns[a].colspan&&1!==id.rows[m].columns[a].colspan)&&(k=b(id.nodes[m].cellNodesByColumnIdx[a]),0===k.length&&(k=b(id.nodes[m].rowNode).children(".l"+a)),0!==k.length)){k.removeClass(l);var n=k.outerWidth();h.indexOf(n)<0&&h.push(n),k.addClass(l)}return Math.max.apply(null,h)},hb=function(a){var c=b(a.target).closest("."+Hd+":not(."+Rd+")");if(!c.length){var d=_(a);return d?id.activeColumns[d.cell]:null}var e=c&&c.length?c.attr("id").replace(Ee,""):null;return e?eb(e):null},jb=function(a){return hd.collection.getItem?hd.collection.getItem(a):hd.collection[a]},kb=function(a,b){return b.dataExtractor?b.dataExtractor(a,b):hd.options.dataExtractor?hd.options.dataExtractor(a,b):a instanceof Backbone.Model?a.get(b.field):a instanceof Hb?a.value:a.data?a.data[b.field]:null},lb=function(){return hd.collection?hd.collection.length:0},mb=function(a,b){var c=id.activeColumns[b],d=hd.collection.getItem(a),e=d.columns;return e&&e[c.id]&&void 0!==e[c.id].editor?e[c.id].editor:e&&e[b]&&void 0!==e[b].editor?e[b].editor:c.editor||hd.options.editor||M},nb=function(a,b){var c=hd.collection.getItem(a),d=c.columns&&(c.columns[b.id]||c.columns[id.columnsById[b.id]]),e=c.formatter?c.formatter.bind(c):null||d&&d.formatter||b.formatter||hd.options.formatter||N;return e.bind(hd)},ob=function(){for(var a=0,b=0,c=id.activeColumns.length;c>b;b++)a+=id.activeColumns[b].width+1;return a+=window.scrollbarDimensions.width,Math.max(a,gd)+1e3},pb=function(a,b){b=b||{};var d=hd.options.locale;if(c.each(a.split("."),function(a){d=d[a]}),!d)throw new Error('Doby Grid does not have a locale string defined for "'+a+'"');return c.template(d,b,{interpolate:/\{\{(.+?)\}\}/gim})},qb=function(){for(var a,c=1e6,d=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,e=b('<div style="display:none"></div>').appendTo(document.body);;){if(a=2*c,e.css("height",a),a>d||e.height()!==a)break;c=a}return vc(e[0]),c},rb=function(a,b){var c,d=zb(a,b),e=3;return c=cd?Math.round(ub(dd)):Math.round(dd/hd.options.rowHeight),-1==Fe?(d.top-=c,d.bottom+=e):1==Fe?(d.top-=e,d.bottom+=c):(d.top-=e,d.bottom+=e),d.top=Math.max(0,d.top),d.bottom=Math.min(lb()-1,d.bottom),d.leftPx-=gd,d.rightPx+=gd,d.leftPx=Math.max(0,d.leftPx),d.rightPx=Math.min(w,d.rightPx),d},sb=function(a){var c=b(a.target).closest("."+Ud,d);return c.length?tb(c[0]):null},tb=function(a){for(var b in id.nodes)if(id.nodes[b].rowNode===a)return 0|b;return null},ub=function(a){if(!cd)return Math.floor((a+re)/(hd.options.rowHeight+1));var b,c,d,e=0,f=id.rows.length;if(f){for(d=0;f>d;d++)b=id.rowPositions[d],b.top<=a&&b.bottom>=a&&(e=d);return c=id.rowPositions[f-1],a>c.bottom&&(e=f-1),e}},vb=function(){var a="position:absolute;top:-10000px;left:-10000px;width:100px;height:100px;overflow:scroll",c=b("<div style='"+a+"'></div>").appendTo(b(document.body)),d={width:c.width()-c[0].clientWidth,height:c.height()-c[0].clientHeight};return vc(c[0]),d},wb=function(a,b){return"function"==typeof a.exporter?a.exporter(b,a).toString():b.exporter&&"function"==typeof b.exporter?b.exporter(b,a).toString():kb(a,b)},xb=function(a){var c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=0;return b.each(c,function(b,c){d+=parseFloat(a.css(c))||0}),d},yb=function(){return parseFloat(b.css(hd.$el[0],"height",!0))-parseFloat(b.css(hd.$el[0],"paddingTop",!0))-parseFloat(b.css(hd.$el[0],"paddingBottom",!0))-parseFloat(b.css(g[0],"height"))-xb(g)},zb=function(a,b){(void 0===a||null===a)&&(a=Be),(void 0===b||null===b)&&(b=Ae);var c,d;return cd?(c=Math.floor(ub(a+re)),d=Math.ceil(ub(a+re+dd))):(c=ub(a),d=ub(a+dd)+1),{top:c,bottom:d,leftPx:b,rightPx:b+gd}},Ab=function(a,b,c){if(ne&&u(a,b)){Gc(a,b,!1);var d=cb(a,b);Lc(d,c||a===lb()||hd.options.autoEdit)}},Bb=function(a,b,c){for(var d,e=lb();;){if(++a>=e)return null;for(d=b=0;c>=b;)d=b,b+=ib(a,b);if(u(a,d))return{row:a,cell:d,posX:c}}},Cb=function(a,b){if(0>=b)return null;var c=T(a);if(null===c||c>=b)return null;for(var d,e={row:a,cell:c,posX:c};;){if(d=Fb(e.row,e.cell,e.posX),!d)return null;if(d.cell>=b)return e;e=d}},Db=function(a,b,c){if(null===a&&null===b&&(a=b=c=0,u(a,b)))return{row:a,cell:b,posX:b};var d=Fb(a,b,c);if(d)return d;for(var e=null,f=lb();++a<f;)if(e=T(a),null!==e)return{row:a,cell:e,posX:e};return null},Eb=function(a,b,c){if(null===a&&null===b&&(a=lb()-1,b=c=id.activeColumns.length-1,u(a,b)))return{row:a,cell:b,posX:b};for(var d,e;!d&&!(d=Cb(a,b,c));){if(--a<0)return null;b=0,e=U(a),null!==e&&(d={row:a,cell:e,posX:e})}return d},Fb=function(a,b){if(b>=id.activeColumns.length)return null;do b+=ib(a,b);while(b<id.activeColumns.length&&!u(a,b));return b<id.activeColumns.length?{row:a,cell:b,posX:b}:null},Gb=function(a,b,c){for(var d;;){if(--a<0)return null;for(d=b=0;c>=b;)d=b,b+=ib(a,b);if(u(a,d))return{row:a,cell:d,posX:c}}},Hb=function(){this.count=0,this.groups=null,this.id=null,this.level=0,this.grouprows=[],this.selectable=!1,this.title=null,this.value=null},Hb.prototype=new qe,Hb.prototype.class=function(){var a=this.collapsed?od:Ad;return[Bd,Dd,a].join(" ")},Hb.prototype.columns={0:{colspan:"*",formatter:function(a,b,c,d,e){var f=15*e.level;return[f?'<span style="margin-left:'+f+'px">':"",'<span class="icon"></span>','<span class="'+Cd+'">',e.title,"</span>",f?"</span>":""].join("")}}},Hb.prototype.toString=function(){return"Group"},Jb=function(a){var c=_(a);if(c&&null!==c.row&&void 0!==c.row&&(null===ee||!hd.active||hd.active.row!=c.row||hd.active.cell!=c.cell)){var d=jb(c.row);if(d&&d instanceof Hb){var e=b(a.target).hasClass(Dd)||b(a.target).closest("."+Dd).length;if(e)return d.collapsed?hd.collection.expandGroup(d[le]):hd.collection.collapseGroup(d[le]),a.stopImmediatePropagation(),a.preventDefault(),void 0}if(c&&(hd.trigger("click",a,{row:c.row,cell:c.cell,item:d}),!a.isImmediatePropagationStopped()&&u(c.row,c.cell))){if(hd.options.shiftSelect&&a.shiftKey&&hd.active&&(O(),hd.selectCells(hd.active.row,hd.active.cell,c.row,c.cell)),hd.options.ctrlSelect&&(a.ctrlKey||a.metaKey)&&hd.active)return $b(c.row,c.cell)?(O(c.row,c.cell),void 0):(hd.selection||hd.selectCells(hd.active.row,hd.active.cell,hd.active.row,hd.active.cell,!0),hd.selectCells(c.row,c.cell,c.row,c.cell,!0),void 0);Ic(c.row,!1),Lc(cb(c.row,c.cell))}}},Kb=function(a){var c=b(a.target).closest("."+md,d);if(0!==c.length&&(hd.options.deactivateOnRightClick&&hd.active&&hd.activate(),!hd.active||hd.active.node!==c[0]||null===ee)){var e=hb(a),f=_(a)||{};hd.trigger("contextmenu",a,{cell:null!==f.cell&&void 0!==f.cell?f.cell:null,column:e,row:null!==f.row&&void 0!==f.row?f.row:null})}},Lb=function(a){var b=_(a);!b||null!==ee&&hd.active&&hd.active.row==b.row&&hd.active.cell==b.cell||(hd.trigger("dblclick",a,{row:b.row,cell:b.cell}),a.isImmediatePropagationStopped()||hd.options.editable&&Ab(b.row,b.cell,!0))},Nb=function(a){var b=hb(a);b&&hd.trigger("headerclick",a,{column:b})},Mb=function(a){var b=hb(a);hd.trigger("headercontextmenu",a,{column:b})},Ob=function(a){hd.active&&hd.trigger("keydown",a,{row:hd.active.row,cell:hd.active.cell});var b=a.isImmediatePropagationStopped();if(this._event=a,b||(67!=a.which||!a.ctrlKey&&!a.metaKey||a.altKey||a.shiftKey?a.shiftKey||a.altKey||a.ctrlKey?9!=a.which||!a.shiftKey||a.ctrlKey||a.altKey||(hd.options.editable&&ee?H()&&(b=hc("prev")):b=hc("prev")):27==a.which?hd.options.editable&&ee?(ee.cancel(),cc(),d.focus(),b=!0):hd.selection?O():hd.active&&hd.activate():34==a.which?(Hc(1),b=!0):33==a.which?(Hc(-1),b=!0):36==a.which?(hd.scrollToRow(0),b=!0):35==a.which?(hd.scrollToRow(hd.collection.items.length-1),b=!0):37==a.which?hd.options.editable&&ee?H()&&(b=hc("left")):b=hc("left"):39==a.which?hd.options.editable&&ee?H()&&(b=hc("right")):b=hc("right"):38==a.which?hd.options.editable&&ee?H()&&(b=hc("up")):b=hc("up"):40==a.which?hd.options.editable&&ee?H()&&(b=hc("down")):b=hc("down"):9==a.which?hd.options.editable&&ee?H()&&(b=hc("next"),d.focus()):b=hc("next"):13==a.which&&(hd.options.editable&&ee?H()&&(b=hc("down")):b=hc("down")):I()),this._event=null,b){a.stopPropagation(),a.preventDefault();try{a.originalEvent.which=0}catch(c){}}},Pb=function(a){Be=i[0].scrollTop,Ae=i[0].scrollLeft;var b=Math.abs(Be-we),c=Math.abs(Ae-ve);if(c&&(ve=Ae,g[0].scrollLeft=Ae),b)if(Fe=Be>we?1:-1,we=Be,dd>b)Jc(Be+re);else{var d=re;se=Ib==dd?0:Math.min(fc-1,Math.floor(Be*((Vc-dd)/(Ib-dd))*(1/jc))),re=Math.round(se*z),d!=re&&Wb()}(c||b)&&(he&&clearTimeout(he),(Math.abs(pe-Be)>20||Math.abs(oe-Ae)>20)&&(!hd.options.virtualScroll||Math.abs(pe-Be)<dd&&Math.abs(oe-Ae)<gd?yc():he=setTimeout(function(){yc(),he=null},50),hd.trigger("viewportchanged",a,{}))),hd.trigger("scroll",a,{scrollLeft:Ae,scrollTop:Be})},Qb=function(){hd.$el.is(":visible")&&hd.resize()},Rb=function(a){if(!a)return!1;var b=eb(a);if(!b)return!1;var d=c.groupBy(hd.collection.groups,function(a){return a.column_id});return d[a]&&d[a].length?d[a][0]:!1},Sb=function(a){if(!a)return!1;var b=c.pluck(hd.sorting,"columnId");return b.indexOf(a)>=0},this.hideColumn=function(a){var b=null;if(void 0!==a&&null!==a&&(b=eb(a)),!b)throw new Error('Unable to hide column "'+a+'" because no such column could be found.');b.visible=!1,this.setColumns(this.options.columns)},Ub=function(){var a=new qe({__addRow:!0,data:{},formatter:function(){return""},id:"-add-row-"});hd.collection.add(a,{forced:!0})},Zb=function(a,b){var c=lb(),d=jb(a);return d?d.editable===!1?!1:id.activeColumns[b].editable===!1?!1:c>a&&!d?!1:mb(a,b)?!0:!1:!1},$b=function(a,b){if(!hd.selection)return!1;for(var c,d=0,e=hd.selection.length;e>d;d++)if(c=hd.selection[d],c.contains(a,b))return!0;return!1},_b=function(a){if(!hd.selection)return!1;var b=hd.collection.length-1;"__gridAggregate"==hd.collection.items[hd.collection.items.length-1].id&&b--;for(var c,d=0,e=hd.selection.length;e>d;d++)if(c=hd.selection[d],0===c.fromRow&&c.toRow===b&&c.fromCell>=a&&c.toCell<=a)return!0;return!1},Vb=function(){_c(),Wb(),yc()},Wb=function(){ee&&cc();for(var a in id.nodes)xc(a)},Xb=function(a){delete id.postprocess[id.rows[a].id],te=Math.min(te,a),ue=Math.max(ue,a),Sc()},Yb=function(a){if(a&&a.length){Fe=0;for(var b=0,c=a.length;c>b;b++)ee&&hd.active&&hd.active.row===a[b]&&cc(),id.nodes[a[b]]&&xc(a[b])}},this.isGrouped=function(){return this.collection.groups.length?!0:!1},this.isSorted=function(){return this.sorting.length?!0:!1},ac=function(){hd.listenTo(hd.options.data,"add",function(a,b,c){hd.collection.add(a,c)}),hd.listenTo(hd.options.data,"change",function(a){hd.setItem(a.id,a)}),hd.listenTo(hd.options.data,"remove",function(a){hd.collection.remove(a.id)}),hd.listenTo(hd.options.data,"reset",function(){hd.collection.reset()}),hd.listenTo(hd.options.data,"sort",c.debounce(function(){hd.collection&&hd.collection.reset(hd.options.data)}),10)},bc=function(a){if(hd.active&&hd.active.node&&hd.options.editable===!0&&Zb(hd.active.row,hd.active.cell)){clearTimeout(ge);var c=id.activeColumns[hd.active.cell],d=jb(hd.active.row);b(hd.active.node).addClass("editable"),a||(hd.active.node.innerHTML="");var e=a||mb(hd.active.row,hd.active.cell);ee=new e({grid:hd,cell:hd.active.node,column:c,item:d||{},commitChanges:function(){hd.options.autoEdit&&hc("down")}});for(var f=["applyValue","cancel","destroy","focus","getValue","isValueChanged","loadValue","serializeValue","setValue","validate"],g=0,h=f.length;h>g;g++)if(!ee[f[g]])throw new Error("Your editor is missing a '"+[f[g]]+"' function.");Kc=ee.serializeValue(),ee.focus()}},cc=function(){if(ee&&(ee.destroy(),ee=null,hd.active&&hd.active.node)){var a=jb(hd.active.row);if(b(hd.active.node).removeClass("editable invalid"),a){var c=id.activeColumns[hd.active.cell],d=nb(hd.active.row,c);hd.active.node.innerHTML=d(hd.active.row,hd.active.cell,kb(a,c),c,a),Xb(hd.active.row)}}},dc=function(){var a=["paddingLeft","paddingRight"],c=["paddingTop","paddingBottom"],f=b('<div class="'+Hd+'" style="visibility:hidden">-</div>').appendTo(e);je=ke=0,"border-box"!=f.css("box-sizing")&&"border-box"!=f.css("-moz-box-sizing")&&"border-box"!=f.css("-webkit-box-sizing")&&(b.each(a,function(a,b){je+=parseFloat(f.css(b))||0}),b.each(c,function(a,b){ke+=parseFloat(f.css(b))||0})),vc(f[0]);var g=b('<div class="'+Ud+'"></div>').appendTo(d);f=b('<div class="'+md+'" style="visibility:hidden">-</div>').appendTo(g),kd=jd=0,"border-box"!=f.css("box-sizing")&&"border-box"!=f.css("-moz-box-sizing")&&"border-box"!=f.css("-webkit-box-sizing")&&(b.each(a,function(a,b){kd+=parseFloat(f.css(b))||0}),b.each(c,function(a,b){jd+=parseFloat(f.css(b))||0})),vc(g[0]),j=Math.max(je,kd)},ec=function(a){var b,c,d=[],e={};for(b=0,c=hd.collection.groups.length;c>b;b++)d.push({columnId:hd.collection.groups[b].column_id,sortAsc:!0,group:!0}),e[hd.collection.groups[b].column_id]=d[b];var f;for(b=0,c=a.length;c>b;b++)a[b].group||(f=e[a[b].columnId],f?(delete f.group,f.sortAsc=a[b].sortAsc):d.push(a[b]));return d},gc=function(a,b){var c,d,e=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,f=/(^[ ]*|[ ]*$)/g,g=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,i=/^0/,j=function(a){return(""+a).toLowerCase()||""+a},k=j(a).replace(f,"")||"",l=j(b).replace(f,"")||"",m=k.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),n=l.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),o=parseInt(k.match(h),10)||1!=m.length&&k.match(g)&&Date.parse(k),p=parseInt(l.match(h),10)||o&&l.match(g)&&Date.parse(l)||null;if(p){if(p>o)return-1;if(o>p)return 1}for(var q=0,r=Math.max(m.length,n.length);r>q;q++){if(c=!(m[q]||"").match(i)&&parseFloat(m[q])||m[q]||0,d=!(n[q]||"").match(i)&&parseFloat(n[q])||n[q]||0,isNaN(c)!==isNaN(d))return isNaN(c)?1:-1;if(typeof c!=typeof d&&(c+="",d+=""),d>c)return-1;if(c>d)return 1}return 0},hc=function(a){if(!hd.options.keyboardNavigation)return!1;if(!(hd.active&&hd.active.node||"prev"==a||"next"==a))return!1;var b={up:-1,down:1,left:-1,right:1,prev:-1,next:1};De=b[a];var c={up:Gb,down:Bb,left:Cb,right:Fb,prev:Eb,next:Db},d=c[a],e=d(hd.active?hd.active.row:null,hd.active?hd.active.cell:null,k);if(e){var f=e.row==lb();return Gc(e.row,e.cell,!f),Lc(cb(e.row,e.cell)),k=e.posX,!0}return Lc(cb(hd.active?hd.active.row:null,hd.active?hd.active.cell:null)),!1},kc=function(){},kc.prototype=new qe,kc.prototype.__placeholder=!0,kc.prototype.toString=function(){return"Placeholder"},lc=function(a,b,c,d){c=void 0===c?a:c,d=void 0===d?b:d,this.fromRow=Math.min(a,c),this.fromCell=Math.min(b,d),this.toRow=Math.max(a,c),this.toCell=Math.max(b,d),this.exclusions=[]},lc.prototype.contains=function(a,b){return a>=this.fromRow&&a<=this.toRow&&b>=this.fromCell&&b<=this.toCell&&!this.isExcludedCell(a,b)},lc.prototype.deselect=function(a,b){var c=void 0!==a&&null!==a&&void 0!==b&&null!==b;if(c&&!this.contains(a,b))throw new Error("Unable to deselect cell ("+a+", "+b+") because it is not part of this Range.");c&&this.exclusions.push([a,b]);var d=[];if(void 0===a||null===a)for(var e=this.fromRow;e<=this.toRow;e++)d.indexOf(e)<0&&d.push(e);else d.push(a);var f={},g={};if(void 0!==b&&void 0!==b)f[id.activeColumns[b].id]=hd.options.selectedClass;else for(var h=0,i=id.activeColumns.length;i>h;h++)f[id.activeColumns[h].id]=hd.options.selectedClass;for(var j=0,k=d.length;k>j;j++)g[d[j]]=f;return Yc(null,g),this},lc.prototype.excludeUnselectable=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)v(a,b)||this.exclusions.push([a,b])},lc.prototype.fullyExcluded=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)if(!this.isExcludedCell(a,b))return!1;return!0},lc.prototype.getCellCount=function(){for(var a,b=0,c=this.fromRow;c<=this.toRow;c++){a=id.nodes[c];for(var d=this.fromCell;d<=this.toCell;d++)a.cellColSpans.length&&a.cellColSpans[d]&&b++}return b},lc.prototype.isExcludedCell=function(a,b){if(0===this.exclusions.length)return!1;for(var c=0,d=this.exclusions.length;d>c;c++)if(this.exclusions[c][0]===a&&this.exclusions[c][1]===b)return!0},lc.prototype.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},lc.prototype.isSingleRow=function(){return this.fromRow==this.toRow},lc.prototype.toCSV=function(){for(var a=this.toJSON(),b=[],c=0,d=a.length;d>c;c++)b.push('"'+a[c].join('","')+'"');return b.join("\n")},lc.prototype.toJSON=function(){for(var a,b,c,d=[],e=this.fromRow;e<=this.toRow;e++)if(b=id.rows[e],!(b instanceof qe)){c=[];for(var f=this.fromCell;f<=this.toCell;f++)this.isExcludedCell(b,f)?c.push(null):(a=id.activeColumns[f],c.push(wb(b,a)));d.push(c)}return d},lc.prototype.toRows=function(){for(var a=[],b=this.fromRow;b<=this.toRow;b++)a.push(id.rows[b]);return a},lc.prototype.toString=function(){return this.isSingleCell()?"Range ("+this.fromRow+":"+this.fromCell+")":"Range ("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"},mc=function(){for(var a=0,b=id.rows.length;b>a;a++){if(id.rows[a].__placeholder)return!1;if(id.rows[a]instanceof Hb)for(var c=0,d=id.rows[a].grouprows.length;d>c;c++)if(id.rows[a].grouprows[c].__placeholder)return!1}return!0},oc=function(a){var b={filters:"function"!=typeof hd.collection.filter?hd.collection.filter:null};xe.count(b,function(b){hd.destroyed||(hd.collection.length=b,hd.collection.remote_length=b,0===b?hd.collection.reset():W(),_c(),hd.collection.refresh(),a())})},pc=function(){var a=zb(),b=a.top,c=a.bottom;ye&&"function"==typeof ye.abort&&ye.abort(),null!==ze&&clearTimeout(ze),0>b&&(b=0),hd.collection.length>0&&(c=Math.min(c,hd.collection.length-1));for(var d,e,f,g=hd.collection.groups.length?0:b,h=0,i=0,j=g;c>=j;j++)f=id.rows[j],f&&f instanceof Hb&&f.collapsed&&void 0===d?(i+=f.count,h++):(f&&f instanceof qe&&!f.__placeholder&&h++,b>j||(!f||f.__placeholder)&&(void 0===d&&(d=j-h+i),e=j-h+i));return void 0===d?(nc(),void 0):(rc({columns:id.activeColumns,filters:"function"!=typeof hd.collection.filter?hd.collection.filter:null,limit:e-d+1,offset:d,order:hd.sorting},function(a){if(!hd.destroyed){if(hd.options.data instanceof Backbone.Collection)for(var b=0,c=a.length;c>b;b++)hd.options.data.add(a[b],{at:d+b,merge:!0});else hd.collection.add(a,{at:d,merge:!0});nc(d-i,e+h-i)}}),void 0)},qc=function(a){a=a||function(){},ye&&"function"==typeof ye.abort&&ye.abort(),null!==ze&&clearTimeout(ze),rc({columns:id.activeColumns,order:hd.sorting},function(b){hd.collection.reset(b),a()})},rc=function(a,b){b=b||function(){},a.offset||(a.offset=0),a.limit||(a.limit=null),ze&&clearTimeout(ze),ze=setTimeout(function(){try{"function"==typeof xe.onLoading&&xe.onLoading(),ye=xe.fetch(a,function(a){ye=null,b(a),"function"==typeof xe.onLoaded&&xe.onLoaded()})}catch(c){throw new Error("Doby Grid remote fetching failed due to: "+c)}},hd.options.remoteScrollTime)},sc=function(a){if(a=a||function(){},ye&&"function"==typeof ye.abort&&ye.abort(),id.remoteGroups)a(id.remoteGroups);else{var b={filters:"function"!=typeof hd.collection.filter?hd.collection.filter:null,groups:hd.collection.groups,order:hd.sorting};"function"==typeof xe.onLoading&&xe.onLoading(),ye=xe.fetchGroups(b,function(b){ye=null,id.remoteGroups=b,a(b),hd.trigger("remotegroupsloaded",{}),"function"==typeof xe.onLoaded&&xe.onLoaded()})}},tc=function(){id.remoteGroups=null;var a=function(){for(var a=!0,b=0,c=hd.collection.groups.length;c>b&&a;b++)for(var d=0,e=hd.collection.groups[b].rows.length;e>d;d++)if(!hd.collection.groups[b].rows[d].collapsed){a=!1;break}a||pc()};hd.once("remotegroupsloaded",a),hd.collection.refresh()},nc=function(a,b){for(var c=a;b>=c;c++)Yb([c]);_c(),yc(),hd.trigger("remoteloaded",{})},this.remove=function(a){return this.collection.remove(a),this},this.removeColumn=function(a){if(!a)return this;"object"==typeof a&&(a=a.id);var b,c=this.options.columns.filter(function(c){if(c.id==a&&(b=c,c.removable!==!0))throw new Error('Cannot remove column "'+c.id+'" because it is not removable.');return c.id!=a});if(!b)throw new Error('Cannot remove column "'+a+'" because no such column exists.');Rb(a)&&this.removeGrouping(a);var d;return b&&b.quickFilterInput&&(vc(b.quickFilterInput.parent()[0]),d=!0),hd.setColumns(c),d&&m(),this},uc=function(){h&&h.length&&(vc(h[0]),h=null),Tc=null},vc=function(a){V=document.getElementById("DobyGridGarbageBin"),V||(V=document.createElement("DIV"),V.id="DobyGridGarbageBin",V.style.display="none",document.body.appendChild(V)),V.appendChild(a),V.innerHTML=""},this.removeGrouping=function(a){if(a){"object"==typeof a&&(a=a.id);var b=Rb(a);return b&&(this.collection.groups.splice(this.collection.groups.indexOf(b),1),this.setGrouping(this.collection.groups)),this}},wc=function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];v(e.fromRow,e.fromCell)&&v(e.toRow,e.toCell)&&b.push(e)}return b},xc=function(a){var b,c=id.nodes[a];if(c){d[0].removeChild(c.rowNode),delete id.nodes[a];var e=id.rows[a];if(e&&id.postprocess[e.id])for(var f in id.postprocess[e.id])b=id.activeColumns[id.columnsById[f]],b&&b.cache||delete id.postprocess[e.id][f]}},yc=function(){if(ne){var a=zb(),b=rb();C(b),oe!=Ae&&A(b),hd.$el&&(!fd&&hd.options.autoColumnWidth?hd.$el.addClass(Qd):hd.$el.removeClass(Qd)),Dc(b),te=a.top,ue=Math.min(lb()-1,a.bottom),Sc(),pe=Be,oe=Ae}},zc=function(a,b,c,d,e){var f=id.activeColumns[c],g=e&&e.columns||{},h=Math.min(id.activeColumns.length-1,c+d-1),i=e?kb(e,f):null,j=e instanceof Hb?"":f.class?"function"==typeof f.class?f.class(b,c,i,f,e):f.class:null,k=id.activeColumns[c],l=[md,"l"+c,"r"+h];if(j&&l.push(j),hd.active&&b===hd.active.row&&c===hd.active.cell&&l.push("active"),g[k.id]&&g[k.id].class?l.push(g[k.id].class):g[c]&&g[c].class&&l.push(g[c].class),$b(b,c)&&l.push(hd.options.selectedClass),a.push('<div class="'+l.join(" ")+'">'),f.cache&&f.postprocess&&id.postprocess[e.id]&&id.postprocess[e.id][k.id])a.push(id.postprocess[e.id][k.id]);else if(e)try{a.push(nb(b,f)(b,c,i,f,e))}catch(m){a.push(""),console.error&&console.error("Cell failed to render due to failed '"+k.id+"' column formatter. Error: "+m.message,m)}a.push("</div>"),id.nodes[b].cellRenderQueue.push(c),id.nodes[b].cellColSpans[c]=d},Ac=function(){e.is(":empty")||(e.empty(),e.width(ob()));
for(var a,b,c,d=[],f=0,g=id.activeColumns.length;g>f;f++)a=id.activeColumns[f],b=[Hd,a.headerClass||""],a.sortable&&b.push(Od),c=a.width-je,d.push('<div class="'+b.join(" ")+'" style="width:'+c+'px" '),d.push('id="'+(Ee+a.id)+'"'),void 0!==a.tooltip&&null!==a.tooltip&&"title"==hd.options.tooltipType&&d.push(' title="'+a.tooltip+'"'),d.push(">"),d.push('<span class="'+pd+'">'+a.name+"</span>"),a.sortable&&d.push('<span class="'+Yd+'"></span>'),d.push("</div>");e.append(d.join("")),Uc(),hd.options.resizableColumns&&Oc(),hd.options.reorderable&&Nc()},Bc=function(a,c){for(var d,e=b(['<div class="',sd,'"></div>'].join("")),f=function(a){"function"==typeof this.fn?this.fn.bind(hd)(a):this.menu&&a.stopPropagation()},g=0,h=a.length;h>g;g++)if(d=a[g],void 0===d.enabled||d.enabled)if(d.title)e.append(['<div class="',yd,'">',d.icon?d.icon:"",d.name||"","</div>"].join(""));else if(d.divider)e.append(['<div class="',ud,'"></div>'].join(""));else{var i=d.name||"",j="";void 0!==d.value&&(d.value&&(j=" on"),i+=['<span class="',wd,'"></span>'].join(""));var k=['<div class="',td," ",j,'">',d.icon?d.icon:"",i,"</div>"].join(""),l=b(k).appendTo(e);d.menu&&(l.append(['<span class="',vd,'"></span>'].join("")),Bc(d.menu,l)),l.click(f.bind(d))}e.appendTo(c)},Cc=function(a,b,c){var d,e=jb(b),f=Ud+(hd.active&&b===hd.active.row?" active":"")+(b%2===1?" odd":""),g={};if(cd?(g=id.rowPositions[b],d=g.top-re):d=hd.options.rowHeight*b-re+1*b,e&&e.class&&(f+=" "+("function"==typeof e.class?e.class(b,e):e.class)),a.push("<div class='"+f+"' style='top:"+d+"px"),cd&&g.height){var h=g.height-jd;a.push(";height:"+h+"px;line-height:"+(h+hd.options.lineHeightOffset)+"px")}a.push("'>");var i,j,k,l;for(k=0,l=id.activeColumns.length;l>k;k++){if(j=id.activeColumns[k],i=1,e&&e.columns){var m=e.columns[j.id]||e.columns[k];i=m&&m.colspan||1,"*"===i&&(i=l-k)}if(id.columnPosRight[Math.min(l-1,k+i-1)]>c.leftPx){if(id.columnPosLeft[k]>c.rightPx)break;zc(a,b,k,i,e)}i>1&&(k+=i-1)}hd.options.resizableRows&&e.resizable!==!1&&(a.push('<div class="'),a.push(Wd),a.push('"></div>')),a.push("</div>")},Dc=function(a){var b,c,e=[],f=[],g=!1;for(b=a.top,c=a.bottom;c>=b;b++)id.nodes[b]||(f.push(b),id.nodes[b]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},Cc(e,b,a),hd.active&&hd.active.node&&hd.active.row===b&&(g=!0),de++);if(f.length){var h=document.createElement("div");for(h.innerHTML=e.join(""),b=0,c=f.length;c>b;b++)id.nodes[f[b]].rowNode=d[0].appendChild(h.firstChild);g&&(hd.active.node=cb(hd.active.row,hd.active.cell))}},this.reset=function(a){return this.collection.reset(a,!0),this},Ec=function(){Lc(null,!1)},this.resize=function(){var a=dd;return Fc(),Vb(),dd>a&&xe&&pc(),this},Fc=function(){ne&&(dd=yb(),t(),gd=parseFloat(b.css(hd.$el[0],"width",!0)),i.height(dd),_c(),hd.options.autoColumnWidth&&p(),oe=-1,yc())},Gc=function(a,b,c){Ic(a,c);var d=ib(a,b),e=id.columnPosLeft[b],f=id.columnPosRight[b+(d>1?d-1:0)],g=Ae+gd;Ae>e?(i.scrollLeft(e),Pb(),yc()):f>g&&(i.scrollLeft(Math.min(e,f-i[0].clientWidth)),Pb(),yc())},Hc=function(a){var b,c=a*ic,d=ub(Be)+c;if(d=0>d?0:d,cd){if(!id.rowPositions[d])return;b=id.rowPositions[d].top}else b=d*(hd.options.rowHeight+1);if(Jc(b),yc(),hd.options.activeFollowsPage&&hd.active&&null!==hd.active.row){var e=hd.active.row+c,f=lb();e>=f&&(e=f-1),0>e&&(e=0);for(var g=0,h=null,i=k;k>=g;)u(e,g)&&(h=g),g+=ib(e,g);null!==h?(Lc(cb(e,h)),k=i):Ec()}},Ic=function(a,b){var c,d,e,f=hd.options.rowHeight+1,g=zb();if(!(g.top<a&&g.bottom-1>a)){cd?(e=id.rowPositions[a],c=e.top,d=e.bottom-dd+(ed?window.scrollbarDimensions.height:0)):(c=a*f,d=(a+1)*f-dd+(ed?window.scrollbarDimensions.height:0));var h,i;cd?(h=e.bottom>Be+dd+re,i=e.top<Be+re):(h=a*hd.options.rowHeight>Be+re,i=a*hd.options.rowHeight<Be+re),h?(Jc(b?c:d),yc()):i&&(Jc(b?d:c),yc())}},Jc=function(a){a=Math.max(a,0),a=Math.min(a,Vc-dd+(ed?window.scrollbarDimensions.height:0));var b=re;se=Math.min(fc-1,Math.floor(a/jc)),re=Math.round(se*z);var c=a-re;if(cd&&t(),re!=b){var d=zb(c);C(d)}we!=c&&(Fe=c+re>we+b?1:-1,i[0].scrollTop=pe=Be=we=c,hd.trigger("viewportchanged",{}))},this.scrollToRow=function(a){if(cd){var b=id.rowPositions[a];Jc(b.top)}else Jc(a*(this.options.rowHeight+1));return yc(),this},this.selectCells=function(a,b,d,e,f){if(this.options.selectable){if(void 0===a&&void 0===b&&void 0===d&&void 0===e)return O(),void 0;var g=["startRow","startCell","endRow","endCell"];c.each([a,b,d,e],function(a,b){if(void 0===a)throw new Error('Unable to select cell range because "'+g[b]+'" param is missing.')});var h,i,j,k,l,m=new lc(a,b,d,e);if(m.excludeUnselectable(),!m.fullyExcluded()){if(m.isSingleCell()&&this.selection)for(i=0,j=this.selection.length;j>i;i++){if(this.selection[i].contains(a,b))return;if(this.selection[i].isExcludedCell(a,b)){var n=this.selection[i].exclusions.indexOf([a,b]);this.selection[i].exclusions.splice(n,1);var o={};return o[a]={},o[a][id.activeColumns[b].id]=this.options.selectedClass,Yc(o),void 0}}f?(this.selection||(this.selection=[]),h=this.selection,h.push(m)):h=[m],this.selection=h;var p={};for(i=0,j=this.selection.length;j>i;i++)for(k=this.selection[i].fromRow;k<=this.selection[i].toRow;k++)for(p[k]||(p[k]={}),l=hd.selection[i].fromCell;l<=this.selection[i].toCell;l++)v(k,l)&&!this.selection[i].isExcludedCell(k,l)&&(p[k][id.activeColumns[l].id]=this.options.selectedClass);Yc(p),this.trigger("selection",this._event)}}},Lc=function(a,c){hd.active&&null!==hd.active.node&&(cc(),b(hd.active.node).removeClass("active"),id.nodes[hd.active.row]&&b(id.nodes[hd.active.row].rowNode).removeClass("active")),hd.active||(hd.active={cell:null,node:null,row:null});var d=hd.active.node!==a;null!==a?(hd.active.node=a,hd.active.row=tb(hd.active.node.parentNode),hd.active.cell=k=ab(hd.active.node),(null===c||void 0===c)&&(c=hd.active.row==lb()||hd.options.autoEdit),b(hd.active.node).addClass("active"),b(id.nodes[hd.active.row].rowNode).addClass("active"),hd.options.editable&&c&&Zb(hd.active.row,hd.active.cell)&&(clearTimeout(ge),hd.options.asyncEditorLoading?ge=setTimeout(function(){bc()},hd.options.asyncEditorLoadDelay):bc())):hd.active.row=hd.active.cell=null,d&&hd.trigger("activecellchange",{},X())},this.setColumns=function(a){this.options.columns=a;for(var c,d=0,e=this.options.columns.length;e>d;d++)c=hd.options.columns[d]=b.extend(JSON.parse(JSON.stringify(Ge)),hd.options.columns[d]),c.minWidth&&c.width<c.minWidth&&(c.width=c.minWidth),c.maxWidth&&c.width>c.maxWidth&&(c.width=c.maxWidth);ad(),Zc(),this.trigger("columnchange",{},{columns:a}),ne&&(Wb(),Ac(),uc(),J(),Fc(),n(),Pb())},this.setGrouping=function(a){return this.collection.setGrouping(a),this},this.setItem=function(a,b){return this.collection.setItem(a,b),this},this.setOptions=function(a){cc(),void 0!==a.addRow&&hd.options.addRow!==a.addRow&&(a.addRow?Ub():this.remove("-add-row-")),b.extend(!0,hd.options,a),bd(),a.columns?this.setColumns(a.columns):yc(),a.data&&this.reset(a.data),"autoColumnWidth"in a&&(Oc(),p(),hd.trigger("columnresize",{}))},Mc=function(a,b){var d=id.rows[a];d.height=b,Yb(c.range(a,id.rows.length)),d instanceof Hb?(d.predef.grouprows[d.id]={height:b},Yb(c.range(a,id.rows.length)),s(a),yc()):hd.collection.setItem(d[le],d),_c()},this.setSorting=function(a){if(!b.isArray(a))throw new Error('Doby Grid cannot set the sorting because the "options" parameter must be an array of objects.');var d,e,f=JSON.parse(JSON.stringify(this.sorting));if(!this.options.multiColumnSort&&a.length>1)throw new Error('Doby Grid cannot set the sorting given because "multiColumnSort" is disabled and the given sorting options contain multiple columns.');var g;for(d=0,e=a.length;e>d;d++){if(g=eb(a[d].columnId),!g)throw new Error(['Doby Grid cannot sort by "',a[d].columnId,'" because that column does not exist.'].join(""));if(g.sortable===!1)throw new Error(['Doby Grid cannot sort by "',g.id,'" because that column is not sortable.'].join(""));(null===a[d].sortAsc||void 0===a[d].sortAsc)&&(a[d].sortAsc=null!==g.sortAsc||void 0!==g.sortAsc?g.sortAsc:!0)}this.sorting=ec(a),Uc();var h=f.length!=this.sorting.length;if(!h)for(d=0,e=f.length;e>d;d++)if(f[d].columnId!=this.sorting[d].columnId||f[d].sortAsc!=this.sorting[d].sortAsc){h=!0;break}if(h){var i={multiColumnSort:this.sorting.length>1,sortCols:[]};c.each(this.sorting,function(a){g=eb(a.columnId),i.sortCols.push({sortCol:g,sortAsc:a.sortAsc})}),S(i),hd.trigger("sort",this._event,i)}return this},Nc=function(){e.filter(":ui-sortable").length||e.sortable({axis:"x",containment:"parent",cursor:"default",distance:3,helper:"clone",placeholder:Rd+" "+Hd,tolerance:"intersection",start:function(a,c){c.placeholder.width(c.helper.outerWidth()-je),b(c.helper).addClass(Id)},beforeStop:function(a,c){b(c.helper).removeClass(Id)},update:function(a){a.stopPropagation();for(var b,c=e.sortable("toArray"),d=[],f=0,g=c.length;g>f;f++)b=id.columnsById[c[f].replace(Ee,"")],d.push(id.activeColumns[b]);hd.setColumns(d),Oc(),hd.trigger("columnreorder",a)}})},Oc=function(){if(hd.options.resizableColumns){var a,c,d,f,g,h,i,k,l;g=e.children();var o=g.find("."+Ed);if(o&&o.length&&vc(o[0]),g.each(function(a){id.activeColumns[a].resizable&&(void 0===k&&(k=a),l=a)}),void 0!==k){var p=function(){g.each(function(a){id.activeColumns[a].previousWidth=id.activeColumns[a].width})},q=function(b,e){var f,h;if(h=e,0>e){for(a=b;a>=0;a--)c=id.activeColumns[a],c.resizable&&(f=Math.max(c.minWidth||0,j),h&&c.previousWidth+h<f?(h+=c.previousWidth-f,c.width=f):(c.width=c.previousWidth+h,h=0));if(hd.options.autoColumnWidth)for(h=-e,a=b+1;a<g.length;a++)c=id.activeColumns[a],c.resizable&&(h&&c.maxWidth&&c.maxWidth-c.previousWidth<h?(h-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+h,h=0))}else{for(a=b;a>=0;a--)c=id.activeColumns[a],c.resizable&&(h&&c.maxWidth&&c.maxWidth-c.previousWidth<h?(h-=c.maxWidth-c.previousWidth,c.width=c.maxWidth):(c.width=c.previousWidth+h,h=0));if(hd.options.autoColumnWidth)for(h=-e,a=b+1,d=g.length;d>a;a++)c=id.activeColumns[a],c.resizable&&(f=Math.max(c.minWidth||0,j),h&&c.previousWidth+h<f?(h+=c.previousWidth-f,c.width=f):(c.width=c.previousWidth+h,h=0))}},r=function(b,d){var e=null,f=null;if(hd.options.autoColumnWidth)for(e=0,f=0,a=b+1;a<g.length;a++)c=id.activeColumns[a],c.resizable&&(null!==f&&(c.maxWidth?f+=c.maxWidth-c.previousWidth:f=null),e+=c.previousWidth-Math.max(c.minWidth||0,j));var k=0,l=0;for(a=0;b>=a;a++)c=id.activeColumns[a],c.resizable&&(null!==l&&(c.maxWidth?l+=c.maxWidth-c.previousWidth:l=null),k+=c.previousWidth-Math.max(c.minWidth||0,j));null===e&&(e=1e5),null===k&&(k=1e5),null===f&&(f=1e5),null===l&&(l=1e5),i=d+Math.min(e,l),h=d-Math.min(k,f)},s=function(){m(),hd.options.resizeCells&&n()},t=function(){var d;for(a=0;a<g.length;a++)c=id.activeColumns[a],d=b(g[a]).outerWidth(),c.previousWidth!==d&&c.rerenderOnResize&&Wb();Xc(!0),yc(),hd.trigger("columnresize",{})};e.on("dblclick",function(a){if(b(a.target).closest("."+Ed).length){var c=hb(a);if(c){var d=id.columnsById[c.id],e=c.width,g=Math.max(gb(d),c.minWidth);if(e!=g){f=a.pageX,p(d);var j=g-e;r(d,f);var k=Math.min(i,Math.max(h,f+j))-f;q(d,k),s(),t()}}}}),b.each(g,function(a,c){k>a||hd.options.autoColumnWidth&&a>=l||id.activeColumns[a].resizable===!1||b('<div class="'+Ed+'"><span></span></div>').appendTo(c).on("dragstart",function(c){f=c.pageX,b(this).parent().addClass(Jd),p(a),r(a,f)}).on("drag",function(b){var c=Math.min(i,Math.max(h,b.pageX))-f;q(a,c),s()}).on("dragend",function(){b(this).parent().removeClass(Jd),t()})})}}},Pc=function(){e.click(function(a){hd._event=a;var c=b(a.target).closest("."+Ed);if(!c.length){var d=hb(a);if(d&&d.sortable){for(var e=null,f=0,g=hd.sorting.length;g>f;f++)if(hd.sorting[f].columnId==d.id&&!hd.sorting[f].group){e=JSON.parse(JSON.stringify(hd.sorting[f])),e.sortAsc=!e.sortAsc;break}var h=[];a.shiftKey&&hd.options.multiColumnSort?e?(h=JSON.parse(JSON.stringify(hd.sorting)),h.splice(f,1)):(h=JSON.parse(JSON.stringify(hd.sorting)),h.push({columnId:d.id,sortAsc:!0})):e?hd.options.multiColumnSort?(h=JSON.parse(JSON.stringify(hd.sorting)),h[f].sortAsc=!h[f].sortAsc):h=[e]:h=[{columnId:d.id,sortAsc:!0}],hd.setSorting(h),hd._event=null}}})},Qc=function(a){var c=function(){dd=yb(),i.height(dd),Fc()};if(void 0===a&&f)return vc(f[0]),f=void 0,c(),d.focus(),void 0;var e,h=function(a){if(27==a.keyCode)return Qc(),void 0;var c=b(this).val();""===c&&(c=null),b(this).data("old_value")!=c&&(b(this).data("old_value",c),e&&clearTimeout(e),e=setTimeout(function(){for(var a,b,c=[],d=0,e=id.activeColumns.length;e>d;d++)a=id.activeColumns[d],a.quickFilterInput&&(b=a.quickFilterInput.val(),b.length&&c.push([a.id,"~*",b]));hd.filter(c)},150))};if(f)a&&a.quickFilterInput&&a.quickFilterInput.select().focus();else{f=b('<div class="'+Ld+'"></div>').appendTo(g);for(var j,k,l,n=0,o=id.activeColumns.length;o>n;n++)if(j=id.activeColumns[n],l=['<div class="'],l.push(Md),j.filterable||l.push(" "+Nd),l.push('">'),l.push("</div>"),k=b(l.join("")),k.appendTo(f),j.filterable){var p=null;if(hd.collection.filterset)for(var q=0,r=hd.collection.filterset.length;r>q;q++)if(hd.collection.filterset[q][0]==j.id){p=hd.collection.filterset[q][2];break}j.quickFilterInput=b('<input class="'+zd+'" type="text"/>').appendTo(k).data("column_id",j.id).attr("placeholder",pb("column.add_quick_filter")).val(p).on("keyup",h),a&&a.id==j.id&&j.quickFilterInput.select().focus()}}m(),c()},Rc=function(a){if("popup"==hd.options.tooltipType){if(b(a.target).closest("."+Ed).length)return b(a.target).trigger("mouseleave"),void 0;var c=hb(a);if(c&&c.tooltip){var d=b(a.target).closest("."+Hd);if(!d.attr("aria-describedby")){var e=Ee+"-tooltip-column-"+c.id;d.attr("aria-describedby",e),d.one("mouseleave remove",function(){if(void 0!==b(this).attr("aria-describedby")){var a=b("#"+e);a.removeClass("on"),setTimeout(function(){a&&a.length&&vc(a[0])},200),b(this).removeAttr("aria-describedby")}}),setTimeout(function(){if(void 0!==d.attr("aria-describedby")&&d.is(":visible")){var a=10,f=['<span class="'+_d+'" id="'+e+'">'];if(f.push(c.tooltip),f.push('<span class="'+ae+'"></span>'),f.push("</span>"),!b("#"+e).length){var g=b(f.join(""));g.appendTo(document.body);var h=d.offset().left+d.outerWidth()/2-g.outerWidth()/2,i=d.offset().top+d.outerHeight()+a,j=0,k=b(window),l=k.outerWidth();0>h?(j=h,h=0):h+g.outerWidth()>l&&(j=h+g.outerWidth()-l,h-=j+1);var m=g.children("."+ae).first();m.css("left",g.outerWidth()/2-m.outerWidth()/2+j),g.remove().addClass("on").attr("style","left:"+h+"px;top:"+(i+5)+"px").appendTo(document.body).width(),g.css("top",i)}}},250)}}}},this.sortBy=function(a,b){if(!a)throw new Error("Grid cannot sort by blank value. Column Id must be specified.");return this.setSorting([{columnId:a,sortAsc:b}])},Sc=function(){fe&&(clearTimeout(ie),ie=setTimeout(o,hd.options.asyncPostRenderDelay))},Uc=function(){var a=e.children();a.removeClass(Kd).find("."+Yd).removeClass(Zd+" "+$d),b.each(hd.sorting,function(b,c){null===c.sortAsc&&(c.sortAsc=!0);var d=id.columnsById[c.columnId];null===d||c.group||a.eq(d).addClass(Kd).find("."+Yd).addClass(c.sortAsc?Zd:$d)})},this.toString=function(){return"DobyGrid"},Wc=function(a,d){if(a.preventDefault(),window._DobyGridDropdownEvent!==a.timeStamp){window._DobyGridDropdownEvent=a.timeStamp;for(var e,g,h,i=d.column||!1,j=function(a){return function(c){c.stopPropagation();var d=eb(a.id);d.visible=!d.visible,d.visible?b(c.currentTarget).addClass("on"):b(c.currentTarget).removeClass("on"),hd.setColumns(hd.options.columns)}},k=[],m="--UNDEFINED--",n=c.chain(hd.options.columns).sortBy(function(a){return a.name}).groupBy(function(a){return void 0!==a.category&&null!==a.category?a.category:m}).value(),o=Object.keys(n).sort(),p=function(a,b){a.removable&&(b=b||k,b.push({name:void 0!==a.name&&null!==a.name?a.name:a.id,fn:j(a),value:a.visible}))},q=0,r=o.length;r>q;q++)if(g=o[q],g!=m){h={name:g,menu:[]};for(var s=0,t=n[g].length;t>s;s++)p(n[g][s],h.menu);k.push(h)}n[m]&&c.each(n[m],function(a){p(a)});var u=function(a,c){return function(d){if(1!==Object.keys(id.aggregatorsByColumnId[a.id]).length){b(d.target).parent().children("."+td).removeClass("on"),b(d.target).addClass("on"),b(d.target).children("."+wd).length||b(d.target).append('<span class="'+wd+'"></span>');for(var e in id.aggregatorsByColumnId[a.id])id.aggregatorsByColumnId[a.id][e].active=e==c;for(var f=zb(),g=f.top,h=f.bottom;h>g;g++)id.rows[g]instanceof l&&Yb([g]);hd.collection.refresh()}}},v=[];i&&id.aggregatorsByColumnId[i.id]&&c.each(id.aggregatorsByColumnId[i.id],function(a,b){v.push({fn:u(i,b),name:i.aggregators[b].name,value:a.active})});var w=[{enabled:i&&i.removable,name:pb("column.options"),title:!0},{enabled:i&&i.removable,name:i?pb("column.remove",{name:i.name}):"",fn:function(){hd.hideColumn(i.id)}},{enabled:i&&hd.options.quickFilter,name:pb("column.filtering"),menu:[{name:i?pb("column.filter",{name:i.name}):"",fn:function(){Qc(i),e.hide()}},{enabled:void 0!==f,name:pb("global.hide_filter"),fn:function(){Qc(),e.hide()}}]},{enabled:i&&i.sortable,name:pb("column.sorting"),menu:[{enabled:!Sb(i.id),name:i?pb("column.sort_asc",{name:i.name}):"",fn:function(){hd.sortBy(i.id,!0),e.hide()}},{enabled:!Sb(i.id),name:i?pb("column.sort_desc",{name:i.name}):"",fn:function(){hd.sortBy(i.id,!1),e.hide()}},{enabled:hd.isSorted()&&!Sb(i.id),name:i?pb("column.add_sort_asc",{name:i.name}):"",fn:function(){hd.sorting.push({columnId:i.id,sortAsc:!0}),hd.setSorting(hd.sorting),e.hide()}},{enabled:hd.isSorted()&&!Sb(i.id),name:i?pb("column.add_sort_desc",{name:i.name}):"",fn:function(){hd.sorting.push({columnId:i.id,sortAsc:!1}),hd.setSorting(hd.sorting),e.hide()}},{enabled:Sb(i.id),name:i?pb("column.remove_sort",{name:i.name}):"",fn:function(){hd.setSorting(c.filter(hd.sorting,function(a){return a.columnId!=i.id})),e.hide()}}]},{enabled:hd.options.groupable&&i&&i.groupable,name:pb("column.grouping"),menu:[{enabled:!Rb(i.id)||!hd.isGrouped(),name:i?pb("column.group",{name:i.name}):"",fn:function(){hd.setGrouping([{column_id:i.id}]),e.hide()}},{enabled:!Rb(i.id)&&hd.isGrouped(),name:i?pb("column.add_group",{name:i.name}):"",fn:function(){hd.addGrouping(i.id),e.hide()}},{enabled:Rb(i.id),name:i?pb("column.remove_group",{name:i.name}):"",fn:function(){hd.removeGrouping(i.id),e.hide()}},{enabled:hd.isGrouped(),name:pb("column.groups_clear"),fn:function(){hd.setGrouping(),e.hide()}},{enabled:hd.isGrouped(),divider:!0},{enabled:hd.isGrouped(),name:pb("column.groups_expand"),fn:function(){hd.collection.expandAllGroups()}},{enabled:hd.isGrouped(),name:pb("column.groups_collapse"),fn:function(){hd.collection.collapseAllGroups()}}]},{enabled:i&&void 0!==i.aggregators,name:pb("column.aggregators"),menu:v},{name:pb("global.grid_options"),title:!0},{name:pb("selection.selection"),menu:[{name:pb("selection.select_all",{name:i.name}),fn:function(){hd.selectCells(0,0,id.rows.length-1,id.activeColumns.length-1),e.hide()}},{enabled:i&&!_b(id.columnsById[i.id]),name:pb("selection.select_column",{name:i.name}),fn:function(){var a=id.columnsById[i.id];hd.selectCells(0,a,id.rows.length-1,a),e.hide()}},{enabled:void 0!==d.cell&&null!==d.cell&&!$b(d.row,d.cell),name:pb("selection.select_cell"),fn:function(){hd.selectCells(d.row,d.cell,d.row,d.cell),e.hide()}},{name:pb("selection.deselect_all",{name:i.name}),fn:function(){O(),e.hide()}},{enabled:i&&_b(id.columnsById[i.id]),name:pb("selection.deselect_column",{name:i.name}),fn:function(){for(var a=id.columnsById[i.id],b=0;b<id.rows.length-1;b++)O(b,a)}},{enabled:void 0!==d.cell&&null!==d.cell&&$b(d.row,d.cell),name:pb("selection.deselect_cell"),fn:function(){O(d.row,d.cell),e.hide()}}]},{enabled:k.length>0,name:pb("global.columns"),menu:k},{enabled:me,name:pb("global.export"),menu:[{name:pb("global.export_csv"),fn:function(){hd.export("csv",function(a){var b=new Blob([a],{type:"text/csv;charset=utf-8"});saveAs(b,[hd.options.exportFileName,".csv"].join(""))}),e.hide()}},{name:pb("global.export_html"),fn:function(){hd.export("html",function(a){var b=new Blob([a],{type:"text/html;charset=utf-8"});saveAs(b,[hd.options.exportFileName,".html"].join(""))}),e.hide()}}]},{name:pb("global.auto_width"),value:hd.options.autoColumnWidth,fn:function(){hd.setOptions({autoColumnWidth:!hd.options.autoColumnWidth})}}];if(hd.options.menuExtensions){var x=function(a){if(a.fn){var b=a.fn;a.fn=function(a){var c=b(a);return e.hide(),c}}if(a.menu)for(var c=0,d=a.menu.length;d>c;c++)a.menu[c]=x(a.menu[c]);return a};void 0!==d.row&&null!==d.row&&(d.item=id.rows[d.row]);var y=hd.options.menuExtensions(a,hd,d),z=y.filter(function(a){return void 0===a.enabled||a.enabled});if(z.length){w.push({name:pb("global.extensions"),title:!0});for(var A=0,B=z.length;B>A;A++)w.push(x(z[A]))}}var C=b('<div class="'+qd+'"></div>');Bc(w,C);var D;C.on("mouseover",function(a){D&&clearTimeout(D);var c=b(a.target).hasClass(td)?b(a.target):b(a.target).parent().hasClass(td)?b(a.target).parent():null;c&&(D=setTimeout(function(){c.parent().children(".open").removeClass("open"),c.addClass("open")},200))}),e=new Q(a,{id:i.id,menu:C,parent:hd.$el})}},Xc=function(a){var b=w;w=Z(),w!=b&&(d.width(w),e.width(ob()),ed=w>gd-window.scrollbarDimensions.width),(w!=b||a)&&n()},Yc=function(a,c){var d,e,f,g;for(var h in id.nodes){if(g=c&&c[h],f=a&&a[h],g)for(e in g)f&&g[e]==f[e]||(d=cb(h,id.columnsById[e]),d&&b(d).removeClass(g[e]));if(f)for(e in f)g&&g[e]==f[e]||(d=cb(h,id.columnsById[e]),d&&b(d).addClass(f[e]))}},Zc=function(a){(null===a||void 0===a)&&(a=!0),id.columnPosLeft=[],id.columnPosRight=[],a&&(id.aggregatorsByColumnId={});for(var b,c=0,d=0,e=id.activeColumns.length;e>d;d++)if(b=id.activeColumns[d],id.columnPosLeft[d]=c,id.columnPosRight[d]=c+b.width,c+=b.width,a&&b.aggregators)for(var f=0,g=b.aggregators.length;g>f;f++)id.aggregatorsByColumnId[b.id]||(id.aggregatorsByColumnId[b.id]={}),id.aggregatorsByColumnId[b.id][f]=new b.aggregators[f].fn(b),"function"==typeof id.aggregatorsByColumnId[b.id][f].reset&&id.aggregatorsByColumnId[b.id][f].reset()},$c=function(a){var b=id.nodes[a];if(b){R(a);var c=jb(a);for(var d in b.cellNodesByColumnIdx)if(b.cellNodesByColumnIdx.hasOwnProperty(d)){d=0|d;var e=id.activeColumns[d],f=b.cellNodesByColumnIdx[d];hd.active&&a===hd.active.row&&d===hd.active.cell&&ee?ee.loadValue(c):f.innerHTML=c?nb(a,e)(a,d,kb(c,e),e,c):""}Xb(a)}},_c=function(){if(ne){var a=id.rows.length,b=fd;if(0===a)fd=!1;else if(cd){var c=id.rowPositions[a-1];fd=c&&c.bottom>dd}else fd=a*hd.options.rowHeight>dd;cc();for(var e in id.nodes)e>=a&&xc(e);hd.active&&hd.active.node&&hd.active.row>a&&Ec();var f=Ib;if(0===a)Vc=dd-window.scrollbarDimensions.height;else{var g;if(cd){var h=a-1,j=id.rowPositions[h];g=j.bottom}else g=hd.options.rowHeight*a+a;Vc=Math.max(g,dd-window.scrollbarDimensions.height)}Vc<window.maxSupportedCssHeight?(Ib=jc=Vc,fc=1,z=0):(Ib=window.maxSupportedCssHeight,jc=Ib/100,fc=Math.floor(Vc/jc),z=(Vc-Ib)/(fc-1)),Ib!==f&&(d.css("height",Ib),Be=i[0].scrollTop);var k=Vc-dd>=Be+re;0===Vc||0===Be?se=re=0:k?Jc(Be+re):Jc(Vc-dd),hd.options.autoColumnWidth&&void 0!==b&&b!=fd&&p(),Xc(!1)}},ad=function(){if(hd.options.columns){id.activeColumns=[],id.columnsById={};for(var a,c=0,d=hd.options.columns.length;d>c;c++){a=hd.options.columns[c]=b.extend(JSON.parse(JSON.stringify(Ge)),hd.options.columns[c]),(void 0===a.id||null===a.id)&&(a.id=a.field?a.field+"_"+c:a.name?a.name+"_"+c:null),a.postprocess&&(fe=!0),(void 0===a.width||null===a.width)&&(a.width=hd.options.columnWidth),void 0!==a.minWidth&&null!==a.minWidth&&a.width<a.minWidth&&(a.width=a.minWidth),void 0!==a.maxWidth&&null!==a.maxWidth&&a.width>a.maxWidth&&(a.width=a.maxWidth);for(var e,f=["editor","exporter","formatter"],g=0,h=f.length;h>g;g++)if(e=f[g],void 0!==a[e]&&null!==a[e]&&"function"!=typeof a[e])throw new Error(["Column ",e,"s must be functions. ","Invalid ",e,' given for column "',a.name||a.id,'"'].join(""));if(void 0!==a.aggregators&&null!==a.aggregators&&!b.isArray(a.aggregators))throw new Error(['A column\'s "aggregators" value must be array. ','Invalid value given for column "',a.name||a.id,'"'].join(""));a.visible!==!1&&(id.activeColumns.push(a),id.columnsById[a.id]=id.activeColumns.length-1)}}},bd=function(){if(hd.options.resizableColumns&&!b.fn.drag)throw new Error('In order to use "resizable", you must ensure the jquery-ui.draggable module is loaded.');if(hd.options.reorderable&&!b.fn.sortable)throw new Error('In order to use "reorderable", you must ensure the jquery-ui.sortable module is loaded.');if(!c.isArray(hd.options.columns))throw new TypeError('The "columns" option must be an array.');if(!(c.isArray(hd.options.data)||"function"==typeof hd.options.data||hd.options.data instanceof Backbone.Collection))throw new TypeError('The "data" option must be an array, a function or a Backbone.Collection.');if("function"==typeof hd.options.data?xe=new hd.options.data:hd.options.data instanceof Backbone.Collection&&hd.options.data.DobyGridRemote&&(xe=hd.options.data.DobyGridRemote),xe&&(xe.grid=hd),["title","popup"].indexOf(hd.options.tooltipType)<0)throw'The "tooltipType" option be either "title" or "popup", not "'+hd.options.tooltipType+'".';hd.options.addRow&&!hd.options.editable&&(console.warn&&console.warn('In order to use "addRow", you must enable the "editable" parameter. The "addRow" option has been disabled.'),hd.options.addRow=!1),hd.options.resizableRows&&!cd&&(cd=!0),ad(),hd.options.data instanceof Backbone.Collection&&ac()},Tb()};return d});