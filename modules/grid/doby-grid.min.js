// doby-grid.js 0.0.8
// (c) 2014 Evgueni Naverniouk, Globex Designs, Inc.
// Doby may be freely distributed under the MIT license.
// For all details and documentation:
// https://github.com/globexdesigns/doby-grid
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery","underscore","backbone"],function(c,d,Backbone){return b(a,c,d,Backbone)}):a.DobyGrid=b(a,a.jQuery||a.$,a._,a.Backbone)}(this,function(a,b,c,Backbone){"use strict";var d=function(a){if(a=a||{},this.NAME="doby-grid",this.VERSION="0.0.7","object"!=typeof a||b.isArray(a))throw new TypeError('The "options" param must be an object.');"object"!=typeof window.console&&(window.console={});var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb,Ib,Jb,Kb,Lb,Mb,Nb,Ob,Pb,Qb,Rb,Sb,Tb,Ub,Vb,Wb,Xb,Yb,Zb,$b,_b,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc,mc,nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,Lc,Mc,Nc,Oc,Pc,Qc,Rc,Sc,Tc,Uc,Vc,Wc,Xc,Yc,Zc,$c,_c,ad,bd,cd,dd,ed,fd,gd,hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,sd,td,ud,vd,wd,xd,yd,zd=this,Ad={activeColumns:[],aggregatorsByColumnId:{},columnPosLeft:[],columnPosRight:[],columnsById:{},indexById:{},nodes:{},modelsById:{},postprocess:{},rowPositions:{},rows:[],stickyRows:[]},Bd=0,Cd=0,Dd=this.NAME+"-autoheight",Ed=this.NAME+"-cell",Fd=Ed+"-unselectable",Gd=this.NAME+"-clipboard",Hd="collapsed",Id=this.NAME+"-column-name",Jd=this.NAME+"-column-spacer",Kd=this.NAME+"-contextmenu",Ld=this.NAME+"-dropdown",Md=Ld+"-menu",Nd=Ld+"-item",Od=Ld+"-divider",Pd=Ld+"-arrow",Qd=Ld+"-icon",Rd=Ld+"-left",Sd=Ld+"-title",Td=this.NAME+"-editor",Ud=this.NAME+"-empty",Vd="expanded",Wd=this.NAME+"-group",Xd=this.NAME+"-group-title",Yd=this.NAME+"-group-toggle",Zd=this.NAME+"-resizable-handle",$d=this.NAME+"-header",_d=this.NAME+"-header-columns",ae=this.NAME+"-header-column",be=this.NAME+"-header-column-active",ce=this.NAME+"-header-column-dragging",de=this.NAME+"-header-column-sorted",ee=this.NAME+"-header-filter",fe=ee+"-cell",ge=ee+"-disabled",he="sortable",ie="invalid",je=this.NAME+"-invalid-icon",ke=this.NAME+"-scrollbar-left",le=this.NAME+"-no-right",me=this.NAME+"-sortable-placeholder",ne=this.NAME+"-range-decorator",oe=ne+"-stats",pe=this.NAME+"-row",qe=this.NAME+"-row-drag-container",re=this.NAME+"-row-handle",se=this.NAME+"-row-total",te=this.NAME+"-scroll-loader",ue=this.NAME+"-sort-indicator",ve=ue+"-asc",we=ue+"-desc",xe=this.NAME+"-sticky",ye=this.NAME+"-tooltip",ze=this.NAME+"-tooltip-arrow",Ae=this.NAME+"-viewport",Be=this.NAME+"-canvas",Ce=0,De=!1,Ee=null,Fe=null,Ge=null,He=0,Ie=0,Je="function"==typeof window.Blob,Ke=!1,Le=0,Me=0,Ne=0,Oe=0,Pe=null,Qe=null,Re=0,Se=0,Te=null,Ue=0,Ve=0,We=[],Xe=!1,Ye=1,Ze=this.NAME+"-"+Math.round(1e6*Math.random()),$e=1,_e=function(a){this.__nonDataRow=!0,a&&b.extend(this,a)};_e.prototype.toString=function(){return"NonDataItem"},a.locale=a.locale||{},a.locale=b.extend(!0,{column:{add_group:'Add Grouping By "{{name}}"',add_sort_asc:'Add Sort By "{{name}}" (Ascending)',add_sort_desc:'Add Sort By "{{name}}" (Descending)',add_quick_filter:"Add Quick Filter...",aggregators:"Aggregators",filter:'Quick Filter by "{{name}}"',filtering:"Filtering",group:'Group By "{{name}}"',grouping:"Grouping",groups_clear:"Clear All Grouping",groups_collapse:"Collapse All Groups",groups_expand:"Expand All Groups",options:"Column Options",remove:'Remove "{{name}}" Column',remove_group:'Remove Grouping By "{{name}}"',remove_sort:'Remove Sort By "{{name}}"',sorting:"Sorting",sort_asc:'Sort By "{{name}}" (Ascending)',sort_desc:'Sort By "{{name}}" (Descending)'},empty:{"default":"No data available",remote:"No results found",filter:"No items matching that filter"},global:{auto_width:"Automatically Resize Columns",columns:"Columns","export":"Export",export_csv:"Export Table to CSV",export_html:"Export Table to HTML",extensions:"Extensions",grid_options:"Grid Options",hide_filter:"Hide Quick Filter"},selection:{deselect_all:"Deselect All",deselect_cell:"Deselect This Cell",deselect_column:'Deselect "{{name}}" Column',selection:"Selection",select_all:"Select All",select_cell:"Select This Cell",select_column:'Select "{{name}}" Column'}},a.locale),this.options=b.extend({activeFollowsPage:!1,activateSelection:!0,addRow:!1,asyncEditorLoadDelay:100,asyncEditorLoading:!1,asyncPostRenderDelay:25,autoColumnWidth:!1,autoDestroy:!0,autoEdit:!0,autoHeight:!1,canvasFocus:!0,"class":null,clipboard:"csv",collapsible:!0,columns:[],columnSpacing:1,columnWidth:80,contextMenu:"all",ctrlSelect:!0,data:[],dataExtractor:null,deactivateOnRightClick:!1,editable:!1,editor:null,editorType:"selection",emptyNotice:!0,exportFileName:"doby-grid-export",formatter:null,fullWidthRows:!0,groupable:!0,idProperty:"id",keepNullsAtBottom:!0,keyboardNavigation:!0,lineHeightOffset:-1,nestedAggregators:!0,menuExtensions:null,minColumnWidth:"",multiColumnSort:!0,quickFilter:!1,remoteScrollTime:200,resizableColumns:!0,resizableRows:!1,resizeCells:!1,reorderable:!0,rowHeight:28,rowSpacing:0,rowBasedSelection:!1,scrollbarPosition:"right",scrollLoader:null,selectable:!0,selectedClass:"selected",shiftSelect:!0,showHeader:!0,stickyFocus:!1,stickyGroupRows:!1,tooltipType:"popup",virtualScroll:!0},a);var af={cache:!1,"class":null,comparator:null,editable:null,filterable:!0,focusable:!0,groupable:!0,headerClass:null,id:null,maxWidth:null,minWidth:42,name:"",postprocess:null,removable:!1,rerenderOnResize:!1,resizable:!0,selectable:!0,sortable:!0,sortAsc:!0,tooltip:null,visible:!0,width:null};return b.extend(this,Backbone.Events),this._event=null,this.active=null,this.currentEditor=null,this.destroyed=!1,this.fetcher=!1,this.selection=null,this.sorting=[],ac=function(){return td(),cb(),pd(),zd.collection=new G(zd),zd.options.addRow&&bc(),M(),zd.options.selectable&&!zd.options.rowBasedSelection&&s(),zd},this.activate=function(a,b){if(Ke){if(void 0===a||void 0===b)return void Rc();if(!(a>rb()||0>a||b>=Ad.activeColumns.length||0>b)&&w(a,b))return Wc(a,b,!1),ad(ib(a,b),!1),this}},this.add=function(a,b){return this.collection.add(a,b),this},this.addColumn=function(a,c){if(!a||"object"!=typeof a||b.isArray(a)||a instanceof HTMLElement)throw new Error("Unable to addColumn() because the given 'data' param is invalid.");c=c||{};var d=Ad.columnsById[a.id];if(void 0!==d){if(c.merge!==!0){var e=["Unable to addColumn() because a column with id '"+a.id];throw e.push("' already exists. Did you want to {merge: true} maybe?"),new Error(e.join(""))}for(var f=0,g=this.options.columns.length;g>f;f++)this.options.columns[f].id==a.id&&b.extend(this.options.columns[f],a);return this}var h=this.options.columns;return null===c.at||void 0===c.at?h.push(a):h.splice(h,c.at,a),zd.setColumns(h),this},this.addGrouping=function(a,b){if(!zd.options.groupable)throw new Error('Cannot execute "addGrouping" because "options.groupable" is disabled.');if(b=b||{},null===a||void 0===a)throw new Error("Unable to add grouping to grid because the 'column_id' value is missing.");return $b(a)||(b.column_id=a,this.collection.groups.push(b),this.setGrouping(this.collection.groups)),this},m=function(a){this.aggregators=a,this.class=se,this.columns={},this.editable=!1,this.focusable=!0,this.selectable=!1},m.prototype=new _e,m.prototype._aggregateRow=!0,m.prototype.toString=function(){return"Aggregate"},m.prototype.exporter=function(a){if(this.aggregators[a.id]){var b;for(var c in this.aggregators[a.id])if(b=this.aggregators[a.id][c],b.active&&b.exporter)return b.exporter()}return""},m.prototype.formatter=function(a,b,c,d){if(this.aggregators[d.id]){var e;for(var f in this.aggregators[d.id])if(e=this.aggregators[d.id][f],e.active&&e.formatter)return e.formatter()}return""},this.appendTo=function(a){if(!a||!a.length)throw new Error('Doby Grid requires a valid container. "'+b(a).selector+'" does not exist in the DOM.');this.$el.appendTo(a);try{Ke=!0,yd=parseFloat(b.css(this.$el[0],"width",!0)),qc(),this.options.showHeader&&S(e),Nc(),ed(),L(),u(),Tc(!0),"headerContent"===zd.options.minColumnWidth&&$(!0),this.fetcher&&(Cc(function(){0===j[0].scrollTop&&Dc()}.bind(this)),this.on("viewportchanged",function(){Dc()})),this.$el.on("resize."+this.NAME,function(){Tc(!0)}),this.options.autoDestroy&&this.$el.one("remove",function(){this.destroy()}.bind(this)),j.on("scroll",Yb),this.options.showHeader&&(g.on("contextmenu",Vb).on("click",Wb),"title"!=this.options.tooltipType&&g.on("mouseover",function(a){fd(a)})),b(document.body).on("click contextmenu",Rb),d.on("keydown",Xb).on("click",Sb).on("dblclick",Ub).on("contextmenu",Tb);for(var c=["mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup"],f=function(a){var c=fb(a),d=c&&void 0!==c.row&&null!==c.row?zd.getRowFromIndex(c.row):null,e=c?Ad.activeColumns[c.cell]:null;if(zd.trigger(a.type,a,{row:c?c.row:null,cell:c?c.cell:null,column:e,item:d}),"mouseenter"==a.type&&zd.options.canvasFocus){var f=document.activeElement;if(f!=this&&!b(this).has(b(f)).length&&(zd.options.quickFilter&&!b(f).closest("."+fe).length||!zd.options.quickFilter)){var g=[window.scrollX,window.scrollY];b(this).focus(),window.scrollTo(g[0],g[1])}}},h=0,i=c.length;i>h;h++)d.on(c[h],f);this.options.resizableRows&&t()}catch(k){console.error&&console.error(k)}return"header"==this.options.contextMenu?this.on("headercontextmenu",md):"all"==this.options.contextMenu&&(this.on("headercontextmenu",md),this.on("contextmenu",md)),b(window).on("resize",Zb),this},n=function(a){if(Ke&&zd.options.showHeader){a||(a=e.children("."+ae));var c=null;void 0!==f&&(c=f.children());var d,g,h,i;for(d=0,g=a.length;g>d;d++)h=Ad.activeColumns[d].width-He,i=["width:",h,"px"].join(""),b(a[d]).attr("style",i),c&&c[d]&&b(c[d]).attr("style",i);pd(!1)}},o=function(){var a,b,c,d,f,g,h=-1;for(e&&(e.children("."+Jd).remove(),"left"===zd.options.scrollbarPosition&&xd&&e.prepend('<span class="'+Jd+'" style="width:'+window.scrollbarDimensions.height+'px"></span>')),d=0,f=Ad.activeColumns.length;f>d;d++)a=Ad.activeColumns[d],b=a.width,c=lb(d),c.left.style.left=h+"px",g=y-h-b-2,!xd&&"right"===zd.options.scrollbarPosition&&d+1===f&&0>g&&(g=0),c.right.style.right=g+"px",h+=a.width+1},p=function(){n(),zd.options.resizeCells&&o()},q=function(){for(var a=rb(),c=function(){if(this.col.cache&&Ad&&Ad.rows[this.row]){var a=Ad.rows[this.row][zd.options.idProperty];Ad.postprocess[a]||(Ad.postprocess[a]={}),Ad.postprocess[a][this.col.id]=b(this.node).html()}};Qe>=Pe;){var d,e=$e>=0?Pe++:Qe--,f=Ad.nodes[e],g=Ad.rows[e];if(f&&!(e>=a)){Ad.postprocess[g[zd.options.idProperty]]||(Ad.postprocess[g[zd.options.idProperty]]={}),V(e);for(d in f.cellNodesByColumnIdx)if(f.cellNodesByColumnIdx.hasOwnProperty(d)){d=d||0;var h=Ad.activeColumns[d],i=h.postprocess,j=g.columns;if(j&&j[d]&&j[d].postprocess&&(i=j[d].postprocess),i&&!Ad.postprocess[g[zd.options.idProperty]][h.id]){var k=f.cellNodesByColumnIdx[d];k&&i({$cell:b(k),column:h,data:zd.getRowFromIndex(e),grid:zd,rowIndex:e},c.bind({node:k,col:h,row:e}))}}return clearTimeout(Ge),void(Ge=setTimeout(q,zd.options.asyncPostRenderDelay))}}},r=function(){var a,b,c,d,e,f,g=[],h=0,i=0,j=xd?yd-window.scrollbarDimensions.width:yd;for(j-=Ad.activeColumns.length,a=0;a<Ad.activeColumns.length;a++)b=Ad.activeColumns[a],b.visible!==!1&&(g.push(b.width),i+=b.width,b.resizable&&(h+=b.width-Math.max(b.minWidth||0,k)));for(c=i;i>j&&h;){var l=(i-j)/h;for(a=0;a<Ad.activeColumns.length&&i>j;a++){b=Ad.activeColumns[a];var m=g[a];if(!(b.visible===!1||!b.resizable||m<=(b.minWidth||0)||k>=m)){var o=Math.max(b.minWidth,k),p=Math.floor(l*(m-o))||1;p=Math.min(p,m-o),i-=p,h-=p,g[a]-=p}}if(i>=c)break;c=i}for(c=i;j>i;){for(d=j/i,a=0;a<Ad.activeColumns.length&&j>i;a++)b=Ad.activeColumns[a],b.visible===!1||!b.resizable||b.maxWidth&&b.maxWidth<=b.width||(e=1e6,b.maxWidth&&b.maxWidth-b.width&&(e=b.maxWidth-b.width),f=Math.min(Math.floor(d*b.width)-b.width,e)||1,i+=f,g[a]+=f);if(c>=i)break;c=i}var q,r=!1;for(a=0;a<Ad.activeColumns.length;a++)q=Ad.activeColumns[a],q.visible!==!1&&(!r&&q.rerenderOnResize&&q.width!=g[a]&&(r=!0),Ad.activeColumns[a].width=g[a]);n(),nd(!0),r&&(ec(),Lc())},s=function(){var a=new A,c=null,e=function(){return b(this).closest("."+Fd).length>0};d.on("draginit",{not:e},function(a){a.stopImmediatePropagation(),F()}).on("dragstart",{not:e},function(d,e){var f=fb(d);if(f&&(x(f.row,f.cell)&&(c=!0,d.stopImmediatePropagation()),c)){var g=hb(e.startX-b(this).offset().left,e.startY-b(this).offset().top);return e._range={end:g,start:g},a.show(new zc(g.row,g.cell))}}).on("drag",{not:e},function(d,e){if(c){d.stopImmediatePropagation();var f=hb(d.pageX-b(this).offset().left,d.pageY-b(this).offset().top);x(f.row,f.cell)&&(e._range.end=f,a.show(new zc(e._range.start.row,e._range.start.cell,f.row,f.cell)),zd.options.activateSelection&&w(f.row,f.cell)&&ad(ib(f.row,f.cell),!1))}}).on("dragend",{not:e},function(b,d){c&&(c=!1,b.stopImmediatePropagation(),a.hide(),zd._event=b,b.shiftKey||Q(),zd.selectCells(d._range.start.row,d._range.start.cell,d._range.end.row,d._range.end.cell,b.shiftKey),zd._event=null,zd.options.activateSelection&&mc())})},t=function(){d.on("dragstart",function(a,c){b(a.target).hasClass(re)&&(a.stopImmediatePropagation(),c._row=Ab(b(a.target).parent()[0]),c._rowNode=Ad.nodes[c._row].rowNode,c._rowsBelow=[],b(c._rowNode).siblings().each(function(){var a=Ab(this);a>c._row&&c._rowsBelow.push(this)}),b(c._rowsBelow).wrapAll('<div class="'+qe+'"></div>'),c._container=b(c._rowsBelow).parent())}).on("drag",function(a,c){if(void 0!==c._row){var d=c._rowNode,e=Ad.rowPositions[c._row],f=e.height||zd.options.rowHeight;c._height=f+c.deltaY,c._height<5&&(c._height=5),b(d).height(c._height),b(d).css("line-height",c._height+zd.options.lineHeightOffset+"px"),c._container.css({marginTop:c._height-f+"px"})}}).on("dragend",function(a,c){void 0!==c._row&&(b(c._rowsBelow).unwrap(),bd(c._row,c._height))})},u=function(a,b){a=a||0,0===a&&(Ad.indexById={},!b&&ud&&(Ad.rowPositions={0:{top:zd.options.rowSpacing,height:zd.options.rowHeight,bottom:zd.options.rowHeight+zd.options.rowSpacing,spacing:zd.options.rowSpacing}}));for(var c,d,e,f=a,g=Ad.rows.length;g>f;f++)c=Ad.rows[f],Ad.indexById[c[zd.options.idProperty]]=f,!b&&ud&&(d={top:Ad.rowPositions[f-1]?Ad.rowPositions[f-1].bottom-Ne:0},d.top+=0===f?0:1,e=null!==c.rowSpacing&&void 0!==c.rowSpacing?c.rowSpacing:zd.options.rowSpacing,"function"==typeof e&&(e=e(c)),d.spacing=e,d.top+=e,null!==c.height&&void 0!==c.height&&c.height!=zd.options.rowHeight&&(d.height="function"==typeof c.height?c.height(c):c.height),d.bottom=d.top+(null!==d.height&&void 0!==d.height?d.height:zd.options.rowHeight),Ad.rowPositions[f]=d)},v=function(){if(zd.options.autoHeight)return void(vc=zd.collection.length);if(ud){var a=j[0].scrollTop,b=Bb(vd+a);vc=b-Bb(a)}else vc=Math.floor(vd/(zd.options.rowHeight+1+zd.options.rowSpacing))},w=function(a,b){if(!zd.options.keyboardNavigation||a>=rb()||0>a||b>=Ad.activeColumns.length||0>b)return!1;var c=zd.getRowFromIndex(a);if("boolean"==typeof c.focusable)return c.focusable;var d=c.columns;return d&&d[Ad.activeColumns[b].id]&&"boolean"==typeof d[Ad.activeColumns[b].id].focusable?d[Ad.activeColumns[b].id].focusable:d&&d[b]&&"boolean"==typeof d[b].focusable?d[b].focusable:Ad.activeColumns[b].focusable},x=function(a,b){if(a>=rb()||0>a||b>=Ad.activeColumns.length||0>b)return!1;var c=zd.getRowFromIndex(a);if("boolean"==typeof c.selectable)return c.selectable;var d=c.columns&&(c.columns[Ad.activeColumns[b].id]||c.columns[b]);return d&&"boolean"==typeof d.selectable?d.selectable:Ad.activeColumns[b].selectable},z=function(a,b){return!(0>a||a>=rb()||0>b||b>=Ad.activeColumns.length)},A=function(){this.$el=null,this.show=function(a){this.$el||(this.$el=b('<div class="'+ne+'"></div>').appendTo(d),this.$stats=b('<span class="'+oe+'"></span>').appendTo(this.$el));var c=jb(a.fromRow,a.fromCell),e=jb(a.toRow,a.toCell),f=parseInt(this.$el.css("borderBottomWidth"),10),g=parseInt(this.$el.css("borderLeftWidth"),10),h=parseInt(this.$el.css("borderRightWidth"),10),i=parseInt(this.$el.css("borderTopWidth"),10);if(c&&e){var j=e.right-c.left-g-h;this.$el.css({top:c.top,left:c.left,height:e.bottom-c.top-f-i,width:j}),j>200?this.$stats.show().html(["<strong>Selection:</strong> ",a.getCellCount()," cells"," <strong>From:</strong> ",a.fromRow+1,":",a.fromCell+1," <strong>To:</strong> ",a.toRow+1,":",a.toCell+1].join("")):this.$stats.hide()}return this.$el},this.hide=function(){this.$el&&this.$el.length&&Ic(this.$el[0]),this.$el=null}},C=function(a){for(var b,c,d,e=[],f=[],g=0,h=a.top,i=a.bottom;i>=h;h++)if(b=Ad.nodes[h]){V(h),D(a,h),c=0;for(var j=zd.getRowFromIndex(h),k=j.columns,l=0,m=Ad.activeColumns.length;m>l&&!(Ad.columnPosLeft[l]>a.rightPx);l++)if(d=b.cellColSpans[l],null===d||void 0===d){if(d=1,k){var n=k[Ad.activeColumns[l].id]||k[l];d=n&&n.colspan||1,"*"===d&&(d=m-l)}Ad.columnPosRight[Math.min(m-1,l+d-1)]>a.leftPx&&(Mc(e,h,l,d,j),c++),l+=d>1?d-1:0}else l+=d>1?d-1:0;c&&(g+=c,f.push(h))}if(e.length){var o=document.createElement("div");o.innerHTML=e.join("");for(var p,q,r;null!==(p=f.pop())&&void 0!==p;)for(b=Ad.nodes[p];null!==(r=b.cellRenderQueue.pop())&&void 0!==r;)q=o.lastChild,b.rowNode.appendChild(q),b.cellNodesByColumnIdx[r]=q}},D=function(a,b){var c=0,d=Ad.nodes[b],e=[];for(var f in d.cellNodesByColumnIdx)if(d.cellNodesByColumnIdx.hasOwnProperty(f)){f=0|f;var g=d.cellColSpans[f];(Ad.columnPosLeft[f]>a.rightPx||Ad.columnPosRight[Math.min(Ad.activeColumns.length-1,f+g-1)]<a.leftPx)&&(!zd.active||b==zd.active.row&&f==zd.active.cell||e.push(f))}for(var h;null!==(h=e.pop())&&void 0!==h&&h;)d.rowNode.removeChild(d.cellNodesByColumnIdx[h]),delete d.cellColSpans[h],delete d.cellNodesByColumnIdx[h],Ad.postprocess[Ad.rows[b].id]&&delete Ad.postprocess[Ad.rows[b].id][Ad.activeColumns[h].id],c++},E=function(a){var b=zd.active&&"row"in zd.active?zd.active.row:null;for(var c in Ad.nodes)(c=parseInt(c,10))!==b&&(c<a.top||c>a.bottom)&&Kc(c)},F=function(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(a){}else if(window.getSelection){var b=window.getSelection();b&&b.removeAllRanges&&b.removeAllRanges()}},J=function(a){if(!zd.active||!zd.currentEditor)return a(!0);var c=zd.getRowFromIndex(zd.active.row),d=Ad.activeColumns[zd.active.cell],e=function(){var a=[],e=!1;if("selection"==zd.options.editorType&&zd.selection)for(var f=0,g=zd.selection.length;g>f;f++)for(var h=zd.selection[f].fromRow,i=zd.selection[f].toRow;i>=h;h++)for(var j=zd.selection[f].fromCell,k=zd.selection[f].toCell;k>=j;j++)hc(h,j)&&(h==zd.active.row&&j==zd.active.cell&&(e=!0),a.push({item:Ad.rows[h],column:Ad.activeColumns[j],row:h,cell:j,$cell:b(ib(h,j))}));return!e&&hc(zd.active.row,zd.active.cell)&&a.push({item:c,column:d,row:zd.active.row,cell:zd.active.cell,$cell:b(ib(zd.active.row,zd.active.cell))}),a},f=function(a){zd.currentEditor.showInvalid&&zd.currentEditor.showInvalid(a),zd.trigger("validationerror",zd._event,{editor:zd.currentEditor,cellNode:zd.active.node,validationResults:a,row:zd.active.row,cell:zd.active.cell,column:d}),zd.currentEditor.focus()};if(zd.currentEditor.isValueChanged()){var g=e();zd.currentEditor.validate(g,function(e){if(e===!0){if(c.__addRow){var h={data:{}};if(zd.currentEditor.applyValue([{item:h,column:d,row:zd.active.row,cell:zd.active.cell,$cell:b(ib(zd.active.row,zd.active.cell))}],zd.currentEditor.serializeValue()),!h.data.id&&!h.id||h.id in Ad.indexById||h.data.id in Ad.indexById)return f([{row:zd.active.row,cell:zd.active.cell,$cell:b(ib(zd.active.row,zd.active.cell)),msg:"Unable to create a new item without a unique 'id' value."}]);zd.add(h),zd.trigger("newrow",zd._event,{cell:zd.active.cell,column:d,item:h,row:zd.active.row})}else{zd.currentEditor.applyValue(g,zd.currentEditor.serializeValue());for(var i=0,j=g.length;j>i;i++)qd(g[i].row),zd.trigger("change",zd._event,{row:g[i].row,cell:g[i].cell,item:g[i].item})}Object.keys(Ad.aggregatorsByColumnId).length>0&&(Sc(),zd.options.data instanceof Backbone.Collection||zd.collection.refresh()),Q(),nc(),a(!0)}else f(e),a(!1)})}else a(!0);return!0},K=function(){var a;if(zd.selection){if(zd.selection.length>1)return alert("Sorry, you cannot copy multiple selections.");"csv"==zd.options.clipboard?a=zd.selection[0].toCSV():"json"==zd.options.clipboard&&(a=JSON.stringify(zd.selection[0].toJSON()))}if(!a&&zd.active&&zd.active.node){var c=Ab(zd.active.node.parentNode),d=gb(zd.active.node),e=Ad.rows[c],f=Ad.activeColumns[d];a=Eb(e,f)}a&&b('<textarea class="'+Gd+'"></textarea>').val(a).appendTo(zd.$el).focus().select().on("keyup",function(){Ic(this)})},L=function(){i=b('<style type="text/css" rel="stylesheet"></style>').appendTo(b("head"));for(var a=zd.options.rowHeight-Bd,c=["#"+Ze+" ."+pe+"{height:"+a+"px;line-height:"+(a+zd.options.lineHeightOffset)+"px}"],d=0,e=Ad.activeColumns.length;e>d;d++)c.push("#"+Ze+" .l"+d+"{}"),c.push("#"+Ze+" .r"+d+"{}");i[0].appendChild(document.createTextNode(c.join("\n")))},M=function(){var a=[zd.NAME];zd.options.class&&a.push(zd.options.class),"left"===zd.options.scrollbarPosition&&a.push(ke),zd.$el=b('<div class="'+a.join(" ")+'" id="'+Ze+'"></div>'),zd.options.showHeader&&(g=b('<div class="'+$d+'"></div>').appendTo(zd.$el),e=b('<div class="'+_d+'"></div>').appendTo(g).width(wb())),j=b(['<div class="',Ae,zd.options.autoHeight?" "+Dd:"",'"></div>'].join("")).appendTo(zd.$el),d=b('<div class="'+Be+'" tabindex="0"></div>').appendTo(j)},N=function(a){if(!a)throw new Error("Unable to create group because grouping object is missing.");if(void 0===a.column_id)throw new Error("Unable to create grouping object because 'column_id' is missing.");var c=kb(a.column_id),d=b.extend({collapsed:!0,column_id:c.id,comparator:function(a,b){if(zd.options.keepNullsAtBottom){if(null===a.value)return 1;if(null===b.value)return-1}for(var c=!0,d=0,e=zd.sorting.length;e>d;d++)if(zd.sorting[d].columnId==a.predef.column_id){c=zd.sorting[d].sortAsc;break}var f=tc(a.value,b.value);return c?f:-f},getter:function(a){return qb(a,c)},rows:[]},a);return d},G=function(a){var d,e,f,g,i,j,k,l,n,o,p,q,r,s,t=this,v=[],w=[],x=":|:",y={},z={},A=null,B=!0,C=[],D=0,E=null;return b.extend(this,Backbone.Events),this.items=[],this.filter=null,this.groups=[],this.length=0,this.initialize=function(){return!a.fetcher&&a.options.data&&this.reset(a.options.data),this},this.add=function(c,d){b.isArray(c)||(c=c?[c]:[]),d=d||{};var e,f,g=d.at,i=[];n(c),Xe=!0;for(var j=0,k=c.length;k>j;j++)if(e=c[j],f=this.get(e),f&&(f=f[1]),a.fetcher&&void 0!==g&&this.items[g+j].__placeholder&&(f=this.items[g+j]),f){if(!d.merge)throw new Error(["You are not allowed to add() items without a unique '",a.options.idProperty,"' value. ","A row with id '",f[a.options.idProperty],"' already exists."].join(""));this.setItem(f[a.options.idProperty],e)}else i.push(e);Xe=!1;var l=this.items.length;if(i.length){this.items.length&&h&&h.length&&a.hideOverlay(),!a.options.addRow||!(g&&g>this.items.length||null===g||void 0===g)||"__addRow"in i[0]||(g=this.items.length-1),null!==g&&void 0!==g?(Array.prototype.splice.apply(this.items,[g,0].concat(i)),u(g>0?g-1:0)):(Array.prototype.push.apply(this.items,i),u(l>0?l-1:0));for(j=0,k=i.length;k>j;j++)Ad.modelsById[i[j][a.options.idProperty]]=i[j]}return d.silent||(g&&(z.ignoreDiffsAfter=g+i.length),d.forced?this.refresh():this.refreshDebounced()),this},this.collapseAllGroups=function(a){d(a,!0)},this.collapseGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(x)?f(b.split(x).length-1,b,!0):f(a.length-1,a.join(x),!0)},this.expandAllGroups=function(a){d(a,!1)},d=function(b,c){if(null===b||void 0===b)for(var d=0,e=t.groups.length;e>d;d++)C[d]={},t.groups[d].collapsed=c;else C[b]={},t.groups[b].collapsed=c;t.refresh(),a.fetcher&&!c&&Dc()},f=function(b,c,d){C[b][c]=t.groups[b].collapsed^d,Sc(),t.refresh(),a.fetcher&&!d&&Dc()},this.expandGroup=function(){var a=Array.prototype.slice.call(arguments),b=a[0];1==a.length&&-1!=b.indexOf(x)?f(b.split(x).length-1,b,!1):f(a.length-1,a.join(x),!1)},V=function(a){var c=Ad.nodes[a];if(c&&c.cellRenderQueue.length)for(var d=b(c.rowNode).children("."+Ed).last()[0];c.cellRenderQueue.length;){var e=c.cellRenderQueue.pop();c.cellNodesByColumnIdx[e]=d,d=d.previousSibling}},g=function(b,c,d){var e,f,h,i,j,k,l,m,n,o=[],p={},q=c?c.level+1:0,r=t.groups[q],s=[];r.rows=[];var u=function(u){var v=function(b){var d=b?b.value:f,e=new Pb({column_id:r.column_id,collapsed:r.collapsed,formatter:r.formatter||ub(),level:q,parentGroup:c?c:null,predef:r,sticky:null!==r.sticky&&void 0!==r.sticky?r.sticky:!0,value:d,visible:r.groupNulls===!1&&null===d?!1:!0});return e[a.options.idProperty]="__group"+(c?c.id+x:"")+d,b&&(e.count=b.count),t.groups[q].rows.push(e),e};if(u)for(var w,y=0,z=u[q].groups.length;z>y;y++)w=u[q].groups[y],c&&w.parent[q-1]!=c.value||(e=v(w),o.push(e),p[e.value]=e);for(k=0,l=b.length;l>k;k++)if(h=b[k],h._aggregateRow&&"__gridAggregate"==h.id)m=h;else if(h.__addRow)n=h;else{if(h.__placeholder){for(var A=0,B=o.length;B>A;A++)if(o[A].count>o[A].grouprows.length){f=o[A].value;break}}else f="function"==typeof r.getter?r.getter(h):h[r.getter];e=p[f],e||(e=v(),o.push(e),p[f]=e),e.grouprows.push(h),a.fetcher||e.count++}for(i=0,j=o.length;j>i;i++)if(o[i].predef.dataExtractor&&o[i].predef.dataExtractor){o[i].data={};for(var C=0,D=a.options.columns.length;D>C;C++)o[i].data[a.options.columns[C].field]=o[i].predef.dataExtractor(o[i],a.options.columns[C])}if(q<t.groups.length-1){var E=function(a){e.groups=a};for(k=0,l=o.length;l>k;k++)i=o[k],e=i,i._aggregateRow||g(i.grouprows,i,E)}u||o.sort(t.groups[q].comparator.bind(a)),s.length&&(o=o.concat(s)),n&&o.push(n),m&&o.push(m),d(o)};a.fetcher&&!Ac()?Fc(function(a){u(a)}):u()},i=function(b,c){c=c||0;for(var d,e=t.groups[c],f=C[c],g=b.length,h=function(a){return a._aggregateRow};g--;)d=b[g],d.collapsed=e.collapsed^f[d.id],d.title=d.value,d.visible||(d.collapsed=0),d.groups&&(i(d.groups,c+1),d.grouprows=a.options.nestedAggregators?d.grouprows.filter(h):[])},j=function(b,c){c=c||0;for(var d,e,f=[],g=0,h=0,i=b.length;i>h;h++)if(e=b[h],f[g++]=e,!e.collapsed){if(d=e.groups?j(e.groups,c+1):e.grouprows,!d)continue;for(var k=0,l=d.length;l>k;k++)f[g++]=d[k];a.options.nestedAggregators&&e.groups&&1===e.grouprows.length&&e.grouprows[0]._aggregateRow&&(f[g++]=e.grouprows[0])}return f},k=function(b){if(t.filter&&!a.fetcher){var c=r,d=s;z.isFilterNarrowing?w=c(w):z.isFilterExpanding?w=d(b,v):z.isFilterUnchanged||(w=c(b))}else w=b.concat();return{totalRows:w.length,rows:w}},this.get=function(b){if(null===b)return void 0;var c=b;if("object"==typeof b&&(c=b[a.options.idProperty]||b.data&&b.data[a.options.idProperty],null===c||void 0===c))return null;var d=Ad.modelsById[c];return d?[this.items.indexOf(d),d]:null},l=function(b,c){var d,e,f,g=[],h=0,i=c.length;z&&z.ignoreDiffsBefore&&(h=Math.max(0,Math.min(c.length,z.ignoreDiffsBefore))),z&&z.ignoreDiffsAfter&&(i=Math.min(c.length,Math.max(0,z.ignoreDiffsAfter)));for(var j=h,k=b.length;i>j;j++)j>=k?g[g.length]=j:(d=c[j],e=b[j],f=d&&d.__nonDataRow||e&&e.__nonDataRow,d&&e&&(d._groupRow&&!e._groupRow||!d._groupRow&&e._groupRow||t.groups.length&&f&&d&&d._groupRow&&d[a.options.idProperty]!=e[a.options.idProperty]||d&&d._groupRow&&d.collapsed!=e.collapsed||d&&d._groupRow&&d.count!=e.count||f&&(d._aggregateRow||e._aggregateRow)||d&&d[a.options.idProperty]!=e[a.options.idProperty]||E&&E[d[a.options.idProperty]])&&(g[g.length]=j));return g},n=function(b,c){var d,e,f,g;for(d=0,e=b.length;e>d;d++){if(g=b[d],void 0===g[a.options.idProperty]||null===g[a.options.idProperty])throw new Error("Each data item must have a unique '"+a.options.idProperty+"' key. The following item is missing an '"+a.options.idProperty+"': "+JSON.stringify(g));if(c&&(Ad.modelsById[g[a.options.idProperty]]=g),g.rows)for(var h in g.rows){if(f=g.rows[h],!ud&&(void 0!==f.height&&null!==f.height&&f.height!=a.options.rowHeight||void 0!==f.rowSpacing&&null!==f.rowSpacing&&f.rowSpacing!=a.options.rowSpacing)){ud=!0;break}if(c&&(Ad.modelsById[f[a.options.idProperty]]=f),f.columns&&!De)for(var i in f.columns){if(De)break;f.columns[i].postprocess&&(De=!0)}}if(!ud&&(void 0!==g.height&&null!==g.height&&g.height!==a.options.rowHeight||void 0!==g.rowSpacing&&null!==g.rowSpacing&&g.rowSpacing!==a.options.rowHeight)&&(ud=!0),g.columns&&!De)for(var j in g.columns){if(De)break;g.columns[j].postprocess&&(De=!0)}}return b},o=function(){var b,c,d,e,f,g,h,i=w;for(c=0,d=i.length;d>c;c++)if(b=i[c],!(b instanceof _e))for(g in Ad.aggregatorsByColumnId){e=null;for(h in Ad.aggregatorsByColumnId[g])Ad.aggregatorsByColumnId[g][h].active&&(null===e?e=Ad.aggregatorsByColumnId[g][h]:Ad.aggregatorsByColumnId[g][h].active=!1);if(f=Object.keys(Ad.aggregatorsByColumnId[g]),null===e&&f.length&&(e=Ad.aggregatorsByColumnId[g][f[0]],e.active=!0),null!==e&&!e._processed){if("function"!=typeof e.process)throw new Error('The column aggregator for "'+g+"\" is missing a valid 'process' function.");e.process(b)}}for(g in Ad.aggregatorsByColumnId)for(h in Ad.aggregatorsByColumnId[g])Ad.aggregatorsByColumnId[g].active&&(Ad.aggregatorsByColumnId[g]._processed=!0);var j=new m(Ad.aggregatorsByColumnId);j[a.options.idProperty]="__gridAggregate",i.push(j)},p=function(b){var c,d,e,f,g,h,i,j,k;for(c=0,d=b.length;d>c;c++)if(e=b[c],e._groupRow){e.aggregators={};for(h in Ad.aggregatorsByColumnId){g=kb(h),e.aggregators[h]={};for(k in Ad.aggregatorsByColumnId[h])e.aggregators[h][k]=new g.aggregators[k].fn(g),"function"==typeof e.aggregators[h][k].reset&&e.aggregators[h][k].reset(),Ad.aggregatorsByColumnId[h][k].active&&(e.aggregators[h][k].active=!0)}for(i=0,j=b[c].grouprows.length;j>i;i++)if(f=b[c].grouprows[i],!(f instanceof _e))for(h in e.aggregators)for(k in e.aggregators[h])e.aggregators[h][k].process(f);var l=new m(e.aggregators);l[a.options.idProperty]="__gridAggregate-group-"+e.id,e.grouprows.push(l),e.groups&&e.groups.length&&p(e.groups)}},q=function(a,b){A=null,(z.isFilterNarrowing!=y.isFilterNarrowing||z.isFilterExpanding!=y.isFilterExpanding)&&(v=[]);var c=k(a);D=c.totalRows;var d=c.rows;Object.keys(Ad.aggregatorsByColumnId).length&&o();var e=function(a,b){for(var c in a.rows)a.rows[c].collapsed||(a.rows[c].parent=a,b.push(a.rows[c]),a.rows[c].rows&&e(a.rows[c],b))},f=function(){for(var a=[],c=0,f=d.length;f>c;c++)d[c].visible!==!1&&(a.push(d[c]),d[c].rows&&e(d[c],a));var g=l(Ad.rows,a);Ad.rows=a,g.length&&u(0),b(g)},h=[];t.groups.length&&t.items.length?g(d,null,function(a){h=a,h.length&&(Object.keys(Ad.aggregatorsByColumnId).length&&p(h),i(h),d=j(h)),f()}):f()},this.refresh=function(){if(!Xe&&!a.destroyed){var b,c=Ad.rows.length;q(this.items,function(d){b=d,E=null,y=z,z={},this.length=Ad.rows.length,c!=Ad.rows.length&&rd(),b.length>0&&(gc(b),Lc()),0===this.length?!a.fetcher&&a.options.emptyNotice&&cc():a.hideOverlay()}.bind(this)),Ke&&a.options.autoHeight&&a.resize()}},this.refreshDebounced=c.debounce(this.refresh,10),this.remove=function(b){if(void 0===b||null===b)throw new Error("Unable to delete collection item. Invalid '"+a.options.idProperty+"' supplied ("+b+").");var c=Ad.indexById[b];if(null===c||void 0===c)throw new Error(["Unable to remove row '",b,"' because no such row could be found in the grid."].join(""));this.items instanceof Backbone.Collection?this.items.remove(b):this.items.splice(this.get(b)[0],1),delete Ad.indexById[b],delete Ad.rowPositions[c],delete Ad.modelsById[b],u(c),this.refresh()},this.reset=function(a,b){a||(a=[]),Xe=!0,b&&(Ad.rows=[]),Ad.postprocess={},a instanceof Backbone.Collection&&(a=a.models.concat()),n(a,!0),this.items=w=a,b&&u(),Xe=!1,this.refresh()},this.setGrouping=function(c){if(!a.options.groupable)throw new Error('Cannot execute "setGrouping" because "options.groupable" is disabled.');if(c=c||[],!b.isArray(c))throw new Error("Unable to set grouping because given options are not an array. Given: "+JSON.stringify(c));c.length||(C=[]);var d=a.fetcher?Ac():!0;d||(Ad.remoteGroups=null);var e,f,g,h=[];for(e=0,f=c.length;f>e;e++){if(g=kb(c[e].column_id),void 0===g)throw new Error('Cannot add grouping for column "'+c[e].column_id+'" because no such column could be found.');if(g.groupable===!1)throw new Error('Cannot add grouping for column "'+g.id+'" because "options.groupable" is disabled for that column.');
!ud&&(void 0!==c[e].height&&null!==c[e].height||void 0!==c[e].rowSpacing&&null!==c[e].rowSpacing)&&(ud=!0),C[e]||(C[e]={}),h.push(N(c[e]))}var i=h.length!==this.groups.length;if(!i)for(e=0,f=h.length;f>e;e++)if(h[e].column_id!==this.groups[e].column_id){i=!0;break}Sc(),this.groups=h,a.sorting=rc(a.sorting),!d&&a.fetcher&&(this.length=this.remote_length,ab()),ud&&ec(),a.fetcher&&!d&&i?Gc():this.refresh(),ud&&Tc(!0),a.fetcher&&!d&&0===h.length&&Dc(),a.trigger("statechange",this._event,{})},this.setItem=function(b,d){var e=Ad.indexById[b],f=this.get(b);if(void 0===e&&null===f)throw new Error("Unable to update item ("+a.options.idProperty+": "+b+"). Invalid or non-matching id");if(a.options.data instanceof Backbone.Collection){if(!(d instanceof Backbone.Model))throw new Error("Sorry, Backbone.Collection data sets must be given a valid Backbone.Model in the setItem() method.");if(d[a.options.idProperty]!==b&&!f[1].__placeholder)throw new Error("Sorry, but Backbone does not support changing a model's id value, and as a result, this is not supported in Doby Grid either.")}if(Ad.postprocess[b]&&(delete Ad.postprocess[b],f[1].rows))for(var g in f[1].rows)Ad.postprocess[f[1].rows[g][a.options.idProperty]]&&delete Ad.postprocess[f[1].rows[g][a.options.idProperty]];if(Ad.rows[e]=d,b!==d[a.options.idProperty]&&(delete Ad.indexById[b],delete Ad.modelsById[b]),Ad.indexById[d[a.options.idProperty]]=e,Ad.modelsById[d[a.options.idProperty]]=d,(void 0===d[a.options.idProperty]||null===d[a.options.idProperty])&&(d[a.options.idProperty]=b),n([d]),this.items[f[0]]=d,d.rows){var h=c.chain(d.rows).map(function(c){return Ad.modelsById[b]=c,Ad.indexById[c[a.options.idProperty]]}).compact().value();h.length&&gc(h)}E||(E={}),E[b]=!0,b!==d[a.options.idProperty]&&(E[d[a.options.idProperty]]=!0),this.refreshDebounced()},this.sort=function(a,b){B=b,e=a,b===!1&&this.items.reverse(),this.items.sort(a),b===!1&&this.items.reverse(),u(null,!0),this.refresh()},r=function(a){for(var b=[],c=0,d=0,e=a.length;e>d;d++)(a[d].__nonDataRow||t.filter(a[d]))&&(b[c++]=a[d]);return b},s=function(a,b){for(var c,d=[],e=0,f=0,g=a.length;g>f;f++)c=a[f],b[f]?d[e++]=c:(a[f].__nonDataRow||t.filter(c))&&(d[e++]=c,b[f]=!0);return d},this.initialize()},O=function(a){return this.initialize=function(){this.loadValue(a.item);var c=this.currentValue;(null===c||void 0===c)&&(c=""),this.$input=b('<input type="text" class="'+Td+'" value="'+c+'"/>').appendTo(a.cell).on("keydown",function(a){if([9,13,33,34,35,36].indexOf(a.which)>=0)return void a.preventDefault();if(27!=a.which){var c=eb(this);(null===c&&38!=a.which&&40!=a.which||c>0&&37===a.which||c<b(this).val().length&&39===a.which)&&a.stopImmediatePropagation()}})},this.applyValue=function(a,b){for(var c,d=0,e=a.length;e>d;d++)c=a[d],zd.options.idProperty in c.item||c.column.field!=zd.options.idProperty||(c.item[zd.options.idProperty]=b),c.item instanceof Backbone.Model?c.item.set(c.column.field,b):c.item.data&&(c.item.data[c.column.field]=b)},this.cancel=function(){},this.destroy=function(){a.grid.$el.find("."+ie).removeClass(ie),this.$input.remove()},this.focus=function(){this.$input.focus().select()},this.getValue=function(){return this.$input.val()},this.isValueChanged=function(){return!(""===this.$input.val()&&null===this.currentValue)&&this.$input.val()!=this.currentValue},this.loadValue=function(b){if(!b)return null;var c=b instanceof Backbone.Model?b.get(a.column.field):b.data?b.data[a.column.field]:null;return this.currentValue=c||"",this.currentValue},this.serializeValue=function(){return this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.showInvalid=function(a){for(var b,c=0,d=a.length;d>c;c++)b=a[c],b.$cell.append(['<span class="',je,'" title="',b.msg,'"></span>'].join("")),b.$cell.removeClass(ie).width(),b.$cell.addClass(ie)},this.validate=function(a,b){var c=[];0===c.length&&(c=!0),b(c)},this.initialize()},P=function(a,b,c,d,e){return void 0===c||null===c?"":(c+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},Q=function(a,b){if(zd.selection){for(var c=void 0!==a&&null!==a,d=c&&void 0!==b&&null!==b,e=0,f=zd.selection.length;f>e;e++)d?zd.selection[e].contains(a,b)&&zd.selection[e].deselect(a,b):c?zd.selection[e].contains(a)&&zd.selection[e].deselect(a):zd.selection[e].deselect();if(d||c||(zd.selection=null),zd.selection){var g=[];for(e=0,f=zd.selection.length;f>e;e++)zd.selection[e].fullyExcluded()||g.push(zd.selection[e]);zd.selection=0===g.length?null:g}}},R=function(a){Q(a);var c=Ad.nodes[a]?Ad.nodes[a].rowNode:null;c&&b(c).addClass(zd.options.selectedClass)},this.destroy=function(){if(this.destroyed)return void console.warn("Doby Grid instance has already been destroyed. You do not need to manually call destroy().");this.destroyed=!0,this.stopListening(),this.options.reorderable&&this.options.showHeader&&e.filter(":ui-sortable").sortable("destroy"),this.dropdown&&(this.dropdown.hide(),this.dropdown=null),this.$el&&this.$el.length&&(this.$el.off(),this.$el.remove(),Ic(this.$el[0])),this.$el=null,b(document.body).off("click contextmenu",Rb),Hc(),this.options.showHeader&&e&&e.length&&(e.off(),Ic(e[0])),e=null,b(window).off("resize",Zb);for(var a=[Ge,Fe,Te],c=0,d=a.length;d>c;c++)a[c]&&(clearTimeout(a[c]),a[c]=null);for(var f in Ad.nodes)Ic(Ad.nodes[f].rowNode);this.collection.items=null,this.options.data=null,Ad=null,b(_).remove(),_=null},S=function(a){a&&a.jquery&&a.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})},T=function(a,c){return this.open=!1,this.initialize=function(){this.$parent=c.parent||b(a.currentTarget),this.$el=c.menu,this.id=[Ze,Ld,c.id].join("_");var d=null;this.$parent.data(Ld)?(d=this.$parent.data(Ld).filter(function(a){return a.id==this.id}.bind(this)),d&&(d=d[0])):this.$parent.data(Ld,[]),d&&d.open?d.hide():(this.$el.attr("id",this.id),this.$el.addClass(["off",Ld].join(" ")),this.show());var e;e=function(c){c.target!=a.target&&(this.hide(),b(document).off("click",e),b(document).off("context",e))}.bind(this),b(document).on("click",e),b(document).on("contextmenu",e);var f;return f=function(a){27==a.keyCode&&(this.hide(),b(document).off("keydown",f))}.bind(this),b(document).one("keydown",f),this},this.position=function(){var c=a.pageY,d=a.pageX,e=this.$el.outerWidth(),f=this.$el.outerHeight(),g=a.clientX+e,h=a.clientY+f,i=b(document.body),j=i.width(),k=i.height();g>j&&(d-=e),g+e>j&&this.$el.addClass(Rd),h>k&&(c-=f),this.$el.css({left:Math.max(d,0),top:Math.max(c,0)});var l,m,n,o,p,q;this.$el.children("."+Md+":first").find("."+Md).each(function(){l=b(this).position(),m=b(this).offset(),n=b(this).outerHeight(),o=b(this).outerWidth(),q=b(this).parent().outerWidth(),p=m.left+q-Math.min(l.left,0)+o>j?"drop-left":"drop-right",b(this).addClass(p),"drop-left"==p&&b(this).css("left",-o+"px"),b(this).addClass(a.clientY+n>k?"drop-up":"drop-down")})},this.initialize()},T.prototype.show=function(){if(!this.open){this.$el.appendTo(document.body),this.position();var a=this.$parent.data(Ld);a.push(this),this.$parent.data(Ld,a),setTimeout(function(){this.$el.removeClass("off")}.bind(this),150),this.open=!0}},T.prototype.hide=function(){if(this.open&&this.$parent&&this.$parent.data(Ld)){var a=this.$parent.data(Ld).filter(function(a){return a!=this}.bind(this));this.$parent.data(Ld,a),this.$el.addClass("off"),setTimeout(function(){Ic(this.$el[0])}.bind(this),150),this.open=!1}},U=function(a){for(var c,d=0,e=a.length;e>d;d++)c=a[d]=b.extend(JSON.parse(JSON.stringify(af)),a[d]),c.minWidth&&c.width<c.minWidth&&(c.width=c.minWidth),c.maxWidth&&c.width>c.maxWidth&&(c.width=c.maxWidth);return a},W=function(a){var b=a.sortCols;return zd.fetcher&&!Ac()?(zd.collection.length=zd.collection.remote_length,ab(),zd.collection.refresh(),void(zd.collection.groups.length?Gc():Dc())):void zd.collection.sort(function(a,c){var d,e,f,g,h,i;if(a._aggregateRow)return 1;if(c._aggregateRow)return-1;for(var j=0,k=b.length;k>j;j++)if(d=b[j].sortCol,e=d.field,f=b[j].sortAsc?1:-1,g=qb(a,d),h=qb(c,d),"function"==typeof d.comparator){if(i=d.comparator(g,h)*f,0!==i)return i}else{if(zd.options.keepNullsAtBottom){if(null===g&&null===h)continue;if(null===g)return 1;if(null===h)return-1}if(i=tc(g,h)*f,0!==i)return i}return 0})},this.export=function(a,b){var c=["csv","html"];if(c.indexOf(a)<0)throw new Error('Sorry, "'+a+'" is not a supported format for export.');b=b||function(){};var d=function(){var c,d,e,f,g,h,i=[];"html"===a&&i.push("<table><thead><tr>");var j=[];for(c=0,d=Ad.activeColumns.length;d>c;c++)h=Ad.activeColumns[c].name||"","csv"===a?(h=h.replace(/\"/g,'"'),j.push(['"',h,'"'].join(""))):"html"===a&&(j.push("<th>"),j.push(h),j.push("</th>"));for("csv"===a?i.push(j.join(",")):"html"===a&&(i.push(j.join("")),i.push("</tr></thead><tbody>")),c=0,d=this.collection.items.length;d>c;c++)if(!(this.collection.items[c]instanceof _e)){for(e=[],"html"===a&&e.push("<tr>"),f=0,g=Ad.activeColumns.length;g>f;f++)h=Eb(this.collection.items[c],Ad.activeColumns[f]),"csv"===a?(h=null!==h&&void 0!==h?h.toString().replace(/\"/g,'"'):"",e.push(['"',h,'"'].join(""))):"html"===a&&(e.push("<td>"),e.push(h),e.push("</td>"));"csv"===a?i.push(e.join(",")):"html"===a&&(e.push("</tr>"),i.push(e.join("")))}"html"===a&&i.push("</tbody></table>"),"csv"===a?i=i.join("\n"):"html"===a&&(i=i.join("")),b(i)}.bind(this),e=this.fetcher&&!Ac()?confirm("Are you sure you want to export all data? This will require a full data fetch on the server."):!0;return e&&(this.fetcher?this.remoteFetchAll(function(){d()}):d()),this},this.filter=function(a){if(null===a||void 0===a)this.collection.filterset=null,this.collection.filter=null;else if(b.isArray(a)&&(this.collection.filterset=a),"function"==typeof a||this.fetcher)this.collection.filter=a;else{if(!b.isArray(a))throw new Error("Cannot apply filter to grid because given filter must be an array or a function, but given "+typeof a+".");this.collection.filter=function(c){for(var d,e,f,g,h=!0,i=0,j=a.length;j>i;i++){if(d=a[i],3!==d.length)throw new Error("Cannot apply filter because the give filter set contains an invalid filter item: "+JSON.stringify(d)+".");if(e=kb(d[0]),!e)throw new Error('Unable to filter by "'+d[0]+'" because no such columns exists in the grid.');switch(f=qb(c,e),d[1].toString().toLowerCase()){case"=":h=f==d[2];break;case"!=":h=f!==d[2];break;case"in":if(!b.isArray(d[2]))throw new Error('The "IN" filter operator must be used with an array. '+d[2]+" was given instead.");h=d[2].indexOf(f)>=0;break;case">":g=null===f?void 0:f,h=g>d[2];break;case"<":g=null===f?void 0:f,h=g<d[2];break;case">=":g=null===f?void 0:f,h=g>=d[2];break;case"<=":g=null===f?void 0:f,h=g<=d[2];break;case"~":g=null===f?"":f,h=-1!==g.toString().search(d[2].toString());break;case"!~":g=null===f?"":f,h=-1===g.toString().search(d[2].toString());break;case"~*":g=null===f?"":f,h=-1!==g.toString().toLowerCase().search(d[2].toString().toLowerCase());break;case"!~*":g=null===f?"":f,h=-1===g.toString().toLowerCase().search(d[2].toString().toLowerCase());break;default:throw new Error('Unable to filter by "'+d[0]+'" because "'+d[1]+'" is not a valid operator.')}if(!h)break}return h},zd.trigger("statechange",this._event)}return this.fetcher?Ke&&this.refetch():(Sc(),this.collection.refresh()),this},X=function(a){for(var b=0;b<Ad.activeColumns.length;){if(w(a,b))return b;b+=pb(a,b)}return null},Y=function(a){for(var b=0,c=null;b<Ad.activeColumns.length;)w(a,b)&&(c=b),b+=pb(a,b);return c},Z=function(a){if(Ke){var b=a.width,c=Ad.columnsById[a.id];a._headerWidth=nb(c);var d,e=Math.max(a.width,a._headerWidth);if(b!=e){kc(c);var f=e-b;d=Ad.columnPosRight[c],yc(c,d);var g=Math.min(oc,Math.max(pc,d+f))-d;Uc(c,g)}}},$=function(a){if(Ke){for(var b=0,c=Ad.activeColumns.length;c>b;b++)Z(Ad.activeColumns[b]);p(),kd(a)}},ab=function(){zd.collection.items=[],zd.options.data instanceof Backbone.Collection&&zd.options.data.reset(null,{silent:!0});var a,b,c,d;for(c=0,d=zd.collection.length;d>c;c++)a="placeholder-"+c,b=new xc,b[zd.options.idProperty]=a,zd.collection.items.push(b),Ad.modelsById[a]=b;if(zd.collection.groups.length)for(c=0,d=zd.collection.groups.length;d>c;c++)for(var e=0,f=zd.collection.groups[c].rows.length;f>e;e++)zd.collection.groups[c].rows[e].grouprows=[]},this.get=function(a){var b=this.collection.get(a);return b&&(b=b[1]),b},this.getIndex=function(a){return Ad.indexById[a]},Db=function(){var a=0;for(var c in Ad.nodes)a+=b(Ad.nodes[c].rowNode).outerHeight();return a},bb=function(){return zd.active&&zd.active.node?{row:zd.active.row,cell:zd.active.cell}:null},cb=function(){window.maxSupportedCssHeight=window.maxSupportedCssHeight||yb(),window.scrollbarDimensions=window.scrollbarDimensions||Cb()},db=function(){var a,b,c=yd-(xd?window.scrollbarDimensions.width:0),d=0;for(a=0,b=Ad.activeColumns.length;b>a;a++)d+=Ad.activeColumns[a].width-zd.options.columnSpacing+(zd.options.fullWidthRows?2:0);var e=zd.options.fullWidthRows?Math.max(d,c):d+2*b;return"left"==zd.options.scrollbarPosition&&e--,e},eb=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else{if(a.selectionStart!==a.selectionEnd)return null;(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart)}return b},gb=function(a){var b=/l\d+/.exec(a.className);if(!b)throw"getCellFromNode: cannot get cell - "+a.className;return parseInt(b[0].substr(1,b[0].length-1),10)},hb=function(a,b){for(var c=Bb(b),d=0,e=0,f=0,g=Ad.activeColumns.length;g>f&&a>e;f++)e+=Ad.activeColumns[f].width,d++;return 0>d&&(d=0),{cell:d-1,row:c}},ib=function(a,b){if(Ad.nodes[a]){V(a);var c=b;if(!Ad.nodes[a].cellColSpans[b])for(var d=0,e=b;e>=d;d++)Ad.nodes[a].cellColSpans[d]&&Ad.nodes[a].cellColSpans[d]>1&&(c-=Ad.nodes[a].cellColSpans[d]-1);return c=0>c?0:c,Ad.nodes[a].cellNodesByColumnIdx[c]}return null},jb=function(a,b){if(!z(a,b))return null;var c,d;if(ud){var e=Ad.rowPositions[a];c=e.top-1,d=c+(null!==e.height&&void 0!==e.height?e.height:zd.options.rowHeight)+2}else c=(zd.options.rowHeight+zd.options.rowSpacing)*a-Ne+a-1,d=c+zd.options.rowHeight+2+zd.options.rowSpacing;for(var f=-1,g=0;b>g;g++)f+=Ad.activeColumns[g].width+1;var h=f+Ad.activeColumns[b].width+2;return{bottom:d,left:f,right:h,top:c}},fb=function(a){var c=b(a.target).closest("."+Ed,d);if(!c.length)return null;var e=Ab(c[0].parentNode),f=gb(c[0]);return null===e||null===f?null:{row:e,cell:f}},pb=function(a,b){var c=zd.getRowFromIndex(a);if(!c.columns)return 1;var d=c.columns[Ad.activeColumns[b].id]||c.columns[b],e=d&&d.colspan;return e="*"===e?Ad.activeColumns.length-b:e||1},kb=function(a){return c.findWhere(zd.options.columns,{id:a})},lb=function(a){if(!id){var b,c,d=document.styleSheets;for(b=0,c=d.length;c>b;b++)if((d[b].ownerNode||d[b].owningElement)==i[0]){id=d[b];break}if(!id)throw new Error("Cannot find stylesheet.");H=[],I=[];var e,f,g=id.cssRules||id.rules;for(b=0;b<g.length;b++){var h=g[b].selectorText;e=new RegExp(/\.l\d+/).exec(h),e?(f=parseInt(e[0].substr(2,e[0].length-2),10),H[f]=g[b]):(e=new RegExp(/\.r\d+/).exec(h),e&&(f=parseInt(e[0].substr(2,e[0].length-2),10),I[f]=g[b]))}}return{left:H[a],right:I[a]}},mb=function(a){if(zd.options.showHeader){var c=[];c.push(nb(a));var d,e="r"+a;for(var f in Ad.nodes)if(!(Ad.rows[f].columns&&Ad.rows[f].columns[a]&&Ad.rows[f].columns[a].colspan&&1!==Ad.rows[f].columns[a].colspan)&&(d=b(Ad.nodes[f].cellNodesByColumnIdx[a]),0===d.length&&(d=b(Ad.nodes[f].rowNode).children(".l"+a)),0!==d.length)){d.removeClass(e);var g=d.outerWidth();c.indexOf(g)<0&&c.push(g),d.addClass(e)}return Math.max.apply(null,c)}},nb=function(a){if(zd.options.showHeader){var c=e.children(),d=Ad.activeColumns[a],f=b(c[a]),g=f.width(),h=parseInt(f.css("paddingLeft"),10)+parseInt(f.css("paddingRight"),10),i=f.children("."+Id+":first");i.css("overflow","visible"),f.width("auto");var j=f.width()+h+1;if(_b(d.id)){var k=f.find("."+ue);j+=k.width()}return i.css("overflow",""),f.width(g),j}},ob=function(a){var c=b(a.target).closest("."+ae+":not(."+me+")");if(!c.length){var d=fb(a);return d?Ad.activeColumns[d.cell]:null}var e=c&&c.length?c.attr("id").replace(Ze,""):null;return e?kb(e):null},qb=function(a,b){return b.dataExtractor?b.dataExtractor(a,b):zd.options.dataExtractor?zd.options.dataExtractor(a,b):a instanceof Backbone.Model?a.get(b.field):a._groupRow?a.predef.dataExtractor?a.predef.dataExtractor(a,b):a.value:a.data?a.data[b.field]:null},rb=function(){return zd.collection?zd.collection.length:0},sb=function(a,b){var c=Ad.activeColumns[b],d=zd.getRowFromIndex(a),e=d.columns;return e&&e[c.id]&&void 0!==e[c.id].editor?e[c.id].editor:e&&e[b]&&void 0!==e[b].editor?e[b].editor:c.editor||zd.options.editor||O},tb=function(a,b){var c=a.columns&&(a.columns[b.id]||a.columns[Ad.columnsById[b.id]]),d=a.formatter?a.formatter.bind(a):null||c&&c.formatter||b.formatter||zd.options.formatter||P;return d.bind(zd)},ub=function(){return function(a,b,c,d,e){if("*"!==e.columns[0].colspan)return c;var f=kb(e.column_id),g=15*e.level,h=["<strong>"+f.name+":</strong> ",null===e.value?"-empty-":e.value,' <span class="count">(<strong>'+e.count+"</strong> item"];return 1!==e.count&&h.push("s"),h.push(")</span>"),[g?'<span style="margin-left:'+g+'px">':"",'<span class="icon"></span>','<span class="'+Xd+'">',h.join(""),"</span>",g?"</span>":""].join("")}},vb=function(a){var b=null,c=Ad.rows[a];if(0===zd.collection.groups.length)return b;var d=function(a){for(var e,f,g=0,h=a.length;h>g&&!b;g++){if(e=a[g],e==c){b=e;break}if(e.grouprows)for(var i=0,j=e.grouprows.length;j>i;i++)if(f=e.grouprows[i],f==c){b=e;break}e.groups&&d(e.groups)}};return d(zd.collection.groups[0].rows),b},wb=function(){for(var a=0,b=0,c=Ad.activeColumns.length;c>b;b++)a+=Ad.activeColumns[b].width+1;return a+=window.scrollbarDimensions.width,Math.max(a,yd)+1e3},xb=function(a,b){b=b||{};for(var d=zd.options.locale,e=a.split("."),f=0,g=e.length;g>f;f++)d=d[e[f]];if(!d)throw new Error('Doby Grid does not have a locale string defined for "'+a+'"');return c.template(d,b,{interpolate:/\{\{(.+?)\}\}/gim})},yb=function(){for(var a,c=1e6,d=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,e=b('<div style="display:none"></div>').appendTo(document.body);;){if(a=2*c,e.css("height",a),a>d||e.height()!==a)break;c=a}return Ic(e[0]),c},zb=function(a,b){var c,d=Hb(a,b),e=3;return c=Math.round(ud?Bb(vd):vd/(zd.options.rowHeight+zd.options.rowSpacing)),-1==$e?(d.top-=c,d.bottom+=e):1==$e?(d.top-=e,d.bottom+=c):(d.top-=e,d.bottom+=e),d.top=Math.max(0,d.top),d.bottom=Math.min(rb()-1,d.bottom),d.leftPx-=yd,d.rightPx+=yd,d.leftPx=Math.max(0,d.leftPx),d.rightPx=Math.min(y,d.rightPx),d},this.getRowFromEvent=function(a){var c=b(a.target).closest("."+pe,d);return c.length?Ad.rows[Ab(c[0])]:null},this.getRowFromIndex=function(a){return Ad.rows[a]},Ab=function(a){for(var b in Ad.nodes)if(Ad.nodes[b].rowNode===a)return 0|b;return null},Bb=function(a){if(!ud)return Math.floor((a+Ne)/(zd.options.rowHeight+1+zd.options.rowSpacing));var b,c,d,e=0,f=Ad.rows.length;if(f){for(d=0;f>d;d++)if(b=Ad.rowPositions[d],b.top-b.spacing<=a&&b.bottom>=a){e=d;break}return c=Ad.rowPositions[f-1],a>c.bottom&&(e=f-1),e}},Cb=function(){var a="position:absolute;top:-10000px;left:-10000px;width:100px;height:100px;overflow:scroll",c=b("<div style='"+a+"'></div>").appendTo(b(document.body)),d={width:c.width()-c[0].clientWidth,height:c.height()-c[0].clientHeight};return Ic(c[0]),d},this.getSelectedRows=function(){var a=[];if(this.selection)for(var b=0,c=this.selection.length;c>b;b++){var d=this.selection[b].toRows();for(var e in d)a.push(d[e])}return a},this.getState=function(a){a=a||{};var b,c,d,e,f,g={autoColumnWidth:this.options.autoColumnWidth,columns:[],filters:[],grouping:[],sort:[]};for(b=0,c=Ad.activeColumns.length;c>b;b++)if(d=Ad.activeColumns[b],d.visible){var h={id:d.id,width:d.width};if(a.column_properties)for(var i=0,j=a.column_properties.length;j>i;i++)void 0!==d[a.column_properties[i]]&&(h[a.column_properties[i]]=d[a.column_properties[i]]);g.columns.push(h)}if(this.collection&&this.collection.filterset&&(g.filters=this.collection.filterset),this.options.groupable&&this.collection&&this.collection.groups)for(b=0,c=this.collection.groups.length;c>b;b++)e=this.collection.groups[b],g.grouping.push({collapsed:e.collapsed,column_id:e.column_id});if(this.sorting)for(b=0,c=this.sorting.length;c>b;b++)f=this.sorting[b],f.group||g.sort.push({columnId:f.columnId,sortAsc:f.sortAsc});return g},Eb=function(a,b){return"function"==typeof a.exporter?a.exporter(b,a).toString():b.exporter&&"function"==typeof b.exporter?b.exporter(b,a).toString():qb(a,b)},Fb=function(a){var c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=0;return b.each(c,function(b,c){d+=parseFloat(a.css(c))||0}),d},Gb=function(){return Math.max(zd.$el.height()-(zd.options.showHeader?g.outerHeight()-Fb(g):0)-1,0)},Hb=function(a,b){(void 0===a||null===a)&&(a=Ve),(void 0===b||null===b)&&(b=Ue);var c,d;return zd.options.autoHeight?(c=0,d=zd.collection.length-1):ud?(c=Math.floor(Bb(a+Ne)),d=Math.ceil(Bb(a+Ne+vd))):(c=Bb(a),d=Bb(a+vd)+1),isNaN(c)&&(c=null),isNaN(d)&&(d=null),{top:c,bottom:d,leftPx:b,rightPx:b+yd}},Ib=function(a,b,c){if(Ke&&w(a,b)){Wc(a,b,!1);var d=ib(a,b);ad(d,c||a===rb()||zd.options.autoEdit)}},Jb=function(a,b,c){for(var d,e=rb();;){if(++a>=e)return null;for(d=b=0;c>=b;)d=b,b+=pb(a,b);if(w(a,d))return{row:a,cell:d,posX:c}}},Kb=function(a,b){if(0>=b)return null;var c=X(a);if(null===c||c>=b)return null;for(var d,e={row:a,cell:c,posX:c};;){if(d=Nb(e.row,e.cell,e.posX),!d)return null;if(d.cell>=b)return e;e=d}},Lb=function(a,b,c){if(null===a&&null===b&&(a=b=c=0,w(a,b)))return{row:a,cell:b,posX:b};var d=Nb(a,b,c);if(d)return d;for(var e=null,f=rb();++a<f;)if(e=X(a),null!==e)return{row:a,cell:e,posX:e};return null},Mb=function(a,b,c){if(null===a&&null===b&&(a=rb()-1,b=c=Ad.activeColumns.length-1,w(a,b)))return{row:a,cell:b,posX:b};for(var d,e;!d&&!(d=Kb(a,b,c));){if(--a<0)return null;b=0,e=Y(a),null!==e&&(d={row:a,cell:e,posX:e})}return d},Nb=function(a,b){if(b>=Ad.activeColumns.length)return null;do b+=pb(a,b);while(b<Ad.activeColumns.length&&!w(a,b));return b<Ad.activeColumns.length?{row:a,cell:b,posX:b}:null},Ob=function(a,b,c){for(var d;;){if(--a<0)return null;for(d=b=0;c>=b;)d=b,b+=pb(a,b);if(w(a,d))return{row:a,cell:d,posX:c}}},Pb=function(a){a=a||{},b.extend(this,{count:0,groups:null,id:null,level:0,grouprows:[],selectable:!1,title:null,value:null},a),this.predef&&(void 0!==this.predef.height&&null!==this.predef.height&&(this.height=this.predef.height),void 0!==this.predef.rowSpacing&&null!==this.predef.rowSpacing&&(this.rowSpacing=this.predef.rowSpacing),void 0!==this.predef.colspan&&(this.columns[0].colspan=this.predef.colspan))},Pb.prototype=new _e,Pb.prototype._groupRow=!0,Pb.prototype.class=function(a,b){var c=b.collapsed?Hd:Vd,d=[Wd,zd.options.collapsible?Yd:null,c];return b.predef.class&&d.push("function"==typeof b.predef.class?b.predef.class.bind(zd)(a,0,b.value,Ad.activeColumns[0],b):b.predef.class),d.join(" ")},Pb.prototype.columns={0:{colspan:"*",focusable:!1,selectable:!1}},Pb.prototype.toString=function(){return"Group"},Rb=function(a){zd.options.stickyFocus||b(a.target).closest(zd.$el).length>0||zd.dropdown&&b(a.target).closest(zd.dropdown.$el).length>0||0===b(a.target).parent().length||zd.destroyed||(zd.activate(null),Q())},Sb=function(a){var c=fb(a);if(c&&null!==c.row&&void 0!==c.row&&(null===zd.currentEditor||!zd.active||zd.active.row!=c.row||zd.active.cell!=c.cell)){var d=zd.getRowFromIndex(c.row);if(zd.options.collapsible&&d&&d._groupRow){var e=b(a.target).hasClass(Yd)||b(a.target).closest("."+Yd).length;if(e)return d.collapsed?zd.collection.expandGroup(d[zd.options.idProperty]):zd.collection.collapseGroup(d[zd.options.idProperty]),a.stopImmediatePropagation(),void a.preventDefault()}if(c&&(zd.trigger("click",a,{cell:c.cell,column:Ad.activeColumns[c.cell],item:d,row:c.row}),!a.isImmediatePropagationStopped()&&w(c.row,c.cell))){var f=zd.options.shiftSelect&&a.shiftKey,g=zd.options.ctrlSelect&&(a.ctrlKey||a.metaKey);if(zd.options.rowBasedSelection){var h=zd.selection&&zd.selection[zd.selection.length-1];if(g&&zd.active&&(ic(c.row)?R(c.row):f||zd.selectRows(c.row,c.row,!0)),f&&zd.active)if(R(zd.active.row),g)zd.selectRows(zd.active.row,c.row,!0);else if(h){Q();var i=zd.active.row==h.fromRow,j=i?h.toRow:h.fromRow;c.row<h.fromRow?zd.selectRows(c.row,j,!0):c.row>h.toRow?zd.selectRows(j,c.row,!0):i?zd.selectRows(c.row,j,!0):zd.selectRows(j,c.row,!0)}else zd.selectRows(zd.active.row,c.row,!0);g||f||(Q(),zd.selectRows(c.row,c.row,!0)),F()}else if(f&&zd.active&&(Q(),zd.selectCells(zd.active.row,zd.active.cell,c.row,c.cell)),g&&zd.active)return ic(c.row,c.cell)?void Q(c.row,c.cell):(zd.selection||zd.selectCells(zd.active.row,zd.active.cell,zd.active.row,zd.active.cell,!0),void zd.selectCells(c.row,c.cell,c.row,c.cell,!0));Zc(c.row,!1),ad(ib(c.row,c.cell))}}},Tb=function(a){var c=b(a.target).closest("."+Ed,d);if(0!==c.length&&(zd.options.deactivateOnRightClick&&zd.active&&zd.activate(),!zd.active||zd.active.node!==c[0]||null===zd.currentEditor)){var e=ob(a),f=fb(a)||{};zd.trigger("contextmenu",a,{cell:null!==f.cell&&void 0!==f.cell?f.cell:null,column:e,item:zd.getRowFromIndex(f.row),row:null!==f.row&&void 0!==f.row?f.row:null})}},Ub=function(a){var b=fb(a);if(b&&(null===zd.currentEditor||!zd.active||zd.active.row!=b.row||zd.active.cell!=b.cell)){var c=ob(a);zd.trigger("dblclick",a,{cell:null!==b.cell&&void 0!==b.cell?b.cell:null,column:c,item:zd.getRowFromIndex(b.row),row:null!==b.row&&void 0!==b.row?b.row:null}),a.isImmediatePropagationStopped()||zd.options.editable&&Ib(b.row,b.cell,!0)}},Wb=function(a){var b=ob(a);b&&zd.trigger("headerclick",a,{column:b})},Vb=function(a){var b=ob(a);zd.trigger("headercontextmenu",a,{column:b})},Xb=function(a){zd.active&&zd.trigger("keydown",a,{row:zd.active.row,cell:zd.active.cell});var b=a.isImmediatePropagationStopped();if(this._event=a,b||(67!=a.which||!a.ctrlKey&&!a.metaKey||a.altKey||a.shiftKey?a.shiftKey||a.altKey||a.ctrlKey?9!=a.which||!a.shiftKey||a.ctrlKey||a.altKey||(b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("prev")}):uc("prev")):27==a.which?zd.options.editable&&zd.currentEditor?(zd.currentEditor.cancel(),nc(),d.focus(),b=!0):zd.selection?Q():zd.active&&zd.activate():34==a.which?(Yc(1),b=!0):33==a.which?(Yc(-1),b=!0):36==a.which?(zd.scrollToRow(0),b=!0):35==a.which?(zd.scrollToRow(zd.collection.items.length-1),b=!0):37==a.which?b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("left")}):uc("left"):39==a.which?b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("right")}):uc("right"):38==a.which?b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("up")}):uc("up"):40==a.which?b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("down")}):uc("down"):9==a.which?b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("next")}):uc("next"):13==a.which&&(b=zd.options.editable&&zd.currentEditor?J(function(a){a&&uc("down")}):uc("down")):K()),this._event=null,b){a.stopPropagation(),a.preventDefault();try{a.originalEvent.which=0}catch(c){}}},Yb=function(a){void 0===a&&(a=null),Ve=j[0].scrollTop,Ue=j[0].scrollLeft;var c=Math.abs(Ve-Se),d=Math.abs(Ue-Re);if(d&&(Re=Ue,zd.options.showHeader&&(g[0].scrollLeft=Ue)),c){if($e=Ve>Se?1:-1,Se=Ve,vd>c)$c(Ve+Ne);else{var e=Ne;Oe=Qb==vd?0:Math.min(sc-1,Math.floor(Ve*((ld-vd)/(Qb-vd))*(1/wc))),Ne=Math.round(Oe*B),e!=Ne&&ec()}zd.options.stickyGroupRows&&zd.isGrouped()&&hd(Ve)}(d||c)&&(Fe&&clearTimeout(Fe),(Math.abs(Me-Ve)>20||Math.abs(Le-Ue)>20||Xc)&&(Xc||zd.options.virtualScroll&&!(Math.abs(Me-Ve)<vd&&Math.abs(Le-Ue)<yd)?(zd.options.scrollLoader&&!Xc&&(Xc=b('<div class="'+te+'">'+zd.options.scrollLoader()+"</div>").appendTo(zd.$el)),Fe=setTimeout(function(){Xc&&(Xc.remove(),Xc=null),Lc(),Fe=null},50)):Lc(),zd.trigger("viewportchanged",a,{scrollLeft:Ue,scrollTop:Ve}))),zd.trigger("scroll",a,{scrollLeft:Ue,scrollTop:Ve})},Zb=function(a){a.target===window&&zd.$el.is(":visible")&&zd.resize()},$b=function(a){if(!a)return!1;var b=kb(a);if(!b)return!1;var d=c.groupBy(zd.collection.groups,function(a){return a.column_id});return d[a]&&d[a].length?d[a][0]:!1},_b=function(a){if(!a)return!1;var b=c.pluck(zd.sorting,"columnId");return b.indexOf(a)>=0},this.hideColumn=function(a){var b=null;if(void 0!==a&&null!==a&&(b=kb(a)),!b)throw new Error('Unable to hide column "'+a+'" because no such column could be found.');var d=this.options.columns.map(function(b){var d=c.clone(b);return d.id===a&&(d.visible=!1),d});this.setColumns(d)},this.hideOverlay=function(){return h&&h.length&&(Ic(h[0]),h=null),dc(),this},bc=function(){var a=new _e({__addRow:!0,data:{},formatter:function(){return""},id:"-add-row-"});zd.collection.add(a,{forced:!0})},hc=function(a,b){var c=rb(),d=zd.getRowFromIndex(a);return d?d.editable===!1?!1:Ad.activeColumns[b].editable===!1?!1:c>a&&!d?!1:sb(a,b)?!0:!1:!1},ic=function(a,b){if(!zd.selection)return!1;for(var c,d=0,e=zd.selection.length;e>d;d++)if(c=zd.selection[d],c.contains(a,b))return!0;return!1},jc=function(a){if(!zd.selection)return!1;var b=zd.collection.length-1;"__gridAggregate"==zd.collection.items[zd.collection.items.length-1][zd.options.idProperty]&&b--;for(var c,d=0,e=zd.selection.length;e>d;d++)if(c=zd.selection[d],0===c.fromRow&&c.toRow===b&&c.fromCell>=a&&c.toCell<=a)return!0;return!1},cc=function(){var a="";a="function"==typeof zd.options.emptyNotice?zd.options.emptyNotice.bind(zd)():xb(zd.fetcher?"empty.remote":zd.collection&&zd.collection.filterset?"empty.filter":"empty.default"),zd.showOverlay({"class":Ud,html:a})},dc=function(){rd(),ec(),Lc()},ec=function(){zd.currentEditor&&nc();for(var a in Ad.nodes)Kc(a)},fc=function(a){delete Ad.postprocess[Ad.rows[a][zd.options.idProperty]],Pe=Math.min(Pe,a),Qe=Math.max(Qe,a),gd()},gc=function(a){if(a&&a.length){$e=0;for(var b=0,c=a.length;c>b;b++)zd.currentEditor&&zd.active&&zd.active.row===a[b]&&nc(),Ad.nodes[a[b]]&&Kc(a[b])}},this.isGrouped=function(){return this.collection.groups.length?!0:!1},this.isSorted=function(){return this.sorting.length?!0:!1},lc=function(){zd.listenTo(zd.options.data,"add",function(a,b,c){zd.destroyed||(void 0!==c.silentDobyRefresh&&(c.silent=c.silentDobyRefresh),zd.collection.add(a,c))}),zd.listenTo(zd.options.data,"change",function(a){zd.destroyed||(a.changed&&a.changed[zd.options.idProperty]?zd.setItem(a._previousAttributes[zd.options.idProperty],a):zd.setItem(a[zd.options.idProperty],a))}),zd.listenTo(zd.options.data,"remove",function(a){zd.destroyed||zd.collection.remove(a[zd.options.idProperty])}),zd.listenTo(zd.options.data,"reset",function(a){zd.destroyed||zd.collection.reset(a)}),zd.listenTo(zd.options.data,"sort",c.debounce(function(){zd.destroyed||zd.collection&&zd.collection.reset(zd.options.data)}),10)},kc=function(){var a=e.children("."+ae);a.each(function(a){Ad.activeColumns[a].previousWidth=Ad.activeColumns[a].width})},mc=function(a){if(zd.active&&zd.active.node&&zd.options.editable===!0&&hc(zd.active.row,zd.active.cell)){clearTimeout(Ee);var c=Ad.activeColumns[zd.active.cell],d=zd.getRowFromIndex(zd.active.row);b(zd.active.node).addClass("editable"),a||(zd.active.node.innerHTML="");var e=a||sb(zd.active.row,zd.active.cell);zd.currentEditor=new e({grid:zd,cell:zd.active.node,column:c,item:d||{},commitChanges:function(){zd.options.autoEdit&&uc("down")}});for(var f=["applyValue","cancel","destroy","focus","getValue","isValueChanged","loadValue","serializeValue","setValue","validate"],g=0,h=f.length;h>g;g++)if(!zd.currentEditor[f[g]])throw new Error("Your editor is missing a '"+[f[g]]+"' function.");_c=zd.currentEditor.serializeValue(),zd.currentEditor.focus()}},nc=function(){if(zd.currentEditor&&(zd.currentEditor.$input.is(document.activeElement)&&d.focus(),zd.currentEditor.destroy(),zd.currentEditor=null,zd.active&&zd.active.node)){var a=zd.getRowFromIndex(zd.active.row);if(b(zd.active.node).removeClass("editable invalid"),a){var c=Ad.activeColumns[zd.active.cell],e=tb(a,c);zd.active.node.innerHTML=e(zd.active.row,zd.active.cell,qb(a,c),c,a),fc(zd.active.row)
}}},qc=function(){var a,c=["paddingLeft","paddingRight"],f=["paddingTop","paddingBottom"];zd.options.showHeader&&(a=b('<div class="'+ae+'" style="visibility:hidden">-</div>').appendTo(e),He=Ie=0,"border-box"!=a.css("box-sizing")&&"border-box"!=a.css("-moz-box-sizing")&&"border-box"!=a.css("-webkit-box-sizing")&&(b.each(c,function(b,c){He+=parseFloat(a.css(c))||0}),b.each(f,function(b,c){Ie+=parseFloat(a.css(c))||0})),Ic(a[0]));var g=b('<div class="'+pe+'"></div>').appendTo(d);a=b('<div class="'+Ed+'" style="visibility:hidden">-</div>').appendTo(g),Cd=Bd=0,"border-box"!=a.css("box-sizing")&&"border-box"!=a.css("-moz-box-sizing")&&"border-box"!=a.css("-webkit-box-sizing")&&(b.each(c,function(b,c){Cd+=parseFloat(a.css(c))||0}),b.each(f,function(b,c){Bd+=parseFloat(a.css(c))||0})),Ic(g[0]),k=Math.max(He,Cd)},rc=function(a){var b,c,d=[],e={};for(b=0,c=zd.collection.groups.length;c>b;b++)d.push({columnId:zd.collection.groups[b].column_id,sortAsc:!0,group:!0}),e[zd.collection.groups[b].column_id]=d[b];var f;for(b=0,c=a.length;c>b;b++)a[b].group||(f=e[a[b].columnId],f?(delete f.group,f.sortAsc=a[b].sortAsc):d.push(a[b]));return d},tc=function(a,b){var c,d,e=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,f=/(^[ ]*|[ ]*$)/g,g=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=/^0x[0-9a-f]+$/i,i=/^0/,j=function(a){return(""+a).toLowerCase()||""+a},k=j(a).replace(f,"")||"",l=j(b).replace(f,"")||"",m=k.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),n=l.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),o=parseInt(k.match(h),10)||1!=m.length&&k.match(g)&&Date.parse(k),p=parseInt(l.match(h),10)||o&&l.match(g)&&Date.parse(l)||null;if(p){if(p>o)return-1;if(o>p)return 1}for(var q=0,r=Math.max(m.length,n.length);r>q;q++){if(c=!(m[q]||"").match(i)&&parseFloat(m[q])||m[q]||0,d=!(n[q]||"").match(i)&&parseFloat(n[q])||n[q]||0,isNaN(c)!==isNaN(d))return isNaN(c)?1:-1;if(typeof c!=typeof d&&(c+="",d+=""),d>c)return-1;if(c>d)return 1}return 0},uc=function(a){if(!zd.options.keyboardNavigation)return!1;if(!(zd.active&&zd.active.node||"prev"==a||"next"==a))return!1;var b={up:-1,down:1,left:-1,right:1,prev:-1,next:1};Ye=b[a];var c={up:Ob,down:Jb,left:Kb,right:Nb,prev:Mb,next:Lb},d=c[a],e=d(zd.active?zd.active.row:null,zd.active?zd.active.cell:null,l);if(e){var f=e.row==rb();return Wc(e.row,e.cell,!f),ad(ib(e.row,e.cell)),l=e.posX,!0}return!1},xc=function(){},xc.prototype=new _e,xc.prototype.__placeholder=!0,xc.prototype.toString=function(){return"Placeholder"},yc=function(a,b){var c,d,f=e.children("."+ae),g=null,h=null;if(zd.options.autoColumnWidth)for(g=0,h=0,c=a+1;c<f.length;c++)d=Ad.activeColumns[c],d.resizable&&(null!==h&&(d.maxWidth?h+=d.maxWidth-d.previousWidth:h=null),g+=d.previousWidth-Math.max(d.minWidth||0,k));var i=0,j=0;for(c=0;a>=c;c++)d=Ad.activeColumns[c],d.resizable&&(null!==j&&(d.maxWidth?j+=d.maxWidth-d.previousWidth:j=null),i+=d.previousWidth-Math.max(d.minWidth||0,k));null===g&&(g=1e5),null===i&&(i=1e5),null===h&&(h=1e5),null===j&&(j=1e5),oc=b+Math.min(g,j),pc=b-Math.min(i,h)},zc=function(a,b,c,d){c=void 0===c?a:c,d=void 0===d?b:d,this.fromRow=Math.min(a,c),this.fromCell=Math.min(b,d),this.toRow=Math.max(a,c),this.toCell=Math.max(b,d),this.exclusions=[]},zc.prototype.contains=function(a,b){return a>=this.fromRow&&a<=this.toRow&&(void 0===b||null===b||b>=this.fromCell&&b<=this.toCell&&!this.isExcludedCell(a,b))&&!this.isExcludedRow(a)},zc.prototype.deselect=function(a,b){var c=void 0!==a&&null!==a&&void 0!==b&&null!==b;if(c&&!this.contains(a,b))throw new Error("Unable to deselect cell ("+a+", "+b+") because it is not part of this Range.");if(c)this.exclusions.push([a,b]);else if(void 0!==a&&null!==a)for(var d=0,e=Ad.activeColumns.length;e>d;d++)this.exclusions.push([a,d]);var f=[];if(void 0===a||null===a)for(var g=this.fromRow;g<=this.toRow;g++)f.indexOf(g)<0&&f.push(g);else f.push(a);var h={},i={};if(void 0!==b&&null!==b)h[Ad.activeColumns[b].id]=zd.options.selectedClass;else for(var j=0,k=Ad.activeColumns.length;k>j;j++)h[Ad.activeColumns[j].id]=zd.options.selectedClass;for(var l=0,m=f.length;m>l;l++)i[f[l]]=h;return od(null,i),this},zc.prototype.excludeUnselectable=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)x(a,b)||this.exclusions.push([a,b])},zc.prototype.fullyExcluded=function(){for(var a=this.fromRow;a<=this.toRow;a++)for(var b=this.fromCell;b<=this.toCell;b++)if(!this.isExcludedCell(a,b))return!1;return!0},zc.prototype.getCellCount=function(){for(var a,b=0,c=this.fromRow;c<=this.toRow;c++){a=Ad.nodes[c];for(var d=this.fromCell;d<=this.toCell;d++)a.cellColSpans.length&&a.cellColSpans[d]&&b++}return b},zc.prototype.isExcludedCell=function(a,b){if(0===this.exclusions.length)return!1;for(var c=0,d=this.exclusions.length;d>c;c++)if(this.exclusions[c][0]===a&&this.exclusions[c][1]===b)return!0},zc.prototype.isExcludedRow=function(a){if(0===this.exclusions.length)return!1;for(var b=[],c=0,d=this.exclusions.length;d>c;c++)this.exclusions[c][0]===a&&b.push(this.exclusions[c]);return b.length==Ad.activeColumns.length},zc.prototype.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},zc.prototype.isSingleRow=function(){return this.fromRow==this.toRow},zc.prototype.toCSV=function(){for(var a=this.toJSON(),b=[],c=0,d=a.length;d>c;c++)b.push('"'+a[c].join('","')+'"');return b.join("\n")},zc.prototype.toJSON=function(){if(!zd.destroyed){for(var a,b,c,d=[],e=this.fromRow;e<=this.toRow;e++)if(b=Ad.rows[e],!(b instanceof _e)){c=[];for(var f=this.fromCell;f<=this.toCell;f++)this.isExcludedCell(e,f)?c.push(null):(a=Ad.activeColumns[f],c.push(Eb(b,a)));d.push(c)}return d}},zc.prototype.toRows=function(){for(var a=[],b=this.fromRow;b<=this.toRow;b++)this.isExcludedRow(b)||a.push(Ad.rows[b]);return a},zc.prototype.toString=function(){return this.isSingleCell()?"Range ("+this.fromRow+":"+this.fromCell+")":"Range ("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"},this.refetch=function(){if(!this.fetcher)throw new Error('The "refetch" method can only be used with Doby Grid instances which use a remote data set.');return Cc(function(){zd.collection.groups&&zd.collection.groups.length?Gc():Dc()}),this},Ac=function(){for(var a=0,b=zd.collection.items.length;b>a;a++)if(zd.collection.items[a].__placeholder)return!1;return!0},Cc=function(a){var b={filters:"function"!=typeof zd.collection.filter?zd.collection.filter:null};zd.fetcher.count(b,function(b){if(!zd.destroyed){if("number"!=typeof b)throw new Error("Your count() method must return a number. It returned a "+typeof b+' of value "'+b+'" instead.');zd.collection.length=b,zd.collection.remote_length=b,0===b?(zd.collection.reset(),cc()):ab(),rd(),zd.collection.refresh(),a()}})},Dc=function(){var a=Hb(),b=a.top,c=a.bottom,d=!0;zd.fetcher.request&&"function"==typeof zd.fetcher.request.abort&&(zd.fetcher.request.abort(),d=!1),null!==Te&&clearTimeout(Te),0>b&&(b=0),zd.collection.length>0&&(c=Math.min(c,zd.collection.length-1));for(var e,f,g,h=zd.collection.groups.length?0:b,i=0,j=0,k=h;c>=k;k++)g=Ad.rows[k],g&&g._groupRow&&g.collapsed&&void 0===e?(j+=g.count,i++):(g&&g instanceof _e&&!g.__placeholder&&i++,b>k||(!g||g.__placeholder)&&(void 0===e&&(e=k-i+j),f=k-i+j));return void 0===e?void Bc(null,null,{silent:d}):void Ec({columns:Ad.activeColumns,filters:"function"!=typeof zd.collection.filter?zd.collection.filter:null,limit:f-e+1,offset:e,order:zd.sorting},function(a){if(!zd.destroyed){if(zd.options.data instanceof Backbone.Collection)for(var b=0,c=a.length;c>b;b++)zd.options.data.add(a[b],{at:e+b,merge:!0,silentDobyRefresh:!0});else zd.collection.add(a,{at:e,merge:!0,silent:!0});Bc(e-j,f+i-j)}})},this.remoteFetchAll=function(a){return a=a||function(){},this.fetcher.request&&"function"==typeof this.fetcher.request.abort&&this.fetcher.request.abort(),null!==Te&&clearTimeout(Te),Ec({columns:Ad.activeColumns,order:this.sorting},function(b){this.options.data instanceof Backbone.Collection?this.options.data.reset(b):this.collection.reset(b),a()}.bind(this)),this},Ec=function(a,b){b=b||function(){},a.offset||(a.offset=0),a.limit||(a.limit=null),Te&&clearTimeout(Te),Te=setTimeout(function(){try{"function"==typeof zd.fetcher.onLoading&&zd.fetcher.onLoading(),zd.fetcher.request=zd.fetcher.fetch(a,function(a){zd.fetcher.request=null,b(a),"function"==typeof zd.fetcher.onLoaded&&zd.fetcher.onLoaded()})}catch(c){throw new Error("Doby Grid remote fetching failed due to: "+c)}},zd.options.remoteScrollTime)},Fc=function(a){if(a=a||function(){},zd.fetcher.request&&"function"==typeof zd.fetcher.request.abort&&zd.fetcher.request.abort(),Ad.remoteGroups)a(Ad.remoteGroups);else{var b={filters:"function"!=typeof zd.collection.filter?zd.collection.filter:null,groups:zd.collection.groups,order:zd.sorting};"function"==typeof zd.fetcher.onLoading&&zd.fetcher.onLoading(),zd.fetcher.request=zd.fetcher.fetchGroups(b,function(b){zd.fetcher.request=null,Ad.remoteGroups=b,a(b),zd.trigger("remotegroupsloaded",zd._event,{}),"function"==typeof zd.fetcher.onLoaded&&zd.fetcher.onLoaded()})}},Gc=function(){Ad.remoteGroups=null;var a=function(){for(var a=!0,b=0,c=zd.collection.groups.length;c>b&&a;b++)for(var d=0,e=zd.collection.groups[b].rows.length;e>d;d++)if(!zd.collection.groups[b].rows[d].collapsed){a=!1;break}a||Dc()};zd.once("remotegroupsloaded",a),zd.collection.refresh()},Bc=function(a,b,c){c=c||{};for(var d=a;b>=d;d++)gc([d]);rd(),Lc(),c.silent||zd.trigger("remoteloaded",zd._event,{})},this.remove=function(a){return this.collection.remove(a),this},this.removeColumn=function(a){if(!a)return this;"object"==typeof a&&(a=a.id);var b,c=this.options.columns.filter(function(c){if(c.id==a&&(b=c,c.removable!==!0))throw new Error('Cannot remove column "'+c.id+'" because it is not removable.');return c.id!=a});if(!b)throw new Error('Cannot remove column "'+a+'" because no such column exists.');$b(a)&&this.removeGrouping(a);var d;return b&&b.quickFilterInput&&(Ic(b.quickFilterInput.parent()[0]),d=!0),zd.setColumns(c),d&&n(),this},Hc=function(){i&&i.length&&(Ic(i[0]),i=null),id=null},Ic=function(a){_=document.getElementById("DobyGridGarbageBin"),_||(_=document.createElement("DIV"),_.id="DobyGridGarbageBin",_.style.display="none",document.body.appendChild(_)),_.appendChild(a),_.innerHTML=""},this.removeGrouping=function(a){if(a){"object"==typeof a&&(a=a.id);var b=$b(a);return b&&(this.collection.groups.splice(this.collection.groups.indexOf(b),1),this.setGrouping(this.collection.groups)),this}},Jc=function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];x(e.fromRow,e.fromCell)&&x(e.toRow,e.toCell)&&b.push(e)}return b},Kc=function(a){var b,c=Ad.nodes[a];if(c){d[0].removeChild(c.rowNode),delete Ad.nodes[a];var e=Ad.rows[a];if(e&&Ad.postprocess[e[zd.options.idProperty]])for(var f in Ad.postprocess[e[zd.options.idProperty]])b=Ad.activeColumns[Ad.columnsById[f]],b&&b.cache||delete Ad.postprocess[e[zd.options.idProperty]][f]}},Lc=function(){if(Ke){var a=Hb(),b=zb();E(b),Le!=Ue&&C(b),zd.$el&&(!xd&&zd.options.autoColumnWidth?zd.$el.addClass(le):zd.$el.removeClass(le)),Qc(b),Pe=a.top,Qe=Math.min(rb()-1,a.bottom),gd(),Me=Ve,Le=Ue,zd.options.stickyGroupRows&&zd.isGrouped()&&hd(Ve),zd.fetcher||0!==zd.collection.length||cc()}},Mc=function(a,b,c,d,e){var f=Ad.activeColumns[c],g=e&&e.columns||{},h=Math.min(Ad.activeColumns.length-1,c+d-1),i=e?qb(e,f):null,j=e._groupRow?"":f.class?"function"==typeof f.class?f.class.bind(zd)(b,c,i,f,e):f.class:null,k=Ad.activeColumns[c],l=[Ed,"l"+c,"r"+h];if(j&&l.push(j),zd.active&&b===zd.active.row&&c===zd.active.cell&&l.push("active"),g[k.id]&&g[k.id].class?l.push(g[k.id].class):g[c]&&g[c].class&&l.push(g[c].class),ic(b,c)&&l.push(zd.options.selectedClass),k.selectable===!1&&l.push(Fd),a.push('<div class="'+l.join(" ")+'">'),f.cache&&f.postprocess&&Ad.postprocess[e[zd.options.idProperty]]&&Ad.postprocess[e[zd.options.idProperty]][k.id])a.push(Ad.postprocess[e[zd.options.idProperty]][k.id]);else if(e)try{a.push(tb(e,f)(b,c,i,f,e))}catch(m){a.push(""),console.error&&console.error("Cell failed to render due to failed '"+k.id+"' column formatter. Error: "+m.message,m)}a.push("</div>"),Ad.nodes[b]&&(Ad.nodes[b].cellRenderQueue.push(c),Ad.nodes[b].cellColSpans[c]=d)},Nc=function(){if(zd.options.showHeader){e.is(":empty")||(e.empty(),e.width(wb()));for(var a,b,c,d=[],f=0,g=Ad.activeColumns.length;g>f;f++)a=Ad.activeColumns[f],b=[ae,a.headerClass||""],a.sortable&&b.push(he),c=a.width-He,d.push('<div class="'+b.join(" ")+'" style="width:'+c+'px" '),d.push('id="'+(Ze+a.id)+'"'),void 0!==a.tooltip&&null!==a.tooltip&&"title"==zd.options.tooltipType&&d.push(' title="'+a.tooltip+'"'),d.push(">"),d.push('<span class="'+Id+'">'+a.name+"</span>"),a.sortable&&d.push('<span class="'+ue+'"></span>'),d.push("</div>");e.append(d.join("")),jd(),zd.options.resizableColumns&&dd(),zd.options.reorderable&&cd()}},Oc=function(a,c){for(var d,e=b(['<div class="',Md,'"></div>'].join("")),f=function(a){"function"==typeof this.fn?this.fn.bind(zd)(a):this.menu&&a.stopPropagation()},g=0,h=a.length;h>g;g++)if(d=a[g],void 0===d.enabled||d.enabled)if(d.title)e.append(['<div class="',Sd,'">',d.icon?d.icon:"",d.name||"","</div>"].join(""));else if(d.divider)e.append(['<div class="',Od,'"></div>'].join(""));else{var i=d.name||"",j="";void 0!==d.value&&(d.value&&(j=" on"),i+=['<span class="',Qd,'"></span>'].join(""));var k=['<div class="',Nd," ",j,'">',d.icon?d.icon:"",i,"</div>"].join(""),l=b(k).appendTo(e);d.menu&&(l.append(['<span class="',Pd,'"></span>'].join("")),Oc(d.menu,l)),l.click(f.bind(d))}e.appendTo(c)},Pc=function(a,b,c){var d,e=zd.getRowFromIndex(b),f=pe+(zd.active&&b===zd.active.row?" active":"")+(b%2===1?" odd":""),g={};if(ud?(g=Ad.rowPositions[b],d=g.top-Ne):d=zd.options.rowHeight*b-Ne+1*b+(b+1)*zd.options.rowSpacing,e&&e.class&&(f+=" "+("function"==typeof e.class?e.class.bind(zd)(b,e):e.class)),a.push("<div class='"+f+"' style='top:"+d+"px"),ud&&null!==g.height&&void 0!==g.height){var h=g.height-Bd;a.push(";height:"+h+"px;line-height:"+(h+zd.options.lineHeightOffset)+"px")}a.push("'>");var i,j,k,l;for(k=0,l=Ad.activeColumns.length;l>k;k++){if(j=Ad.activeColumns[k],i=1,e&&e.columns){var m=e.columns[j.id]||e.columns[k];i=m&&m.colspan||1,"*"===i&&(i=l-k)}if(Ad.columnPosRight[Math.min(l-1,k+i-1)]>c.leftPx){if(Ad.columnPosLeft[k]>c.rightPx)break;Mc(a,b,k,i,e)}i>1&&(k+=i-1)}zd.options.resizableRows&&e.resizable!==!1&&(a.push('<div class="'),a.push(re),a.push('"></div>')),a.push("</div>")},Qc=function(a){var b,c,e=[],f=[],g=!1;for(b=a.top,c=a.bottom;c>=b;b++)Ad.nodes[b]||(f.push(b),Ad.nodes[b]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},Pc(e,b,a),zd.active&&zd.active.node&&zd.active.row===b&&(g=!0),Ce++);if(f.length){var h=document.createElement("div");for(h.innerHTML=e.join(""),b=0,c=f.length;c>b;b++)Ad.nodes[f[b]].rowNode=d[0].appendChild(h.firstChild);g&&(zd.active.node=ib(zd.active.row,zd.active.cell))}},this.reset=function(a){return this.collection.reset(a,!0),this},Rc=function(){ad(null,!1)},Sc=function(){for(var a in Ad.aggregatorsByColumnId)for(var b in Ad.aggregatorsByColumnId[a])Ad.aggregatorsByColumnId[a][b]._processed=!1,"function"==typeof Ad.aggregatorsByColumnId[a][b].reset&&Ad.aggregatorsByColumnId[a][b].reset()},this.resize=function(){if(this.destroyed)return this;var a=vd;return zd.options.autoHeight&&Vc(),Tc(),h&&h.length?this:(dc(),vd>a&&this.fetcher&&Dc(),this)},Tc=function(a){Ke&&(vd=Gb(),v(),yd=parseFloat(b.css(zd.$el[0],"width",!0)),j.height(vd),rd(),zd.options.autoColumnWidth&&r(),Le=-1,a&&Lc())},Uc=function(a,b){var c,d,f,g,h,i,j=e.children("."+ae);if(f=b,0>b){for(g=a;g>=0;g--)h=Ad.activeColumns[g],d="headerContent"===zd.options.minColumnWidth?h._headerWidth:0,h.resizable&&(c=Math.max(h.minWidth||0,k,d),f&&h.previousWidth+f<c?(f+=h.previousWidth-c,h.width=c):(h.width=h.previousWidth+f,f=0));if(zd.options.autoColumnWidth)for(f=-b,g=a+1;g<j.length;g++)h=Ad.activeColumns[g],h.resizable&&(f&&h.maxWidth&&h.maxWidth-h.previousWidth<f?(f-=h.maxWidth-h.previousWidth,h.width=h.maxWidth):(h.width=h.previousWidth+f,f=0))}else{for(g=a;g>=0;g--)h=Ad.activeColumns[g],h.resizable&&(f&&h.maxWidth&&h.maxWidth-h.previousWidth<f?(f-=h.maxWidth-h.previousWidth,h.width=h.maxWidth):(h.width=h.previousWidth+f,f=0));if(zd.options.autoColumnWidth)for(f=-b,g=a+1,i=j.length;i>g;g++)h=Ad.activeColumns[g],h.resizable&&(c=Math.max(h.minWidth||0,k),f&&h.previousWidth+f<c?(f+=h.previousWidth-c,h.width=c):(h.width=h.previousWidth+f,f=0))}},Vc=function(){var a=Db()+(zd.options.showHeader?g.outerHeight()-Fb(g):0)+1;zd.$el.height(a)},this.restoreState=function(a){var b,d,e=!1;if(void 0!==a.autoColumnWidth&&null!==a.autoColumnWidth&&(this.options.autoColumnWidth=a.autoColumnWidth,e=a.autoColumnWidth),a.columns){var f,g={};for(b=0,d=a.columns.length;d>b;b++)f=a.columns[b],f.order_index=b,f.id&&(g[f.id]=f);for(b=0,d=this.options.columns.length;d>b;b++)f=this.options.columns[b],f.visible=g[f.id]?!0:!1,f.width=g[f.id]?g[f.id].width:f.width;this.options.columns=c.sortBy(this.options.columns,function(b){return g[b.id]?g[b.id].order_index:a.columns.length+1}),this.setColumns(this.options.columns)}e&&Ke&&(dd(),r()),a.filters&&this.filter(a.filters),this.options.groupable&&a.grouping&&this.setGrouping(a.grouping),a.sort&&this.setSorting(a.sort)},Wc=function(a,b,c){Zc(a,c);var d=pb(a,b),e=Ad.columnPosLeft[b],f=Ad.columnPosRight[b+(d>1?d-1:0)],g=Ue+yd;Ue>e?(j.scrollLeft(e),Yb(),Lc()):f>g&&(j.scrollLeft(Math.min(e,f-j[0].clientWidth)),Yb(),Lc())},Yc=function(a){var b,c=a*vc,d=Bb(Ve)+c;if(d=0>d?0:d,ud){if(!Ad.rowPositions[d])return;b=Ad.rowPositions[d].top}else b=d*(zd.options.rowHeight+1+zd.options.rowSpacing);if($c(b),Lc(),zd.options.activeFollowsPage&&zd.active&&null!==zd.active.row){var e=zd.active.row+c,f=rb();e>=f&&(e=f-1),0>e&&(e=0);for(var g=0,h=null,i=l;l>=g;)w(e,g)&&(h=g),g+=pb(e,g);null!==h?(ad(ib(e,h)),l=i):Rc()}},Zc=function(a,b){var c,d,e,f=zd.options.rowHeight+1,g=Hb();if(!(g.top<a&&g.bottom-1>a)){ud?(e=Ad.rowPositions[a],c=e.top,d=e.bottom-vd+(wd?window.scrollbarDimensions.height:0)):(c=a*f,d=(a+1+zd.options.rowSpacing)*f-vd+(wd?window.scrollbarDimensions.height:0));var h,i;ud?(h=e.bottom>Ve+vd+Ne,i=e.top<Ve+Ne):(h=a*(zd.options.rowHeight+zd.options.rowSpacing)>Ve+Ne,i=a*(zd.options.rowHeight+zd.options.rowSpacing)<Ve+Ne),h?($c(b?c:d),Lc()):i&&($c(b?d:c),Lc())}},$c=function(a){a=Math.max(a,0),a=Math.min(a,ld-vd+(wd?window.scrollbarDimensions.height:0));var b=Ne;Oe=Math.min(sc-1,Math.floor(a/wc)),Ne=Math.round(Oe*B);var c=a-Ne;if(ud&&v(),Ne!=b){var d=Hb(c);E(d)}Se!=c&&($e=c+Ne>Se+b?1:-1,j[0].scrollTop=Me=Ve=Se=c,zd.trigger("viewportchanged",null,{scrollLeft:0,scrollTop:Ve}))},this.scrollToRow=function(a){if(ud){var b=Ad.rowPositions[a];$c(b.top)}else $c(a*(this.options.rowHeight+1+this.options.rowSpacing)+this.options.rowSpacing);return Lc(),this},this.selectCells=function(a,b,c,d,e){if(this.options.selectable){if(void 0===a&&void 0===b&&void 0===c&&void 0===d)return void Q();for(var f,g=["startRow","startCell","endRow","endCell"],h=[a,b,c,d],i=0,j=h.length;j>i;i++)if(f=h[i],void 0===f)throw new Error('Unable to select cell range because "'+g[i]+'" param is missing.');var k,l,m,n,o,p=new zc(a,b,c,d);if(p.excludeUnselectable(),!p.fullyExcluded()){if(p.isSingleCell()&&this.selection)for(l=0,m=this.selection.length;m>l;l++){if(this.selection[l].contains(a,b))return;if(this.selection[l].isExcludedCell(a,b)){var q=this.selection[l].exclusions.indexOf([a,b]);this.selection[l].exclusions.splice(q,1);var r={};return r[a]={},r[a][Ad.activeColumns[b].id]=this.options.selectedClass,void od(r)}}e?(this.selection||(this.selection=[]),k=this.selection,k.push(p)):k=[p],this.selection=k;var s={};for(l=0,m=this.selection.length;m>l;l++)for(n=this.selection[l].fromRow;n<=this.selection[l].toRow;n++)for(s[n]||(s[n]={}),o=zd.selection[l].fromCell;o<=this.selection[l].toCell;o++)x(n,o)&&!this.selection[l].isExcludedCell(n,o)&&(s[n][Ad.activeColumns[o].id]=this.options.selectedClass);od(s),this.trigger("selection",this._event,{selection:this.selection})}}},this.selectRows=function(a,c,d){this.selectCells(a,0,c,Ad.activeColumns.length-1,d);for(var e=a;c>=e;e++){var f=Ad.nodes[e]?Ad.nodes[e].rowNode:null;f&&b(f).addClass(this.options.selectedClass)}return this},ad=function(a,c){zd.active&&null!==zd.active.node&&(nc(),b(zd.active.node).removeClass("active"),Ad.nodes[zd.active.row]&&b(Ad.nodes[zd.active.row].rowNode).removeClass("active")),zd.active||(zd.active={cell:null,node:null,row:null});var d=zd.active.node!==a;if(null!==a?(zd.active.node=a,zd.active.row=Ab(zd.active.node.parentNode),zd.active.cell=l=gb(zd.active.node),(null===c||void 0===c)&&(c=zd.active.row==rb()||zd.options.autoEdit),b(zd.active.node).addClass("active"),b(Ad.nodes[zd.active.row].rowNode).addClass("active"),zd.options.editable&&c&&hc(zd.active.row,zd.active.cell)&&(clearTimeout(Ee),zd.options.asyncEditorLoading?Ee=setTimeout(function(){mc()},zd.options.asyncEditorLoadDelay):mc())):zd.active.row=zd.active.cell=null,d){var e=bb();e.item=zd.getRowFromIndex(e.row),zd.trigger("activecellchange",zd._event,e)}},this.setColumns=function(a){var b=this.options.columns.map(function(a){return c.clone(a)});this.options.columns=U(a),sd(),pd(),this.setSorting(c.filter(this.sorting,function(a){return Ad.columnsById[a.columnId]})),this.trigger("columnchange",this._event,{columns:a,oldColumns:b}),this.trigger("statechange",this._event),Ke&&(ec(),Nc(),Hc(),L(),Tc(!0),o(),Yb(),"headerContent"===zd.options.minColumnWidth&&$(!0))},this.setGrouping=function(a){return this.collection.setGrouping(a),this},this.setItem=function(a,b){return this.collection.setItem(a,b),this},this.setOptions=function(a){nc(),void 0!==a.addRow&&zd.options.addRow!==a.addRow&&(a.addRow?bc():this.remove("-add-row-")),a.minColumnWidth&&"headerContent"===a.minColumnWidth&&zd.options.minColumnWidth!==a.minColumnWidth&&$();var c=a.rowHeight!=zd.options.rowHeight;b.extend(!0,zd.options,a),td(),a.autoHeight?j.addClass(Dd):(this.$el.removeAttr("style"),j.removeClass(Dd)),a.columns?this.setColumns(a.columns):c||Lc(),c&&(ec(),Hc(),L(),Tc(!0),o()),a.data&&this.reset(a.data),void 0!==a.autoHeight&&null!==a.autoHeight&&this.resize(),"autoColumnWidth"in a&&(dd(),r(),zd.trigger("columnresize",this._event,{})),zd.trigger("statechange",this._event,{})},bd=function(a,b){var d=Ad.rows[a];d.height=b,gc(c.range(a,Ad.rows.length)),d._groupRow?(d.predef.height=b,gc(c.range(a,Ad.rows.length)),u(a),Lc()):zd.collection.setItem(d[zd.options.idProperty],d),rd()},this.setSorting=function(a){if(!b.isArray(a))throw new Error('Doby Grid cannot set the sorting because the "options" parameter must be an array of objects.');var c,d,e=JSON.parse(JSON.stringify(this.sorting));if(!this.options.multiColumnSort&&a.length>1)throw new Error('Doby Grid cannot set the sorting given because "multiColumnSort" is disabled and the given sorting options contain multiple columns.');var f;for(c=0,d=a.length;d>c;c++){if(f=kb(a[c].columnId),!f)throw new Error(['Doby Grid cannot sort by "',a[c].columnId,'" because that column does not exist.'].join(""));if(f.sortable===!1)throw new Error(['Doby Grid cannot sort by "',f.id,'" because that column is not sortable.'].join(""));(null===a[c].sortAsc||void 0===a[c].sortAsc)&&(a[c].sortAsc=null!==f.sortAsc||void 0!==f.sortAsc?f.sortAsc:!0)}this.sorting=rc(a),jd();var g=e.length!=this.sorting.length;if(!g)for(c=0,d=e.length;d>c;c++)if(e[c].columnId!=this.sorting[c].columnId||e[c].sortAsc!=this.sorting[c].sortAsc){g=!0;break}if(g){Sc();var h,i={multiColumnSort:this.sorting.length>1,sortCols:[]};for(c=0,d=this.sorting.length;d>c;c++)h=this.sorting[c],f=kb(h.columnId),i.sortCols.push({sortCol:f,sortAsc:h.sortAsc});W(i),zd.trigger("sort",this._event,{sort:i}),zd.trigger("statechange",this._event),"headerContent"===zd.options.minColumnWidth&&$()}return this},cd=function(){zd.options.showHeader&&(e.filter(":ui-sortable").length||e.sortable({axis:"x",containment:"parent",cursor:"default",distance:3,helper:"clone",placeholder:me+" "+ae,tolerance:"intersection",start:function(a,c){c.placeholder.width(c.helper.outerWidth()-He),b(c.helper).addClass(be)},beforeStop:function(a,c){b(c.helper).removeClass(be)},update:function(a,d){a.stopPropagation();var e=function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)this.push(void 0);a.splice(c,0,a.splice(b,1)[0])},f=c.pluck(zd.options.columns,"id"),g=b(d.item).attr("id").replace(Ze,""),h=f.indexOf(g),i=b(d.item).prev(),j=zd.options.columns.map(function(a){return c.clone(a)});if(i.length){var k=i.attr("id").replace(Ze,""),l=f.indexOf(k);h>l?e(j,h,l+1):e(j,h,l)}else e(j,h,0);zd.setColumns(j),dd(),zd.trigger("columnreorder",a,{columns:zd.options.columns})}}))},dd=function(){if(zd.options.showHeader&&zd.options.resizableColumns){var a,c,d,f;c=e.children("."+ae);var g=c.find("."+Zd);g&&g.length&&Ic(g[0]),c.each(function(a){Ad.activeColumns[a].resizable&&(void 0===d&&(d=a),f=a)}),void 0!==d&&(e.on("dblclick",function(a){if(b(a.target).closest("."+Zd).length){var c=ob(a);if(c){var d=Ad.columnsById[c.id],e=c.width,f=Math.max(mb(d),c.minWidth);if(e!=f){var g=a.pageX;kc(d);var h=f-e;yc(d,g);var i=Math.min(oc,Math.max(pc,g+h))-g;Uc(d,i),p(),kd()}}}}),b.each(c,function(c,e){d>c||zd.options.autoColumnWidth&&c>=f||Ad.activeColumns[c].resizable===!1||b('<div class="'+Zd+'"><span></span></div>').appendTo(e).on("dragstart",function(d){a=d.pageX,b(this).parent().addClass(ce),kc(c),yc(c,a)}).on("drag",function(b){var d=Math.min(oc,Math.max(pc,b.pageX))-a;Uc(c,d),p()}).on("dragend",function(){setTimeout(function(){b(this).parent().removeClass(ce)}.bind(this),1),kd()})}))}},ed=function(){zd.options.showHeader&&e.click(function(a){zd._event=a;var c=b(a.target).closest("."+Zd).length||b(a.target).hasClass(ce);if(!c){var d=ob(a);if(d&&d.sortable){for(var e=null,f=0,g=zd.sorting.length;g>f;f++)if(zd.sorting[f].columnId==d.id&&!zd.sorting[f].group){e=JSON.parse(JSON.stringify(zd.sorting[f])),e.sortAsc=!e.sortAsc;break}var h=[];a.shiftKey&&zd.options.multiColumnSort?e?(h=JSON.parse(JSON.stringify(zd.sorting)),h.splice(f,1)):(h=JSON.parse(JSON.stringify(zd.sorting)),h.push({columnId:d.id,sortAsc:!0})):e?zd.options.multiColumnSort?(h=JSON.parse(JSON.stringify(zd.sorting)),h[f].sortAsc=!h[f].sortAsc):h=[e]:h=[{columnId:d.id,sortAsc:!0}],zd.setSorting(h),zd._event=null}}})},this.showOverlay=function(a){return a=a||{},ec(),h&&h.length&&Ic(h[0]),h=b(['<div class="doby-grid-overlay',a.class?" "+a.class:"",'">',a.html||"","</div>"].join("")).appendTo(d),this},this.showQuickFilter=function(a){if(zd.options.showHeader){var c=function(){vd=Gb(),j.height(vd),Tc(!0)};if((void 0===a||null===a)&&f)return Ic(f[0]),f=void 0,c(),void d.focus();var e,h=function(a){if(27==a.keyCode)return void zd.showQuickFilter();var c=b(this).val();""===c&&(c=null),b(this).data("old_value")!=c&&(b(this).data("old_value",c),e&&clearTimeout(e),e=setTimeout(function(){for(var a,b,c=[],d=0,e=Ad.activeColumns.length;e>d;d++)a=Ad.activeColumns[d],a.quickFilterInput&&(b=a.quickFilterInput.val(),b.length&&c.push([a.id,"~*",b]));zd.filter(c)},150))},i=Ad.columnsById[a];if(f)i&&i.quickFilterInput&&i.quickFilterInput.select().focus();else{f=b('<div class="'+ee+'"></div>').appendTo(g);for(var k,l,m,o=0,p=Ad.activeColumns.length;p>o;o++)if(k=Ad.activeColumns[o],m=['<div class="'],m.push(fe),k.filterable||m.push(" "+ge),m.push('">'),m.push("</div>"),l=b(m.join("")),l.appendTo(f),k.filterable){var q=null;if(zd.collection.filterset)for(var r=0,s=zd.collection.filterset.length;s>r;r++)if(zd.collection.filterset[r][0]==k.id){q=zd.collection.filterset[r][2];break}k.quickFilterInput=b('<input class="'+Td+'" type="text"/>').appendTo(l).data("column_id",k.id).attr("placeholder",xb("column.add_quick_filter")).val(q).on("keyup",h),a==k.id&&k.quickFilterInput.select().focus()}}return n(),c(),this}},fd=function(a){if("popup"==zd.options.tooltipType){if(b(a.target).closest("."+Zd).length)return void b(a.target).trigger("mouseleave");var c=ob(a);if(c&&c.tooltip){var d=b(a.target).closest("."+ae);if(!d.attr("aria-describedby")){var e=Ze+"-tooltip-column-"+c.id;d.attr("aria-describedby",e),d.one("mouseleave remove",function(){if(void 0!==b(this).attr("aria-describedby")){var a=b("#"+e);a.removeClass("on"),setTimeout(function(){a&&a.length&&Ic(a[0])},200),b(this).removeAttr("aria-describedby")}}),setTimeout(function(){if(void 0!==d.attr("aria-describedby")&&d.is(":visible")){var a=10,f=['<span class="'+ye+'" id="'+e+'">'];if(f.push(c.tooltip),f.push('<span class="'+ze+'"></span>'),f.push("</span>"),!b("#"+e).length){var g=b(f.join(""));g.appendTo(document.body);var h=d.offset().left+d.outerWidth()/2-g.outerWidth()/2,i=d.offset().top+d.outerHeight()+a,j=0,k=b(window),l=k.outerWidth();0>h?(j=h,h=0):h+g.outerWidth()>l&&(j=h+g.outerWidth()-l,h-=j+1);var m=g.children("."+ze).first();m.css("left",g.outerWidth()/2-m.outerWidth()/2+j),g.remove().addClass("on").attr("style","left:"+h+"px;top:"+(i+5)+"px").appendTo(document.body).width(),g.css("top",i)}}},250)}}}},this.sortBy=function(a,b){if(!a)throw new Error("Grid cannot sort by blank value. Column Id must be specified.");return this.setSorting([{columnId:a,sortAsc:b}])},gd=function(){De&&(clearTimeout(Ge),Ge=setTimeout(q,zd.options.asyncPostRenderDelay))},hd=function(a){var c=Bb(a),e=vb(c),f=[e];if(e){var g=function(a){a.parentGroup&&(f.push(a.parentGroup),g(a.parentGroup))};g(e);var h,i=f.length,k=j.position().top;if(0===a)return Ad.stickyRows=[],void j.parent().children("."+xe).remove();for(;i--;)if(h=f[i],0===h.collapsed&&h.sticky){We.push(h[zd.options.idProperty]);var l,m=Ad.stickyRows[i];if(m&&m.length&&m.attr("rel")==h[zd.options.idProperty])l=m;else{var n="."+xe+'[rel="'+h[zd.options.idProperty]+'"]:first';l=j.parent().children(n),l.length&&l.remove();var o=Ad.indexById[h[zd.options.idProperty]],p=Ad.nodes[o];if(void 0===o)continue;if(p){var q=b(p.rowNode);l=q.clone()}else{var r=[];Pc(r,o,{bottom:o,leftPx:0,top:o,rightPx:j.width()}),l=b(r.join(""))}l.addClass(xe).attr("rel",h[zd.options.idProperty]).width(d.css("width")).removeClass(Yd).appendTo(j.parent()),Ad.stickyRows[i]=l}l.css("top",k),k+=l.outerHeight()}}},jd=function(){if(zd.options.showHeader){var a=e.children();a.removeClass(de).find("."+ue).removeClass(ve+" "+we),b.each(zd.sorting,function(b,c){null===c.sortAsc&&(c.sortAsc=!0);var d=Ad.columnsById[c.columnId];null===d||c.group||a.eq(d).addClass(de).find("."+ue).addClass(c.sortAsc?ve:we)})}},kd=function(a){var c,d,f,g=e.children("."+ae);for(d=0;d<g.length;d++)f=Ad.activeColumns[d],c=b(g[d]).outerWidth(),f.previousWidth!==c&&f.rerenderOnResize&&ec();nd(!0),Lc(),a||zd.trigger("columnresize",zd._event,{columns:zd.options.columns}),zd.trigger("statechange",zd._event)},this.toString=function(){return"DobyGrid"},md=function(a,d){if(a.preventDefault(),window._DobyGridDropdownEvent!==a.timeStamp){window._DobyGridDropdownEvent=a.timeStamp;for(var e,g,h=d.column||!1,i=function(a){return function(d){d.stopPropagation();var e=zd.options.columns.map(function(e){var f=c.clone(e);return f.id===a.id&&(f.visible=!f.visible,f.visible?b(d.currentTarget).addClass("on"):b(d.currentTarget).removeClass("on")),f});zd.setColumns(e)}},j=[],k="--UNDEFINED--",l=c.chain(zd.options.columns).sortBy(function(a){return a.name}).groupBy(function(a){return void 0!==a.category&&null!==a.category?a.category:k}).value(),m=Object.keys(l).sort(),n=function(a,b){a.removable&&(b=b||j,b.push({name:void 0!==a.name&&null!==a.name?a.name:a.id,fn:i(a),value:a.visible}))},o=0,p=m.length;p>o;o++)if(e=m[o],e!=k){g={name:e,menu:[]};for(var q=0,r=l[e].length;r>q;q++)n(l[e][q],g.menu);j.push(g)}if(l[k])for(var s=0,t=l[k].length;t>s;s++)n(l[k][s]);var u=function(a,c){return function(d){if(1!==Object.keys(Ad.aggregatorsByColumnId[a.id]).length){b(d.target).parent().children("."+Nd).removeClass("on"),b(d.target).addClass("on"),b(d.target).children("."+Qd).length||b(d.target).append('<span class="'+Qd+'"></span>');for(var e in Ad.aggregatorsByColumnId[a.id])Ad.aggregatorsByColumnId[a.id][e].active=e==c;
for(var f=Hb(),g=f.top,h=f.bottom;h>g;g++)Ad.rows[g]&&Ad.rows[g]._aggregateRow&&gc([g]);Sc(),zd.collection.refresh()}}},v=[];if(h&&Ad.aggregatorsByColumnId[h.id])for(var w in Ad.aggregatorsByColumnId[h.id])v.push({fn:u(h,w),name:h.aggregators[w].name,value:Ad.aggregatorsByColumnId[h.id][w].active});var x=[{enabled:h||zd.options.quickFilter,name:xb("column.options"),title:!0},{enabled:h&&h.removable,name:h?xb("column.remove",{name:h.name}):"",fn:function(){zd.hideColumn(h.id)}},{enabled:zd.options.quickFilter,name:xb("column.filtering"),menu:[{enabled:h,name:h?xb("column.filter",{name:h.name}):"",fn:function(){zd.showQuickFilter(h.id),zd.dropdown.hide()}},{enabled:void 0!==f,name:xb("global.hide_filter"),fn:function(){zd.showQuickFilter(),zd.dropdown.hide()}}]},{enabled:h&&h.sortable,name:xb("column.sorting"),menu:[{enabled:!_b(h.id),name:h?xb("column.sort_asc",{name:h.name}):"",fn:function(){zd.sortBy(h.id,!0),zd.dropdown.hide()}},{enabled:!_b(h.id),name:h?xb("column.sort_desc",{name:h.name}):"",fn:function(){zd.sortBy(h.id,!1),zd.dropdown.hide()}},{enabled:zd.isSorted()&&!_b(h.id),name:h?xb("column.add_sort_asc",{name:h.name}):"",fn:function(){zd.sorting.push({columnId:h.id,sortAsc:!0}),zd.setSorting(zd.sorting),zd.dropdown.hide()}},{enabled:zd.isSorted()&&!_b(h.id),name:h?xb("column.add_sort_desc",{name:h.name}):"",fn:function(){zd.sorting.push({columnId:h.id,sortAsc:!1}),zd.setSorting(zd.sorting),zd.dropdown.hide()}},{enabled:_b(h.id),name:h?xb("column.remove_sort",{name:h.name}):"",fn:function(){zd.setSorting(c.filter(zd.sorting,function(a){return a.columnId!=h.id})),zd.dropdown.hide()}}]},{enabled:zd.options.groupable&&h&&h.groupable,name:xb("column.grouping"),menu:[{enabled:!$b(h.id)||!zd.isGrouped(),name:h?xb("column.group",{name:h.name}):"",fn:function(){zd.setGrouping([{column_id:h.id}]),zd.dropdown.hide()}},{enabled:!$b(h.id)&&zd.isGrouped(),name:h?xb("column.add_group",{name:h.name}):"",fn:function(){zd.addGrouping(h.id),zd.dropdown.hide()}},{enabled:$b(h.id),name:h?xb("column.remove_group",{name:h.name}):"",fn:function(){zd.removeGrouping(h.id),zd.dropdown.hide()}},{enabled:zd.isGrouped(),name:xb("column.groups_clear"),fn:function(){zd.setGrouping(),zd.dropdown.hide()}},{enabled:zd.isGrouped(),divider:!0},{enabled:zd.isGrouped(),name:xb("column.groups_expand"),fn:function(){zd.collection.expandAllGroups()}},{enabled:zd.isGrouped(),name:xb("column.groups_collapse"),fn:function(){zd.collection.collapseAllGroups()}}]},{enabled:h&&void 0!==h.aggregators,name:xb("column.aggregators"),menu:v},{name:xb("global.grid_options"),title:!0},{name:xb("selection.selection"),menu:[{name:xb("selection.select_all",{name:h.name}),fn:function(){zd.selectCells(0,0,Ad.rows.length-1,Ad.activeColumns.length-1),zd.dropdown.hide()}},{enabled:h&&!jc(Ad.columnsById[h.id]),name:xb("selection.select_column",{name:h.name}),fn:function(){var a=Ad.columnsById[h.id];zd.selectCells(0,a,Ad.rows.length-1,a),zd.dropdown.hide()}},{enabled:void 0!==d.cell&&null!==d.cell&&!ic(d.row,d.cell),name:xb("selection.select_cell"),fn:function(){zd.selectCells(d.row,d.cell,d.row,d.cell),zd.dropdown.hide()}},{name:xb("selection.deselect_all",{name:h.name}),fn:function(){Q(),zd.dropdown.hide()}},{enabled:h&&jc(Ad.columnsById[h.id]),name:xb("selection.deselect_column",{name:h.name}),fn:function(){for(var a=Ad.columnsById[h.id],b=0;b<Ad.rows.length-1;b++)Q(b,a)}},{enabled:void 0!==d.cell&&null!==d.cell&&ic(d.row,d.cell),name:xb("selection.deselect_cell"),fn:function(){Q(d.row,d.cell),zd.dropdown.hide()}}]},{enabled:j.length>0,name:xb("global.columns"),menu:j},{enabled:Je,name:xb("global.export"),menu:[{name:xb("global.export_csv"),fn:function(){zd.export("csv",function(a){var b=new Blob([a],{type:"text/csv;charset=utf-8"});saveAs(b,[zd.options.exportFileName,".csv"].join(""))}),zd.dropdown.hide()}},{name:xb("global.export_html"),fn:function(){zd.export("html",function(a){var b=new Blob([a],{type:"text/html;charset=utf-8"});saveAs(b,[zd.options.exportFileName,".html"].join(""))}),zd.dropdown.hide()}}]},{name:xb("global.auto_width"),value:zd.options.autoColumnWidth,fn:function(){zd.setOptions({autoColumnWidth:!zd.options.autoColumnWidth})}}];if(zd.options.menuExtensions){var y=function(a){if(a.fn){var b=a.fn;a.fn=function(a){var c=b(a);return zd.dropdown.hide(),c}}if(a.menu)for(var c=0,d=a.menu.length;d>c;c++)a.menu[c]=y(a.menu[c]);return a};void 0!==d.row&&null!==d.row&&(d.item=Ad.rows[d.row]);var z=zd.options.menuExtensions(a,zd,d),A=z?z.filter(function(a){return void 0===a.enabled||a.enabled}):[];if(A.length){x.push({name:xb("global.extensions"),title:!0});for(var B=0,C=A.length;C>B;B++)x.push(y(A[B]))}}var D=b('<div class="'+Kd+'"></div>');Oc(x,D);var E;D.on("mouseover",function(a){E&&clearTimeout(E);var c=b(a.target).hasClass(Nd)?b(a.target):b(a.target).parent().hasClass(Nd)?b(a.target).parent():null;c&&(E=setTimeout(function(){c.parent().children(".open").removeClass("open"),c.addClass("open")},200))}),zd.dropdown=new T(a,{id:h.id,menu:D,parent:zd.$el})}},nd=function(a){var b=y;y=db(),y!=b&&(d.width(y),zd.options.showHeader&&e.width(wb()),wd=y>yd-window.scrollbarDimensions.width),(y!=b||a)&&o()},od=function(a,c){var d,e,f,g;for(var h in Ad.nodes){if(g=c&&c[h],f=a&&a[h],g)for(e in g)f&&g[e]==f[e]||(d=ib(h,Ad.columnsById[e]),d&&b(d).removeClass(g[e]));if(f)for(e in f)g&&g[e]==f[e]||(d=ib(h,Ad.columnsById[e]),d&&b(d).addClass(f[e]))}},pd=function(a){(null===a||void 0===a)&&(a=!0),Ad.columnPosLeft=[],Ad.columnPosRight=[],a&&(Ad.aggregatorsByColumnId={});for(var b,c=0,d=0,e=Ad.activeColumns.length;e>d;d++)if(b=Ad.activeColumns[d],Ad.columnPosLeft[d]=c,Ad.columnPosRight[d]=c+b.width,c+=b.width,a&&b.aggregators)for(var f=0,g=b.aggregators.length;g>f;f++)Ad.aggregatorsByColumnId[b.id]||(Ad.aggregatorsByColumnId[b.id]={}),Ad.aggregatorsByColumnId[b.id][f]=new b.aggregators[f].fn(b),"function"==typeof Ad.aggregatorsByColumnId[b.id][f].reset&&Ad.aggregatorsByColumnId[b.id][f].reset()},qd=function(a){var b=Ad.nodes[a];if(b){V(a);var c=zd.getRowFromIndex(a);for(var d in b.cellNodesByColumnIdx)if(b.cellNodesByColumnIdx.hasOwnProperty(d)){d=0|d;var e=Ad.activeColumns[d],f=b.cellNodesByColumnIdx[d];zd.active&&a===zd.active.row&&d===zd.active.cell&&zd.currentEditor?zd.currentEditor.loadValue(c):f.innerHTML=c?tb(c,e)(a,d,qb(c,e),e,c):""}fc(a)}},rd=function(){if(Ke){var a=Ad.rows.length,b=xd;if(0===a)xd=!1;else if(ud){var c=Ad.rowPositions[a-1];xd=c&&c.bottom>vd}else xd=a*(zd.options.rowHeight+zd.options.rowSpacing)>vd;nc();for(var e in Ad.nodes)e>=a&&Kc(e);zd.active&&zd.active.node&&zd.active.row>a&&Rc();var f=Qb;if(0===a)ld=vd-window.scrollbarDimensions.height;else{var g;if(ud){var h=a-1,i=Ad.rowPositions[h];g=i.bottom}else g=(zd.options.rowHeight+zd.options.rowSpacing)*a+a;ld=Math.max(g,vd-window.scrollbarDimensions.height)}ld<window.maxSupportedCssHeight?(Qb=wc=ld,sc=1,B=0):(Qb=window.maxSupportedCssHeight,wc=Qb/100,sc=Math.floor(ld/wc),B=(ld-Qb)/(sc-1)),Qb!==f&&(d.css("height",Qb),Ve=j[0].scrollTop);var k=ld-vd>=Ve+Ne;0===ld||0===Ve?Oe=Ne=0:$c(k?Ve+Ne:ld-vd),zd.options.autoColumnWidth&&void 0!==b&&b!=xd&&r(),nd(!1)}},sd=function(){if(zd.options.columns){Ad.activeColumns=[],Ad.columnsById={};for(var a,c={},d=0,e=zd.options.columns.length;e>d;d++){if(void 0===zd.options.columns[d])throw new TypeError("You have an 'undefined' column object in your Grid Options. This is not allowed.");if(null===zd.options.columns[d])throw new TypeError("You have a 'null' column object in your Grid Options. This is not allowed.");if(a=zd.options.columns[d]=b.extend(JSON.parse(JSON.stringify(af)),zd.options.columns[d]),(void 0===a.id||null===a.id)&&(a.id=a.field?a.field+"_"+d:a.name?a.name+"_"+d:null),c[a.id])throw new Error(["You cannot have two columns with the same 'id' value. ","Please change one of the '",a.id,"' column 'id' values."].join(""));a.postprocess&&(De=!0),(void 0===a.width||null===a.width)&&(a.width=zd.options.columnWidth),void 0!==a.minWidth&&null!==a.minWidth&&a.width<a.minWidth&&(a.width=a.minWidth),void 0!==a.maxWidth&&null!==a.maxWidth&&a.width>a.maxWidth&&(a.width=a.maxWidth);for(var f,g=["editor","exporter","formatter"],h=0,i=g.length;i>h;h++)if(f=g[h],void 0!==a[f]&&null!==a[f]&&"function"!=typeof a[f])throw new Error(["Column ",f,"s must be functions. ","Invalid ",f,' given for column "',a.name||a.id,'"'].join(""));if(void 0!==a.aggregators&&null!==a.aggregators&&!b.isArray(a.aggregators))throw new Error(['A column\'s "aggregators" value must be array. ','Invalid value given for column "',a.name||a.id,'"'].join(""));a.visible!==!1&&(Ad.activeColumns.push(a),Ad.columnsById[a.id]=Ad.activeColumns.length-1),c[a.id]=!0}}},td=function(){if(zd.options.resizableColumns&&!b.fn.drag)throw new Error('In order to use "resizable", you must ensure the jquery-ui.draggable module is loaded.');if(zd.options.reorderable&&!b.fn.sortable)throw new Error('In order to use "reorderable", you must ensure the jquery-ui.sortable module is loaded.');if(!b.isArray(zd.options.columns))throw new TypeError('The "columns" option must be an array.');if(!(b.isArray(zd.options.data)||"function"==typeof zd.options.data||zd.options.data instanceof Backbone.Collection))throw new TypeError('The "data" option must be an array, a function or a Backbone.Collection.');if("function"==typeof zd.options.data?zd.fetcher=new zd.options.data:zd.options.data instanceof Backbone.Collection&&zd.options.data.DobyGridRemote&&(zd.fetcher=zd.options.data.DobyGridRemote),zd.fetcher&&(zd.fetcher.grid=zd),["title","popup"].indexOf(zd.options.tooltipType)<0)throw new Error('The "tooltipType" option be either "title" or "popup", not "'+zd.options.tooltipType+'".');zd.options.addRow&&!zd.options.editable&&(console.warn&&console.warn('In order to use "addRow", you must enable the "editable" parameter. The "addRow" option has been disabled.'),zd.options.addRow=!1),zd.options.resizableRows&&!ud&&(ud=!0),sd(),zd.options.data instanceof Backbone.Collection&&lc()},ac()};return d});